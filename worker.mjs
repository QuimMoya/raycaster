var t,e,s,i,n,r,o,a,h,l,c,u,d,p,f,m,b,y,g,_,x,w,v,M,A,S,z,I,T,B,C,E,k,P,F,R,L,O,V,U,D,N,W,Z,q,H,j,G,Y,X,J,Q,$,K,tt,et,st,it=Object.defineProperty,nt=(t,e,s)=>(((t,e,s)=>{e in t?it(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s})(t,"symbol"!=typeof e?e+"":e,s),s),rt=(t,e,s)=>{if(!e.has(t))throw TypeError("Cannot "+s)},ot=(t,e,s)=>(rt(t,e,"read from private field"),s?s.call(t):e.get(t)),at=(t,e,s)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,s)},ht=(t,e,s,i)=>(rt(t,e,"write to private field"),i?i.call(t,s):e.set(t,s),s),lt=(t,e,s,i)=>({set _(i){ht(t,e,i,s)},get _(){return ot(t,e,i)}}),ct=(t,e,s)=>(rt(t,e,"access private method"),s);const ut=1001,dt="srgb",pt="srgb-linear",ft="linear",mt="srgb",bt=7680,yt=2e3,gt=2001;class _t{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const s=this._listeners;void 0===s[t]&&(s[t]=[]),-1===s[t].indexOf(e)&&s[t].push(e)}hasEventListener(t,e){if(void 0===this._listeners)return!1;const s=this._listeners;return void 0!==s[t]&&-1!==s[t].indexOf(e)}removeEventListener(t,e){if(void 0===this._listeners)return;const s=this._listeners[t];if(void 0!==s){const t=s.indexOf(e);-1!==t&&s.splice(t,1)}}dispatchEvent(t){if(void 0===this._listeners)return;const e=this._listeners[t.type];if(void 0!==e){t.target=this;const s=e.slice(0);for(let e=0,i=s.length;e<i;e++)s[e].call(this,t);t.target=null}}}const xt=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];function wt(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,s=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(xt[255&t]+xt[t>>8&255]+xt[t>>16&255]+xt[t>>24&255]+"-"+xt[255&e]+xt[e>>8&255]+"-"+xt[e>>16&15|64]+xt[e>>24&255]+"-"+xt[63&s|128]+xt[s>>8&255]+"-"+xt[s>>16&255]+xt[s>>24&255]+xt[255&i]+xt[i>>8&255]+xt[i>>16&255]+xt[i>>24&255]).toLowerCase()}function vt(t,e,s){return Math.max(e,Math.min(s,t))}function Mt(t,e,s){return(1-s)*t+s*e}function At(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return t/4294967295;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int32Array:return Math.max(t/2147483647,-1);case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}function St(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return Math.round(4294967295*t);case Uint16Array:return Math.round(65535*t);case Uint8Array:return Math.round(255*t);case Int32Array:return Math.round(2147483647*t);case Int16Array:return Math.round(32767*t);case Int8Array:return Math.round(127*t);default:throw new Error("Invalid component type.")}}const zt=Math.PI/180;class It{constructor(t=0,e=0){It.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,s=this.y,i=t.elements;return this.x=i[0]*e+i[3]*s+i[6],this.y=i[1]*e+i[4]*s+i[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(t,Math.min(e,s)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const s=this.dot(t)/e;return Math.acos(vt(s,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,s=this.y-t.y;return e*e+s*s}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,s){return this.x=t.x+(e.x-t.x)*s,this.y=t.y+(e.y-t.y)*s,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const s=Math.cos(e),i=Math.sin(e),n=this.x-t.x,r=this.y-t.y;return this.x=n*s-r*i+t.x,this.y=n*i+r*s+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Tt{constructor(t,e,s,i,n,r,o,a,h){Tt.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==t&&this.set(t,e,s,i,n,r,o,a,h)}set(t,e,s,i,n,r,o,a,h){const l=this.elements;return l[0]=t,l[1]=i,l[2]=o,l[3]=e,l[4]=n,l[5]=a,l[6]=s,l[7]=r,l[8]=h,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,s=t.elements;return e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3],e[4]=s[4],e[5]=s[5],e[6]=s[6],e[7]=s[7],e[8]=s[8],this}extractBasis(t,e,s){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),s.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const s=t.elements,i=e.elements,n=this.elements,r=s[0],o=s[3],a=s[6],h=s[1],l=s[4],c=s[7],u=s[2],d=s[5],p=s[8],f=i[0],m=i[3],b=i[6],y=i[1],g=i[4],_=i[7],x=i[2],w=i[5],v=i[8];return n[0]=r*f+o*y+a*x,n[3]=r*m+o*g+a*w,n[6]=r*b+o*_+a*v,n[1]=h*f+l*y+c*x,n[4]=h*m+l*g+c*w,n[7]=h*b+l*_+c*v,n[2]=u*f+d*y+p*x,n[5]=u*m+d*g+p*w,n[8]=u*b+d*_+p*v,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],s=t[1],i=t[2],n=t[3],r=t[4],o=t[5],a=t[6],h=t[7],l=t[8];return e*r*l-e*o*h-s*n*l+s*o*a+i*n*h-i*r*a}invert(){const t=this.elements,e=t[0],s=t[1],i=t[2],n=t[3],r=t[4],o=t[5],a=t[6],h=t[7],l=t[8],c=l*r-o*h,u=o*a-l*n,d=h*n-r*a,p=e*c+s*u+i*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return t[0]=c*f,t[1]=(i*h-l*s)*f,t[2]=(o*s-i*r)*f,t[3]=u*f,t[4]=(l*e-i*a)*f,t[5]=(i*n-o*e)*f,t[6]=d*f,t[7]=(s*a-h*e)*f,t[8]=(r*e-s*n)*f,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,s,i,n,r,o){const a=Math.cos(n),h=Math.sin(n);return this.set(s*a,s*h,-s*(a*r+h*o)+r+t,-i*h,i*a,-i*(-h*r+a*o)+o+e,0,0,1),this}scale(t,e){return this.premultiply(Bt.makeScale(t,e)),this}rotate(t){return this.premultiply(Bt.makeRotation(-t)),this}translate(t,e){return this.premultiply(Bt.makeTranslation(t,e)),this}makeTranslation(t,e){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){const e=Math.cos(t),s=Math.sin(t);return this.set(e,-s,0,s,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){const e=this.elements,s=t.elements;for(let t=0;t<9;t++)if(e[t]!==s[t])return!1;return!0}fromArray(t,e=0){for(let s=0;s<9;s++)this.elements[s]=t[s+e];return this}toArray(t=[],e=0){const s=this.elements;return t[e]=s[0],t[e+1]=s[1],t[e+2]=s[2],t[e+3]=s[3],t[e+4]=s[4],t[e+5]=s[5],t[e+6]=s[6],t[e+7]=s[7],t[e+8]=s[8],t}clone(){return(new this.constructor).fromArray(this.elements)}}const Bt=new Tt;function Ct(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}const Et={enabled:!0,workingColorSpace:pt,spaces:{},convert:function(t,e,s){return!1!==this.enabled&&e!==s&&e&&s?(this.spaces[e].transfer===mt&&(t.r=kt(t.r),t.g=kt(t.g),t.b=kt(t.b)),this.spaces[e].primaries!==this.spaces[s].primaries&&(t.applyMatrix3(this.spaces[e].toXYZ),t.applyMatrix3(this.spaces[s].fromXYZ)),this.spaces[s].transfer===mt&&(t.r=Pt(t.r),t.g=Pt(t.g),t.b=Pt(t.b)),t):t},fromWorkingColorSpace:function(t,e){return this.convert(t,this.workingColorSpace,e)},toWorkingColorSpace:function(t,e){return this.convert(t,e,this.workingColorSpace)},getPrimaries:function(t){return this.spaces[t].primaries},getTransfer:function(t){return""===t?ft:this.spaces[t].transfer},getLuminanceCoefficients:function(t,e=this.workingColorSpace){return t.fromArray(this.spaces[e].luminanceCoefficients)},define:function(t){Object.assign(this.spaces,t)},_getMatrix:function(t,e,s){return t.copy(this.spaces[e].toXYZ).multiply(this.spaces[s].fromXYZ)},_getDrawingBufferColorSpace:function(t){return this.spaces[t].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(t=this.workingColorSpace){return this.spaces[t].workingColorSpaceConfig.unpackColorSpace}};function kt(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function Pt(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}const Ft=[.64,.33,.3,.6,.15,.06],Rt=[.2126,.7152,.0722],Lt=[.3127,.329],Ot=(new Tt).set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),Vt=(new Tt).set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);let Ut;Et.define({[pt]:{primaries:Ft,whitePoint:Lt,transfer:ft,toXYZ:Ot,fromXYZ:Vt,luminanceCoefficients:Rt,workingColorSpaceConfig:{unpackColorSpace:dt},outputColorSpaceConfig:{drawingBufferColorSpace:dt}},[dt]:{primaries:Ft,whitePoint:Lt,transfer:mt,toXYZ:Ot,fromXYZ:Vt,luminanceCoefficients:Rt,outputColorSpaceConfig:{drawingBufferColorSpace:dt}}});class Dt{static getDataURL(t){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===Ut&&(Ut=Ct("canvas")),Ut.width=t.width,Ut.height=t.height;const s=Ut.getContext("2d");t instanceof ImageData?s.putImageData(t,0,0):s.drawImage(t,0,0,t.width,t.height),e=Ut}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const e=Ct("canvas");e.width=t.width,e.height=t.height;const s=e.getContext("2d");s.drawImage(t,0,0,t.width,t.height);const i=s.getImageData(0,0,t.width,t.height),n=i.data;for(let t=0;t<n.length;t++)n[t]=255*kt(n[t]/255);return s.putImageData(i,0,0),e}if(t.data){const e=t.data.slice(0);for(let t=0;t<e.length;t++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[t]=Math.floor(255*kt(e[t]/255)):e[t]=kt(e[t]);return{data:e,width:t.width,height:t.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}let Nt=0;class Wt{constructor(t=null){this.isSource=!0,Object.defineProperty(this,"id",{value:Nt++}),this.uuid=wt(),this.data=t,this.dataReady=!0,this.version=0}set needsUpdate(t){!0===t&&this.version++}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.images[this.uuid])return t.images[this.uuid];const s={uuid:this.uuid,url:""},i=this.data;if(null!==i){let t;if(Array.isArray(i)){t=[];for(let e=0,s=i.length;e<s;e++)i[e].isDataTexture?t.push(Zt(i[e].image)):t.push(Zt(i[e]))}else t=Zt(i);s.url=t}return e||(t.images[this.uuid]=s),s}}function Zt(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?Dt.getDataURL(t):t.data?{data:Array.from(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let qt=0;class Ht extends _t{constructor(t=Ht.DEFAULT_IMAGE,e=Ht.DEFAULT_MAPPING,s=1001,i=1001,n=1006,r=1008,o=1023,a=1009,h=Ht.DEFAULT_ANISOTROPY,l=""){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:qt++}),this.uuid=wt(),this.name="",this.source=new Wt(t),this.mipmaps=[],this.mapping=e,this.channel=0,this.wrapS=s,this.wrapT=i,this.magFilter=n,this.minFilter=r,this.anisotropy=h,this.format=o,this.internalFormat=null,this.type=a,this.offset=new It(0,0),this.repeat=new It(1,1),this.center=new It(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Tt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=l,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const s={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(s.userData=this.userData),e||(t.textures[this.uuid]=s),s}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(300!==this.mapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case 1e3:t.x=t.x-Math.floor(t.x);break;case ut:t.x=t.x<0?0:1;break;case 1002:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case 1e3:t.y=t.y-Math.floor(t.y);break;case ut:t.y=t.y<0?0:1;break;case 1002:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(t){!0===t&&this.pmremVersion++}}Ht.DEFAULT_IMAGE=null,Ht.DEFAULT_MAPPING=300,Ht.DEFAULT_ANISOTROPY=1;class jt{constructor(t=0,e=0,s=0,i=1){jt.prototype.isVector4=!0,this.x=t,this.y=e,this.z=s,this.w=i}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,s,i){return this.x=t,this.y=e,this.z=s,this.w=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,s=this.y,i=this.z,n=this.w,r=t.elements;return this.x=r[0]*e+r[4]*s+r[8]*i+r[12]*n,this.y=r[1]*e+r[5]*s+r[9]*i+r[13]*n,this.z=r[2]*e+r[6]*s+r[10]*i+r[14]*n,this.w=r[3]*e+r[7]*s+r[11]*i+r[15]*n,this}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,s,i,n;const r=.01,o=.1,a=t.elements,h=a[0],l=a[4],c=a[8],u=a[1],d=a[5],p=a[9],f=a[2],m=a[6],b=a[10];if(Math.abs(l-u)<r&&Math.abs(c-f)<r&&Math.abs(p-m)<r){if(Math.abs(l+u)<o&&Math.abs(c+f)<o&&Math.abs(p+m)<o&&Math.abs(h+d+b-3)<o)return this.set(1,0,0,0),this;e=Math.PI;const t=(h+1)/2,a=(d+1)/2,y=(b+1)/2,g=(l+u)/4,_=(c+f)/4,x=(p+m)/4;return t>a&&t>y?t<r?(s=0,i=.707106781,n=.707106781):(s=Math.sqrt(t),i=g/s,n=_/s):a>y?a<r?(s=.707106781,i=0,n=.707106781):(i=Math.sqrt(a),s=g/i,n=x/i):y<r?(s=.707106781,i=.707106781,n=0):(n=Math.sqrt(y),s=_/n,i=x/n),this.set(s,i,n,e),this}let y=Math.sqrt((m-p)*(m-p)+(c-f)*(c-f)+(u-l)*(u-l));return Math.abs(y)<.001&&(y=1),this.x=(m-p)/y,this.y=(c-f)/y,this.z=(u-l)/y,this.w=Math.acos((h+d+b-1)/2),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this.w=e[15],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(t,Math.min(e,s)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,s){return this.x=t.x+(e.x-t.x)*s,this.y=t.y+(e.y-t.y)*s,this.z=t.z+(e.z-t.z)*s,this.w=t.w+(e.w-t.w)*s,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Gt{constructor(t=0,e=0,s=0,i=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=s,this._w=i}static slerpFlat(t,e,s,i,n,r,o){let a=s[i+0],h=s[i+1],l=s[i+2],c=s[i+3];const u=n[r+0],d=n[r+1],p=n[r+2],f=n[r+3];if(0===o)return t[e+0]=a,t[e+1]=h,t[e+2]=l,void(t[e+3]=c);if(1===o)return t[e+0]=u,t[e+1]=d,t[e+2]=p,void(t[e+3]=f);if(c!==f||a!==u||h!==d||l!==p){let t=1-o;const e=a*u+h*d+l*p+c*f,s=e>=0?1:-1,i=1-e*e;if(i>Number.EPSILON){const n=Math.sqrt(i),r=Math.atan2(n,e*s);t=Math.sin(t*r)/n,o=Math.sin(o*r)/n}const n=o*s;if(a=a*t+u*n,h=h*t+d*n,l=l*t+p*n,c=c*t+f*n,t===1-o){const t=1/Math.sqrt(a*a+h*h+l*l+c*c);a*=t,h*=t,l*=t,c*=t}}t[e]=a,t[e+1]=h,t[e+2]=l,t[e+3]=c}static multiplyQuaternionsFlat(t,e,s,i,n,r){const o=s[i],a=s[i+1],h=s[i+2],l=s[i+3],c=n[r],u=n[r+1],d=n[r+2],p=n[r+3];return t[e]=o*p+l*c+a*d-h*u,t[e+1]=a*p+l*u+h*c-o*d,t[e+2]=h*p+l*d+o*u-a*c,t[e+3]=l*p-o*c-a*u-h*d,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,s,i){return this._x=t,this._y=e,this._z=s,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e=!0){const s=t._x,i=t._y,n=t._z,r=t._order,o=Math.cos,a=Math.sin,h=o(s/2),l=o(i/2),c=o(n/2),u=a(s/2),d=a(i/2),p=a(n/2);switch(r){case"XYZ":this._x=u*l*c+h*d*p,this._y=h*d*c-u*l*p,this._z=h*l*p+u*d*c,this._w=h*l*c-u*d*p;break;case"YXZ":this._x=u*l*c+h*d*p,this._y=h*d*c-u*l*p,this._z=h*l*p-u*d*c,this._w=h*l*c+u*d*p;break;case"ZXY":this._x=u*l*c-h*d*p,this._y=h*d*c+u*l*p,this._z=h*l*p+u*d*c,this._w=h*l*c-u*d*p;break;case"ZYX":this._x=u*l*c-h*d*p,this._y=h*d*c+u*l*p,this._z=h*l*p-u*d*c,this._w=h*l*c+u*d*p;break;case"YZX":this._x=u*l*c+h*d*p,this._y=h*d*c+u*l*p,this._z=h*l*p-u*d*c,this._w=h*l*c-u*d*p;break;case"XZY":this._x=u*l*c-h*d*p,this._y=h*d*c-u*l*p,this._z=h*l*p+u*d*c,this._w=h*l*c+u*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+r)}return!0===e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const s=e/2,i=Math.sin(s);return this._x=t.x*i,this._y=t.y*i,this._z=t.z*i,this._w=Math.cos(s),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,s=e[0],i=e[4],n=e[8],r=e[1],o=e[5],a=e[9],h=e[2],l=e[6],c=e[10],u=s+o+c;if(u>0){const t=.5/Math.sqrt(u+1);this._w=.25/t,this._x=(l-a)*t,this._y=(n-h)*t,this._z=(r-i)*t}else if(s>o&&s>c){const t=2*Math.sqrt(1+s-o-c);this._w=(l-a)/t,this._x=.25*t,this._y=(i+r)/t,this._z=(n+h)/t}else if(o>c){const t=2*Math.sqrt(1+o-s-c);this._w=(n-h)/t,this._x=(i+r)/t,this._y=.25*t,this._z=(a+l)/t}else{const t=2*Math.sqrt(1+c-s-o);this._w=(r-i)/t,this._x=(n+h)/t,this._y=(a+l)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let s=t.dot(e)+1;return s<Number.EPSILON?(s=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=s):(this._x=0,this._y=-t.z,this._z=t.y,this._w=s)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=s),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(vt(this.dot(t),-1,1)))}rotateTowards(t,e){const s=this.angleTo(t);if(0===s)return this;const i=Math.min(1,e/s);return this.slerp(t,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const s=t._x,i=t._y,n=t._z,r=t._w,o=e._x,a=e._y,h=e._z,l=e._w;return this._x=s*l+r*o+i*h-n*a,this._y=i*l+r*a+n*o-s*h,this._z=n*l+r*h+s*a-i*o,this._w=r*l-s*o-i*a-n*h,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const s=this._x,i=this._y,n=this._z,r=this._w;let o=r*t._w+s*t._x+i*t._y+n*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=r,this._x=s,this._y=i,this._z=n,this;const a=1-o*o;if(a<=Number.EPSILON){const t=1-e;return this._w=t*r+e*this._w,this._x=t*s+e*this._x,this._y=t*i+e*this._y,this._z=t*n+e*this._z,this.normalize(),this}const h=Math.sqrt(a),l=Math.atan2(h,o),c=Math.sin((1-e)*l)/h,u=Math.sin(e*l)/h;return this._w=r*c+this._w*u,this._x=s*c+this._x*u,this._y=i*c+this._y*u,this._z=n*c+this._z*u,this._onChangeCallback(),this}slerpQuaternions(t,e,s){return this.copy(t).slerp(e,s)}random(){const t=2*Math.PI*Math.random(),e=2*Math.PI*Math.random(),s=Math.random(),i=Math.sqrt(1-s),n=Math.sqrt(s);return this.set(i*Math.sin(t),i*Math.cos(t),n*Math.sin(e),n*Math.cos(e))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Yt{constructor(t=0,e=0,s=0){Yt.prototype.isVector3=!0,this.x=t,this.y=e,this.z=s}set(t,e,s){return void 0===s&&(s=this.z),this.x=t,this.y=e,this.z=s,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(Jt.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(Jt.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,s=this.y,i=this.z,n=t.elements;return this.x=n[0]*e+n[3]*s+n[6]*i,this.y=n[1]*e+n[4]*s+n[7]*i,this.z=n[2]*e+n[5]*s+n[8]*i,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,s=this.y,i=this.z,n=t.elements,r=1/(n[3]*e+n[7]*s+n[11]*i+n[15]);return this.x=(n[0]*e+n[4]*s+n[8]*i+n[12])*r,this.y=(n[1]*e+n[5]*s+n[9]*i+n[13])*r,this.z=(n[2]*e+n[6]*s+n[10]*i+n[14])*r,this}applyQuaternion(t){const e=this.x,s=this.y,i=this.z,n=t.x,r=t.y,o=t.z,a=t.w,h=2*(r*i-o*s),l=2*(o*e-n*i),c=2*(n*s-r*e);return this.x=e+a*h+r*c-o*l,this.y=s+a*l+o*h-n*c,this.z=i+a*c+n*l-r*h,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,s=this.y,i=this.z,n=t.elements;return this.x=n[0]*e+n[4]*s+n[8]*i,this.y=n[1]*e+n[5]*s+n[9]*i,this.z=n[2]*e+n[6]*s+n[10]*i,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(t,Math.min(e,s)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,s){return this.x=t.x+(e.x-t.x)*s,this.y=t.y+(e.y-t.y)*s,this.z=t.z+(e.z-t.z)*s,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const s=t.x,i=t.y,n=t.z,r=e.x,o=e.y,a=e.z;return this.x=i*a-n*o,this.y=n*r-s*a,this.z=s*o-i*r,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const s=t.dot(this)/e;return this.copy(t).multiplyScalar(s)}projectOnPlane(t){return Xt.copy(this).projectOnVector(t),this.sub(Xt)}reflect(t){return this.sub(Xt.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const s=this.dot(t)/e;return Math.acos(vt(s,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,s=this.y-t.y,i=this.z-t.z;return e*e+s*s+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,s){const i=Math.sin(e)*t;return this.x=i*Math.sin(s),this.y=Math.cos(e)*t,this.z=i*Math.cos(s),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,s){return this.x=t*Math.sin(e),this.y=s,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),s=this.setFromMatrixColumn(t,1).length(),i=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=s,this.z=i,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=Math.random()*Math.PI*2,e=2*Math.random()-1,s=Math.sqrt(1-e*e);return this.x=s*Math.cos(t),this.y=e,this.z=s*Math.sin(t),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Xt=new Yt,Jt=new Gt;class Qt{constructor(t=new Yt(1/0,1/0,1/0),e=new Yt(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){this.makeEmpty();for(let e=0,s=t.length;e<s;e+=3)this.expandByPoint(Kt.fromArray(t,e));return this}setFromBufferAttribute(t){this.makeEmpty();for(let e=0,s=t.count;e<s;e++)this.expandByPoint(Kt.fromBufferAttribute(t,e));return this}setFromPoints(t){this.makeEmpty();for(let e=0,s=t.length;e<s;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const s=Kt.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(s),this.max.copy(t).add(s),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const s=t.geometry;if(void 0!==s){const i=s.getAttribute("position");if(!0===e&&void 0!==i&&!0!==t.isInstancedMesh)for(let e=0,s=i.count;e<s;e++)!0===t.isMesh?t.getVertexPosition(e,Kt):Kt.fromBufferAttribute(i,e),Kt.applyMatrix4(t.matrixWorld),this.expandByPoint(Kt);else void 0!==t.boundingBox?(null===t.boundingBox&&t.computeBoundingBox(),te.copy(t.boundingBox)):(null===s.boundingBox&&s.computeBoundingBox(),te.copy(s.boundingBox)),te.applyMatrix4(t.matrixWorld),this.union(te)}const i=t.children;for(let t=0,s=i.length;t<s;t++)this.expandByObject(i[t],e);return this}containsPoint(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y&&t.z>=this.min.z&&t.z<=this.max.z}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return t.max.x>=this.min.x&&t.min.x<=this.max.x&&t.max.y>=this.min.y&&t.min.y<=this.max.y&&t.max.z>=this.min.z&&t.min.z<=this.max.z}intersectsSphere(t){return this.clampPoint(t.center,Kt),Kt.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,s;return t.normal.x>0?(e=t.normal.x*this.min.x,s=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,s=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,s+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,s+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,s+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,s+=t.normal.z*this.min.z),e<=-t.constant&&s>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(ae),he.subVectors(this.max,ae),ee.subVectors(t.a,ae),se.subVectors(t.b,ae),ie.subVectors(t.c,ae),ne.subVectors(se,ee),re.subVectors(ie,se),oe.subVectors(ee,ie);let e=[0,-ne.z,ne.y,0,-re.z,re.y,0,-oe.z,oe.y,ne.z,0,-ne.x,re.z,0,-re.x,oe.z,0,-oe.x,-ne.y,ne.x,0,-re.y,re.x,0,-oe.y,oe.x,0];return!!ue(e,ee,se,ie,he)&&(e=[1,0,0,0,1,0,0,0,1],!!ue(e,ee,se,ie,he)&&(le.crossVectors(ne,re),e=[le.x,le.y,le.z],ue(e,ee,se,ie,he)))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,Kt).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=.5*this.getSize(Kt).length()),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||($t[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),$t[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),$t[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),$t[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),$t[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),$t[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),$t[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),$t[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints($t)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const $t=[new Yt,new Yt,new Yt,new Yt,new Yt,new Yt,new Yt,new Yt],Kt=new Yt,te=new Qt,ee=new Yt,se=new Yt,ie=new Yt,ne=new Yt,re=new Yt,oe=new Yt,ae=new Yt,he=new Yt,le=new Yt,ce=new Yt;function ue(t,e,s,i,n){for(let r=0,o=t.length-3;r<=o;r+=3){ce.fromArray(t,r);const o=n.x*Math.abs(ce.x)+n.y*Math.abs(ce.y)+n.z*Math.abs(ce.z),a=e.dot(ce),h=s.dot(ce),l=i.dot(ce);if(Math.max(-Math.max(a,h,l),Math.min(a,h,l))>o)return!1}return!0}const de=new Qt,pe=new Yt,fe=new Yt;class me{constructor(t=new Yt,e=-1){this.isSphere=!0,this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const s=this.center;void 0!==e?s.copy(e):de.setFromPoints(t).getCenter(s);let i=0;for(let e=0,n=t.length;e<n;e++)i=Math.max(i,s.distanceToSquared(t[e]));return this.radius=Math.sqrt(i),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const s=this.center.distanceToSquared(t);return e.copy(t),s>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;pe.subVectors(t,this.center);const e=pe.lengthSq();if(e>this.radius*this.radius){const t=Math.sqrt(e),s=.5*(t-this.radius);this.center.addScaledVector(pe,s/t),this.radius+=s}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(!0===this.center.equals(t.center)?this.radius=Math.max(this.radius,t.radius):(fe.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(pe.copy(t.center).add(fe)),this.expandByPoint(pe.copy(t.center).sub(fe))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const be=new Yt,ye=new Yt,ge=new Yt,_e=new Yt,xe=new Yt,we=new Yt,ve=new Yt;class Me{constructor(t=new Yt,e=new Yt(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.origin).addScaledVector(this.direction,t)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,be)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const s=e.dot(this.direction);return s<0?e.copy(this.origin):e.copy(this.origin).addScaledVector(this.direction,s)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=be.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(be.copy(this.origin).addScaledVector(this.direction,e),be.distanceToSquared(t))}distanceSqToSegment(t,e,s,i){ye.copy(t).add(e).multiplyScalar(.5),ge.copy(e).sub(t).normalize(),_e.copy(this.origin).sub(ye);const n=.5*t.distanceTo(e),r=-this.direction.dot(ge),o=_e.dot(this.direction),a=-_e.dot(ge),h=_e.lengthSq(),l=Math.abs(1-r*r);let c,u,d,p;if(l>0)if(c=r*a-o,u=r*o-a,p=n*l,c>=0)if(u>=-p)if(u<=p){const t=1/l;c*=t,u*=t,d=c*(c+r*u+2*o)+u*(r*c+u+2*a)+h}else u=n,c=Math.max(0,-(r*u+o)),d=-c*c+u*(u+2*a)+h;else u=-n,c=Math.max(0,-(r*u+o)),d=-c*c+u*(u+2*a)+h;else u<=-p?(c=Math.max(0,-(-r*n+o)),u=c>0?-n:Math.min(Math.max(-n,-a),n),d=-c*c+u*(u+2*a)+h):u<=p?(c=0,u=Math.min(Math.max(-n,-a),n),d=u*(u+2*a)+h):(c=Math.max(0,-(r*n+o)),u=c>0?n:Math.min(Math.max(-n,-a),n),d=-c*c+u*(u+2*a)+h);else u=r>0?-n:n,c=Math.max(0,-(r*u+o)),d=-c*c+u*(u+2*a)+h;return s&&s.copy(this.origin).addScaledVector(this.direction,c),i&&i.copy(ye).addScaledVector(ge,u),d}intersectSphere(t,e){be.subVectors(t.center,this.origin);const s=be.dot(this.direction),i=be.dot(be)-s*s,n=t.radius*t.radius;if(i>n)return null;const r=Math.sqrt(n-i),o=s-r,a=s+r;return a<0?null:o<0?this.at(a,e):this.at(o,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;const s=-(this.origin.dot(t.normal)+t.constant)/e;return s>=0?s:null}intersectPlane(t,e){const s=this.distanceToPlane(t);return null===s?null:this.at(s,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);if(0===e)return!0;return t.normal.dot(this.direction)*e<0}intersectBox(t,e){let s,i,n,r,o,a;const h=1/this.direction.x,l=1/this.direction.y,c=1/this.direction.z,u=this.origin;return h>=0?(s=(t.min.x-u.x)*h,i=(t.max.x-u.x)*h):(s=(t.max.x-u.x)*h,i=(t.min.x-u.x)*h),l>=0?(n=(t.min.y-u.y)*l,r=(t.max.y-u.y)*l):(n=(t.max.y-u.y)*l,r=(t.min.y-u.y)*l),s>r||n>i?null:((n>s||isNaN(s))&&(s=n),(r<i||isNaN(i))&&(i=r),c>=0?(o=(t.min.z-u.z)*c,a=(t.max.z-u.z)*c):(o=(t.max.z-u.z)*c,a=(t.min.z-u.z)*c),s>a||o>i?null:((o>s||s!=s)&&(s=o),(a<i||i!=i)&&(i=a),i<0?null:this.at(s>=0?s:i,e)))}intersectsBox(t){return null!==this.intersectBox(t,be)}intersectTriangle(t,e,s,i,n){xe.subVectors(e,t),we.subVectors(s,t),ve.crossVectors(xe,we);let r,o=this.direction.dot(ve);if(o>0){if(i)return null;r=1}else{if(!(o<0))return null;r=-1,o=-o}_e.subVectors(this.origin,t);const a=r*this.direction.dot(we.crossVectors(_e,we));if(a<0)return null;const h=r*this.direction.dot(xe.cross(_e));if(h<0)return null;if(a+h>o)return null;const l=-r*_e.dot(ve);return l<0?null:this.at(l/o,n)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Ae{constructor(t,e,s,i,n,r,o,a,h,l,c,u,d,p,f,m){Ae.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==t&&this.set(t,e,s,i,n,r,o,a,h,l,c,u,d,p,f,m)}set(t,e,s,i,n,r,o,a,h,l,c,u,d,p,f,m){const b=this.elements;return b[0]=t,b[4]=e,b[8]=s,b[12]=i,b[1]=n,b[5]=r,b[9]=o,b[13]=a,b[2]=h,b[6]=l,b[10]=c,b[14]=u,b[3]=d,b[7]=p,b[11]=f,b[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Ae).fromArray(this.elements)}copy(t){const e=this.elements,s=t.elements;return e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3],e[4]=s[4],e[5]=s[5],e[6]=s[6],e[7]=s[7],e[8]=s[8],e[9]=s[9],e[10]=s[10],e[11]=s[11],e[12]=s[12],e[13]=s[13],e[14]=s[14],e[15]=s[15],this}copyPosition(t){const e=this.elements,s=t.elements;return e[12]=s[12],e[13]=s[13],e[14]=s[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,s){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),s.setFromMatrixColumn(this,2),this}makeBasis(t,e,s){return this.set(t.x,e.x,s.x,0,t.y,e.y,s.y,0,t.z,e.z,s.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,s=t.elements,i=1/Se.setFromMatrixColumn(t,0).length(),n=1/Se.setFromMatrixColumn(t,1).length(),r=1/Se.setFromMatrixColumn(t,2).length();return e[0]=s[0]*i,e[1]=s[1]*i,e[2]=s[2]*i,e[3]=0,e[4]=s[4]*n,e[5]=s[5]*n,e[6]=s[6]*n,e[7]=0,e[8]=s[8]*r,e[9]=s[9]*r,e[10]=s[10]*r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,s=t.x,i=t.y,n=t.z,r=Math.cos(s),o=Math.sin(s),a=Math.cos(i),h=Math.sin(i),l=Math.cos(n),c=Math.sin(n);if("XYZ"===t.order){const t=r*l,s=r*c,i=o*l,n=o*c;e[0]=a*l,e[4]=-a*c,e[8]=h,e[1]=s+i*h,e[5]=t-n*h,e[9]=-o*a,e[2]=n-t*h,e[6]=i+s*h,e[10]=r*a}else if("YXZ"===t.order){const t=a*l,s=a*c,i=h*l,n=h*c;e[0]=t+n*o,e[4]=i*o-s,e[8]=r*h,e[1]=r*c,e[5]=r*l,e[9]=-o,e[2]=s*o-i,e[6]=n+t*o,e[10]=r*a}else if("ZXY"===t.order){const t=a*l,s=a*c,i=h*l,n=h*c;e[0]=t-n*o,e[4]=-r*c,e[8]=i+s*o,e[1]=s+i*o,e[5]=r*l,e[9]=n-t*o,e[2]=-r*h,e[6]=o,e[10]=r*a}else if("ZYX"===t.order){const t=r*l,s=r*c,i=o*l,n=o*c;e[0]=a*l,e[4]=i*h-s,e[8]=t*h+n,e[1]=a*c,e[5]=n*h+t,e[9]=s*h-i,e[2]=-h,e[6]=o*a,e[10]=r*a}else if("YZX"===t.order){const t=r*a,s=r*h,i=o*a,n=o*h;e[0]=a*l,e[4]=n-t*c,e[8]=i*c+s,e[1]=c,e[5]=r*l,e[9]=-o*l,e[2]=-h*l,e[6]=s*c+i,e[10]=t-n*c}else if("XZY"===t.order){const t=r*a,s=r*h,i=o*a,n=o*h;e[0]=a*l,e[4]=-c,e[8]=h*l,e[1]=t*c+n,e[5]=r*l,e[9]=s*c-i,e[2]=i*c-s,e[6]=o*l,e[10]=n*c+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(Ie,t,Te)}lookAt(t,e,s){const i=this.elements;return Ee.subVectors(t,e),0===Ee.lengthSq()&&(Ee.z=1),Ee.normalize(),Be.crossVectors(s,Ee),0===Be.lengthSq()&&(1===Math.abs(s.z)?Ee.x+=1e-4:Ee.z+=1e-4,Ee.normalize(),Be.crossVectors(s,Ee)),Be.normalize(),Ce.crossVectors(Ee,Be),i[0]=Be.x,i[4]=Ce.x,i[8]=Ee.x,i[1]=Be.y,i[5]=Ce.y,i[9]=Ee.y,i[2]=Be.z,i[6]=Ce.z,i[10]=Ee.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const s=t.elements,i=e.elements,n=this.elements,r=s[0],o=s[4],a=s[8],h=s[12],l=s[1],c=s[5],u=s[9],d=s[13],p=s[2],f=s[6],m=s[10],b=s[14],y=s[3],g=s[7],_=s[11],x=s[15],w=i[0],v=i[4],M=i[8],A=i[12],S=i[1],z=i[5],I=i[9],T=i[13],B=i[2],C=i[6],E=i[10],k=i[14],P=i[3],F=i[7],R=i[11],L=i[15];return n[0]=r*w+o*S+a*B+h*P,n[4]=r*v+o*z+a*C+h*F,n[8]=r*M+o*I+a*E+h*R,n[12]=r*A+o*T+a*k+h*L,n[1]=l*w+c*S+u*B+d*P,n[5]=l*v+c*z+u*C+d*F,n[9]=l*M+c*I+u*E+d*R,n[13]=l*A+c*T+u*k+d*L,n[2]=p*w+f*S+m*B+b*P,n[6]=p*v+f*z+m*C+b*F,n[10]=p*M+f*I+m*E+b*R,n[14]=p*A+f*T+m*k+b*L,n[3]=y*w+g*S+_*B+x*P,n[7]=y*v+g*z+_*C+x*F,n[11]=y*M+g*I+_*E+x*R,n[15]=y*A+g*T+_*k+x*L,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],s=t[4],i=t[8],n=t[12],r=t[1],o=t[5],a=t[9],h=t[13],l=t[2],c=t[6],u=t[10],d=t[14];return t[3]*(+n*a*c-i*h*c-n*o*u+s*h*u+i*o*d-s*a*d)+t[7]*(+e*a*d-e*h*u+n*r*u-i*r*d+i*h*l-n*a*l)+t[11]*(+e*h*c-e*o*d-n*r*c+s*r*d+n*o*l-s*h*l)+t[15]*(-i*o*l-e*a*c+e*o*u+i*r*c-s*r*u+s*a*l)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,s){const i=this.elements;return t.isVector3?(i[12]=t.x,i[13]=t.y,i[14]=t.z):(i[12]=t,i[13]=e,i[14]=s),this}invert(){const t=this.elements,e=t[0],s=t[1],i=t[2],n=t[3],r=t[4],o=t[5],a=t[6],h=t[7],l=t[8],c=t[9],u=t[10],d=t[11],p=t[12],f=t[13],m=t[14],b=t[15],y=c*m*h-f*u*h+f*a*d-o*m*d-c*a*b+o*u*b,g=p*u*h-l*m*h-p*a*d+r*m*d+l*a*b-r*u*b,_=l*f*h-p*c*h+p*o*d-r*f*d-l*o*b+r*c*b,x=p*c*a-l*f*a-p*o*u+r*f*u+l*o*m-r*c*m,w=e*y+s*g+i*_+n*x;if(0===w)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const v=1/w;return t[0]=y*v,t[1]=(f*u*n-c*m*n-f*i*d+s*m*d+c*i*b-s*u*b)*v,t[2]=(o*m*n-f*a*n+f*i*h-s*m*h-o*i*b+s*a*b)*v,t[3]=(c*a*n-o*u*n-c*i*h+s*u*h+o*i*d-s*a*d)*v,t[4]=g*v,t[5]=(l*m*n-p*u*n+p*i*d-e*m*d-l*i*b+e*u*b)*v,t[6]=(p*a*n-r*m*n-p*i*h+e*m*h+r*i*b-e*a*b)*v,t[7]=(r*u*n-l*a*n+l*i*h-e*u*h-r*i*d+e*a*d)*v,t[8]=_*v,t[9]=(p*c*n-l*f*n-p*s*d+e*f*d+l*s*b-e*c*b)*v,t[10]=(r*f*n-p*o*n+p*s*h-e*f*h-r*s*b+e*o*b)*v,t[11]=(l*o*n-r*c*n-l*s*h+e*c*h+r*s*d-e*o*d)*v,t[12]=x*v,t[13]=(l*f*i-p*c*i+p*s*u-e*f*u-l*s*m+e*c*m)*v,t[14]=(p*o*i-r*f*i-p*s*a+e*f*a+r*s*m-e*o*m)*v,t[15]=(r*c*i-l*o*i+l*s*a-e*c*a-r*s*u+e*o*u)*v,this}scale(t){const e=this.elements,s=t.x,i=t.y,n=t.z;return e[0]*=s,e[4]*=i,e[8]*=n,e[1]*=s,e[5]*=i,e[9]*=n,e[2]*=s,e[6]*=i,e[10]*=n,e[3]*=s,e[7]*=i,e[11]*=n,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],s=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],i=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,s,i))}makeTranslation(t,e,s){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,e,0,0,1,s,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),s=Math.sin(t);return this.set(1,0,0,0,0,e,-s,0,0,s,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),s=Math.sin(t);return this.set(e,0,s,0,0,1,0,0,-s,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),s=Math.sin(t);return this.set(e,-s,0,0,s,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const s=Math.cos(e),i=Math.sin(e),n=1-s,r=t.x,o=t.y,a=t.z,h=n*r,l=n*o;return this.set(h*r+s,h*o-i*a,h*a+i*o,0,h*o+i*a,l*o+s,l*a-i*r,0,h*a-i*o,l*a+i*r,n*a*a+s,0,0,0,0,1),this}makeScale(t,e,s){return this.set(t,0,0,0,0,e,0,0,0,0,s,0,0,0,0,1),this}makeShear(t,e,s,i,n,r){return this.set(1,s,n,0,t,1,r,0,e,i,1,0,0,0,0,1),this}compose(t,e,s){const i=this.elements,n=e._x,r=e._y,o=e._z,a=e._w,h=n+n,l=r+r,c=o+o,u=n*h,d=n*l,p=n*c,f=r*l,m=r*c,b=o*c,y=a*h,g=a*l,_=a*c,x=s.x,w=s.y,v=s.z;return i[0]=(1-(f+b))*x,i[1]=(d+_)*x,i[2]=(p-g)*x,i[3]=0,i[4]=(d-_)*w,i[5]=(1-(u+b))*w,i[6]=(m+y)*w,i[7]=0,i[8]=(p+g)*v,i[9]=(m-y)*v,i[10]=(1-(u+f))*v,i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1,this}decompose(t,e,s){const i=this.elements;let n=Se.set(i[0],i[1],i[2]).length();const r=Se.set(i[4],i[5],i[6]).length(),o=Se.set(i[8],i[9],i[10]).length();this.determinant()<0&&(n=-n),t.x=i[12],t.y=i[13],t.z=i[14],ze.copy(this);const a=1/n,h=1/r,l=1/o;return ze.elements[0]*=a,ze.elements[1]*=a,ze.elements[2]*=a,ze.elements[4]*=h,ze.elements[5]*=h,ze.elements[6]*=h,ze.elements[8]*=l,ze.elements[9]*=l,ze.elements[10]*=l,e.setFromRotationMatrix(ze),s.x=n,s.y=r,s.z=o,this}makePerspective(t,e,s,i,n,r,o=2e3){const a=this.elements,h=2*n/(e-t),l=2*n/(s-i),c=(e+t)/(e-t),u=(s+i)/(s-i);let d,p;if(o===yt)d=-(r+n)/(r-n),p=-2*r*n/(r-n);else{if(o!==gt)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);d=-r/(r-n),p=-r*n/(r-n)}return a[0]=h,a[4]=0,a[8]=c,a[12]=0,a[1]=0,a[5]=l,a[9]=u,a[13]=0,a[2]=0,a[6]=0,a[10]=d,a[14]=p,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(t,e,s,i,n,r,o=2e3){const a=this.elements,h=1/(e-t),l=1/(s-i),c=1/(r-n),u=(e+t)*h,d=(s+i)*l;let p,f;if(o===yt)p=(r+n)*c,f=-2*c;else{if(o!==gt)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);p=n*c,f=-1*c}return a[0]=2*h,a[4]=0,a[8]=0,a[12]=-u,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-d,a[2]=0,a[6]=0,a[10]=f,a[14]=-p,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(t){const e=this.elements,s=t.elements;for(let t=0;t<16;t++)if(e[t]!==s[t])return!1;return!0}fromArray(t,e=0){for(let s=0;s<16;s++)this.elements[s]=t[s+e];return this}toArray(t=[],e=0){const s=this.elements;return t[e]=s[0],t[e+1]=s[1],t[e+2]=s[2],t[e+3]=s[3],t[e+4]=s[4],t[e+5]=s[5],t[e+6]=s[6],t[e+7]=s[7],t[e+8]=s[8],t[e+9]=s[9],t[e+10]=s[10],t[e+11]=s[11],t[e+12]=s[12],t[e+13]=s[13],t[e+14]=s[14],t[e+15]=s[15],t}}const Se=new Yt,ze=new Ae,Ie=new Yt(0,0,0),Te=new Yt(1,1,1),Be=new Yt,Ce=new Yt,Ee=new Yt,ke=new Ae,Pe=new Gt;class Fe{constructor(t=0,e=0,s=0,i=Fe.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=e,this._z=s,this._order=i}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,s,i=this._order){return this._x=t,this._y=e,this._z=s,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,s=!0){const i=t.elements,n=i[0],r=i[4],o=i[8],a=i[1],h=i[5],l=i[9],c=i[2],u=i[6],d=i[10];switch(e){case"XYZ":this._y=Math.asin(vt(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-l,d),this._z=Math.atan2(-r,n)):(this._x=Math.atan2(u,h),this._z=0);break;case"YXZ":this._x=Math.asin(-vt(l,-1,1)),Math.abs(l)<.9999999?(this._y=Math.atan2(o,d),this._z=Math.atan2(a,h)):(this._y=Math.atan2(-c,n),this._z=0);break;case"ZXY":this._x=Math.asin(vt(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-c,d),this._z=Math.atan2(-r,h)):(this._y=0,this._z=Math.atan2(a,n));break;case"ZYX":this._y=Math.asin(-vt(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(u,d),this._z=Math.atan2(a,n)):(this._x=0,this._z=Math.atan2(-r,h));break;case"YZX":this._z=Math.asin(vt(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-l,h),this._y=Math.atan2(-c,n)):(this._x=0,this._y=Math.atan2(o,d));break;case"XZY":this._z=Math.asin(-vt(r,-1,1)),Math.abs(r)<.9999999?(this._x=Math.atan2(u,h),this._y=Math.atan2(o,n)):(this._x=Math.atan2(-l,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!0===s&&this._onChangeCallback(),this}setFromQuaternion(t,e,s){return ke.makeRotationFromQuaternion(t),this.setFromRotationMatrix(ke,e,s)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return Pe.setFromEuler(this),this.setFromQuaternion(Pe,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Fe.DEFAULT_ORDER="XYZ";class Re{constructor(){this.mask=1}set(t){this.mask=1<<t>>>0}enable(t){this.mask|=1<<t}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t}disable(t){this.mask&=~(1<<t)}disableAll(){this.mask=0}test(t){return!!(this.mask&t.mask)}isEnabled(t){return!!(this.mask&1<<t)}}let Le=0;const Oe=new Yt,Ve=new Gt,Ue=new Ae,De=new Yt,Ne=new Yt,We=new Yt,Ze=new Gt,qe=new Yt(1,0,0),He=new Yt(0,1,0),je=new Yt(0,0,1),Ge={type:"added"},Ye={type:"removed"},Xe={type:"childadded",child:null},Je={type:"childremoved",child:null};class Qe extends _t{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Le++}),this.uuid=wt(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Qe.DEFAULT_UP.clone();const t=new Yt,e=new Fe,s=new Gt,i=new Yt(1,1,1);e._onChange((function(){s.setFromEuler(e,!1)})),s._onChange((function(){e.setFromQuaternion(s,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:s},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new Ae},normalMatrix:{value:new Tt}}),this.matrix=new Ae,this.matrixWorld=new Ae,this.matrixAutoUpdate=Qe.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Qe.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Re,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return Ve.setFromAxisAngle(t,e),this.quaternion.multiply(Ve),this}rotateOnWorldAxis(t,e){return Ve.setFromAxisAngle(t,e),this.quaternion.premultiply(Ve),this}rotateX(t){return this.rotateOnAxis(qe,t)}rotateY(t){return this.rotateOnAxis(He,t)}rotateZ(t){return this.rotateOnAxis(je,t)}translateOnAxis(t,e){return Oe.copy(t).applyQuaternion(this.quaternion),this.position.add(Oe.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(qe,t)}translateY(t){return this.translateOnAxis(He,t)}translateZ(t){return this.translateOnAxis(je,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(Ue.copy(this.matrixWorld).invert())}lookAt(t,e,s){t.isVector3?De.copy(t):De.set(t,e,s);const i=this.parent;this.updateWorldMatrix(!0,!1),Ne.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Ue.lookAt(Ne,De,this.up):Ue.lookAt(De,Ne,this.up),this.quaternion.setFromRotationMatrix(Ue),i&&(Ue.extractRotation(i.matrixWorld),Ve.setFromRotationMatrix(Ue),this.quaternion.premultiply(Ve.invert()))}add(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.removeFromParent(),t.parent=this,this.children.push(t),t.dispatchEvent(Ge),Xe.child=t,this.dispatchEvent(Xe),Xe.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(Ye),Je.child=t,this.dispatchEvent(Je),Je.child=null),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),Ue.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),Ue.multiply(t.parent.matrixWorld)),t.applyMatrix4(Ue),t.removeFromParent(),t.parent=this,this.children.push(t),t.updateWorldMatrix(!1,!0),t.dispatchEvent(Ge),Xe.child=t,this.dispatchEvent(Xe),Xe.child=null,this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let s=0,i=this.children.length;s<i;s++){const i=this.children[s].getObjectByProperty(t,e);if(void 0!==i)return i}}getObjectsByProperty(t,e,s=[]){this[t]===e&&s.push(this);const i=this.children;for(let n=0,r=i.length;n<r;n++)i[n].getObjectsByProperty(t,e,s);return s}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ne,t,We),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ne,Ze,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let s=0,i=e.length;s<i;s++)e[s].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const e=this.children;for(let s=0,i=e.length;s<i;s++)e[s].traverseVisible(t)}traverseAncestors(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let s=0,i=e.length;s<i;s++){e[s].updateMatrixWorld(t)}}updateWorldMatrix(t,e){const s=this.parent;if(!0===t&&null!==s&&s.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),!0===e){const t=this.children;for(let e=0,s=t.length;e<s;e++){t[e].updateWorldMatrix(!1,!0)}}}toJSON(t){const e=void 0===t||"string"==typeof t,s={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},s.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const i={};function n(e,s){return void 0===e[s.uuid]&&(e[s.uuid]=s.toJSON(t)),s.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.visibility=this._visibility,i.active=this._active,i.bounds=this._bounds.map((t=>({boxInitialized:t.boxInitialized,boxMin:t.box.min.toArray(),boxMax:t.box.max.toArray(),sphereInitialized:t.sphereInitialized,sphereRadius:t.sphere.radius,sphereCenter:t.sphere.center.toArray()}))),i.maxInstanceCount=this._maxInstanceCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.geometryCount=this._geometryCount,i.matricesTexture=this._matricesTexture.toJSON(t),null!==this._colorsTexture&&(i.colorsTexture=this._colorsTexture.toJSON(t)),null!==this.boundingSphere&&(i.boundingSphere={center:i.boundingSphere.center.toArray(),radius:i.boundingSphere.radius}),null!==this.boundingBox&&(i.boundingBox={min:i.boundingBox.min.toArray(),max:i.boundingBox.max.toArray()})),this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(i.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=n(t.geometries,this.geometry);const e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){const s=e.shapes;if(Array.isArray(s))for(let e=0,i=s.length;e<i;e++){const i=s[e];n(t.shapes,i)}else n(t.shapes,s)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(n(t.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const e=[];for(let s=0,i=this.material.length;s<i;s++)e.push(n(t.materials,this.material[s]));i.material=e}else i.material=n(t.materials,this.material);if(this.children.length>0){i.children=[];for(let e=0;e<this.children.length;e++)i.children.push(this.children[e].toJSON(t).object)}if(this.animations.length>0){i.animations=[];for(let e=0;e<this.animations.length;e++){const s=this.animations[e];i.animations.push(n(t.animations,s))}}if(e){const e=r(t.geometries),i=r(t.materials),n=r(t.textures),o=r(t.images),a=r(t.shapes),h=r(t.skeletons),l=r(t.animations),c=r(t.nodes);e.length>0&&(s.geometries=e),i.length>0&&(s.materials=i),n.length>0&&(s.textures=n),o.length>0&&(s.images=o),a.length>0&&(s.shapes=a),h.length>0&&(s.skeletons=h),l.length>0&&(s.animations=l),c.length>0&&(s.nodes=c)}return s.object=i,s;function r(t){const e=[];for(const s in t){const i=t[s];delete i.metadata,e.push(i)}return e}}clone(t){return(new this.constructor).copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let e=0;e<t.children.length;e++){const s=t.children[e];this.add(s.clone())}return this}}Qe.DEFAULT_UP=new Yt(0,1,0),Qe.DEFAULT_MATRIX_AUTO_UPDATE=!0,Qe.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const $e=new Yt,Ke=new Yt,ts=new Yt,es=new Yt,ss=new Yt,is=new Yt,ns=new Yt,rs=new Yt,os=new Yt,as=new Yt,hs=new jt,ls=new jt,cs=new jt;class us{constructor(t=new Yt,e=new Yt,s=new Yt){this.a=t,this.b=e,this.c=s}static getNormal(t,e,s,i){i.subVectors(s,e),$e.subVectors(t,e),i.cross($e);const n=i.lengthSq();return n>0?i.multiplyScalar(1/Math.sqrt(n)):i.set(0,0,0)}static getBarycoord(t,e,s,i,n){$e.subVectors(i,e),Ke.subVectors(s,e),ts.subVectors(t,e);const r=$e.dot($e),o=$e.dot(Ke),a=$e.dot(ts),h=Ke.dot(Ke),l=Ke.dot(ts),c=r*h-o*o;if(0===c)return n.set(0,0,0),null;const u=1/c,d=(h*a-o*l)*u,p=(r*l-o*a)*u;return n.set(1-d-p,p,d)}static containsPoint(t,e,s,i){return null!==this.getBarycoord(t,e,s,i,es)&&(es.x>=0&&es.y>=0&&es.x+es.y<=1)}static getInterpolation(t,e,s,i,n,r,o,a){return null===this.getBarycoord(t,e,s,i,es)?(a.x=0,a.y=0,"z"in a&&(a.z=0),"w"in a&&(a.w=0),null):(a.setScalar(0),a.addScaledVector(n,es.x),a.addScaledVector(r,es.y),a.addScaledVector(o,es.z),a)}static getInterpolatedAttribute(t,e,s,i,n,r){return hs.setScalar(0),ls.setScalar(0),cs.setScalar(0),hs.fromBufferAttribute(t,e),ls.fromBufferAttribute(t,s),cs.fromBufferAttribute(t,i),r.setScalar(0),r.addScaledVector(hs,n.x),r.addScaledVector(ls,n.y),r.addScaledVector(cs,n.z),r}static isFrontFacing(t,e,s,i){return $e.subVectors(s,e),Ke.subVectors(t,e),$e.cross(Ke).dot(i)<0}set(t,e,s){return this.a.copy(t),this.b.copy(e),this.c.copy(s),this}setFromPointsAndIndices(t,e,s,i){return this.a.copy(t[e]),this.b.copy(t[s]),this.c.copy(t[i]),this}setFromAttributeAndIndices(t,e,s,i){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,s),this.c.fromBufferAttribute(t,i),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return $e.subVectors(this.c,this.b),Ke.subVectors(this.a,this.b),.5*$e.cross(Ke).length()}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return us.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return us.getBarycoord(t,this.a,this.b,this.c,e)}getInterpolation(t,e,s,i,n){return us.getInterpolation(t,this.a,this.b,this.c,e,s,i,n)}containsPoint(t){return us.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return us.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const s=this.a,i=this.b,n=this.c;let r,o;ss.subVectors(i,s),is.subVectors(n,s),rs.subVectors(t,s);const a=ss.dot(rs),h=is.dot(rs);if(a<=0&&h<=0)return e.copy(s);os.subVectors(t,i);const l=ss.dot(os),c=is.dot(os);if(l>=0&&c<=l)return e.copy(i);const u=a*c-l*h;if(u<=0&&a>=0&&l<=0)return r=a/(a-l),e.copy(s).addScaledVector(ss,r);as.subVectors(t,n);const d=ss.dot(as),p=is.dot(as);if(p>=0&&d<=p)return e.copy(n);const f=d*h-a*p;if(f<=0&&h>=0&&p<=0)return o=h/(h-p),e.copy(s).addScaledVector(is,o);const m=l*p-d*c;if(m<=0&&c-l>=0&&d-p>=0)return ns.subVectors(n,i),o=(c-l)/(c-l+(d-p)),e.copy(i).addScaledVector(ns,o);const b=1/(m+f+u);return r=f*b,o=u*b,e.copy(s).addScaledVector(ss,r).addScaledVector(is,o)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}const ds={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},ps={h:0,s:0,l:0},fs={h:0,s:0,l:0};function ms(t,e,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?t+6*(e-t)*s:s<.5?e:s<2/3?t+6*(e-t)*(2/3-s):t}class bs{constructor(t,e,s){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,e,s)}set(t,e,s){if(void 0===e&&void 0===s){const e=t;e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e)}else this.setRGB(t,e,s);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e=dt){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,Et.toWorkingColorSpace(this,e),this}setRGB(t,e,s,i=Et.workingColorSpace){return this.r=t,this.g=e,this.b=s,Et.toWorkingColorSpace(this,i),this}setHSL(t,e,s,i=Et.workingColorSpace){var n;if(t=(t%(n=1)+n)%n,e=vt(e,0,1),s=vt(s,0,1),0===e)this.r=this.g=this.b=s;else{const i=s<=.5?s*(1+e):s+e-s*e,n=2*s-i;this.r=ms(n,i,t+1/3),this.g=ms(n,i,t),this.b=ms(n,i,t-1/3)}return Et.toWorkingColorSpace(this,i),this}setStyle(t,e=dt){function s(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(t)){let n;const r=i[1],o=i[2];switch(r){case"rgb":case"rgba":if(n=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return s(n[4]),this.setRGB(Math.min(255,parseInt(n[1],10))/255,Math.min(255,parseInt(n[2],10))/255,Math.min(255,parseInt(n[3],10))/255,e);if(n=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return s(n[4]),this.setRGB(Math.min(100,parseInt(n[1],10))/100,Math.min(100,parseInt(n[2],10))/100,Math.min(100,parseInt(n[3],10))/100,e);break;case"hsl":case"hsla":if(n=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return s(n[4]),this.setHSL(parseFloat(n[1])/360,parseFloat(n[2])/100,parseFloat(n[3])/100,e);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(t)){const s=i[1],n=s.length;if(3===n)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,e);if(6===n)return this.setHex(parseInt(s,16),e);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,e);return this}setColorName(t,e=dt){const s=ds[t.toLowerCase()];return void 0!==s?this.setHex(s,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=kt(t.r),this.g=kt(t.g),this.b=kt(t.b),this}copyLinearToSRGB(t){return this.r=Pt(t.r),this.g=Pt(t.g),this.b=Pt(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=dt){return Et.fromWorkingColorSpace(ys.copy(this),t),65536*Math.round(vt(255*ys.r,0,255))+256*Math.round(vt(255*ys.g,0,255))+Math.round(vt(255*ys.b,0,255))}getHexString(t=dt){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e=Et.workingColorSpace){Et.fromWorkingColorSpace(ys.copy(this),e);const s=ys.r,i=ys.g,n=ys.b,r=Math.max(s,i,n),o=Math.min(s,i,n);let a,h;const l=(o+r)/2;if(o===r)a=0,h=0;else{const t=r-o;switch(h=l<=.5?t/(r+o):t/(2-r-o),r){case s:a=(i-n)/t+(i<n?6:0);break;case i:a=(n-s)/t+2;break;case n:a=(s-i)/t+4}a/=6}return t.h=a,t.s=h,t.l=l,t}getRGB(t,e=Et.workingColorSpace){return Et.fromWorkingColorSpace(ys.copy(this),e),t.r=ys.r,t.g=ys.g,t.b=ys.b,t}getStyle(t=dt){Et.fromWorkingColorSpace(ys.copy(this),t);const e=ys.r,s=ys.g,i=ys.b;return t!==dt?`color(${t} ${e.toFixed(3)} ${s.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(255*e)},${Math.round(255*s)},${Math.round(255*i)})`}offsetHSL(t,e,s){return this.getHSL(ps),this.setHSL(ps.h+t,ps.s+e,ps.l+s)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,s){return this.r=t.r+(e.r-t.r)*s,this.g=t.g+(e.g-t.g)*s,this.b=t.b+(e.b-t.b)*s,this}lerpHSL(t,e){this.getHSL(ps),t.getHSL(fs);const s=Mt(ps.h,fs.h,e),i=Mt(ps.s,fs.s,e),n=Mt(ps.l,fs.l,e);return this.setHSL(s,i,n),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const e=this.r,s=this.g,i=this.b,n=t.elements;return this.r=n[0]*e+n[3]*s+n[6]*i,this.g=n[1]*e+n[4]*s+n[7]*i,this.b=n[2]*e+n[5]*s+n[8]*i,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const ys=new bs;bs.NAMES=ds;let gs=0,_s=class extends _t{static get type(){return"Material"}get type(){return this.constructor.type}set type(t){}constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:gs++}),this.uuid=wt(),this.name="",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new bs(0,0,0),this.blendAlpha=0,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=bt,this.stencilZFail=bt,this.stencilZPass=bt,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(void 0!==t)for(const e in t){const s=t[e];if(void 0===s){console.warn(`THREE.Material: parameter '${e}' has value of undefined.`);continue}const i=this[e];void 0!==i?i&&i.isColor?i.set(s):i&&i.isVector3&&s&&s.isVector3?i.copy(s):this[e]=s:console.warn(`THREE.Material: '${e}' is not a property of THREE.${this.type}.`)}}toJSON(t){const e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});const s={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function i(t){const e=[];for(const s in t){const i=t[s];delete i.metadata,e.push(i)}return e}if(s.uuid=this.uuid,s.type=this.type,""!==this.name&&(s.name=this.name),this.color&&this.color.isColor&&(s.color=this.color.getHex()),void 0!==this.roughness&&(s.roughness=this.roughness),void 0!==this.metalness&&(s.metalness=this.metalness),void 0!==this.sheen&&(s.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(s.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(s.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(s.emissive=this.emissive.getHex()),void 0!==this.emissiveIntensity&&1!==this.emissiveIntensity&&(s.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(s.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(s.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(s.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(s.shininess=this.shininess),void 0!==this.clearcoat&&(s.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(s.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(s.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(s.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(s.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,s.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.dispersion&&(s.dispersion=this.dispersion),void 0!==this.iridescence&&(s.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(s.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(s.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(s.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(s.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),void 0!==this.anisotropy&&(s.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(s.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(s.anisotropyMap=this.anisotropyMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(s.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(s.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(s.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(s.lightMap=this.lightMap.toJSON(t).uuid,s.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(s.aoMap=this.aoMap.toJSON(t).uuid,s.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(s.bumpMap=this.bumpMap.toJSON(t).uuid,s.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(s.normalMap=this.normalMap.toJSON(t).uuid,s.normalMapType=this.normalMapType,s.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(s.displacementMap=this.displacementMap.toJSON(t).uuid,s.displacementScale=this.displacementScale,s.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(s.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(s.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(s.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(s.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(s.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(s.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(s.envMap=this.envMap.toJSON(t).uuid,void 0!==this.combine&&(s.combine=this.combine)),void 0!==this.envMapRotation&&(s.envMapRotation=this.envMapRotation.toArray()),void 0!==this.envMapIntensity&&(s.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(s.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(s.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(s.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.transmission&&(s.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(s.transmissionMap=this.transmissionMap.toJSON(t).uuid),void 0!==this.thickness&&(s.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(s.thicknessMap=this.thicknessMap.toJSON(t).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(s.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(s.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(s.size=this.size),null!==this.shadowSide&&(s.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(s.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(s.blending=this.blending),0!==this.side&&(s.side=this.side),!0===this.vertexColors&&(s.vertexColors=!0),this.opacity<1&&(s.opacity=this.opacity),!0===this.transparent&&(s.transparent=!0),204!==this.blendSrc&&(s.blendSrc=this.blendSrc),205!==this.blendDst&&(s.blendDst=this.blendDst),100!==this.blendEquation&&(s.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(s.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(s.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(s.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(s.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(s.blendAlpha=this.blendAlpha),3!==this.depthFunc&&(s.depthFunc=this.depthFunc),!1===this.depthTest&&(s.depthTest=this.depthTest),!1===this.depthWrite&&(s.depthWrite=this.depthWrite),!1===this.colorWrite&&(s.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(s.stencilWriteMask=this.stencilWriteMask),519!==this.stencilFunc&&(s.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(s.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(s.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==bt&&(s.stencilFail=this.stencilFail),this.stencilZFail!==bt&&(s.stencilZFail=this.stencilZFail),this.stencilZPass!==bt&&(s.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(s.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(s.rotation=this.rotation),!0===this.polygonOffset&&(s.polygonOffset=!0),0!==this.polygonOffsetFactor&&(s.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(s.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(s.linewidth=this.linewidth),void 0!==this.dashSize&&(s.dashSize=this.dashSize),void 0!==this.gapSize&&(s.gapSize=this.gapSize),void 0!==this.scale&&(s.scale=this.scale),!0===this.dithering&&(s.dithering=!0),this.alphaTest>0&&(s.alphaTest=this.alphaTest),!0===this.alphaHash&&(s.alphaHash=!0),!0===this.alphaToCoverage&&(s.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(s.premultipliedAlpha=!0),!0===this.forceSinglePass&&(s.forceSinglePass=!0),!0===this.wireframe&&(s.wireframe=!0),this.wireframeLinewidth>1&&(s.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(s.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(s.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(s.flatShading=!0),!1===this.visible&&(s.visible=!1),!1===this.toneMapped&&(s.toneMapped=!1),!1===this.fog&&(s.fog=!1),Object.keys(this.userData).length>0&&(s.userData=this.userData),e){const e=i(t.textures),n=i(t.images);e.length>0&&(s.textures=e),n.length>0&&(s.images=n)}return s}clone(){return(new this.constructor).copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.blendColor.copy(t.blendColor),this.blendAlpha=t.blendAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let s=null;if(null!==e){const t=e.length;s=new Array(t);for(let i=0;i!==t;++i)s[i]=e[i].clone()}return this.clippingPlanes=s,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaHash=t.alphaHash,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){!0===t&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}};class xs extends _s{static get type(){return"MeshBasicMaterial"}constructor(t){super(),this.isMeshBasicMaterial=!0,this.color=new bs(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Fe,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}const ws=new Yt,vs=new It;class Ms{constructor(t,e,s=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=s,this.usage=35044,this.updateRanges=[],this.gpuType=1015,this.version=0}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this}copyAt(t,e,s){t*=this.itemSize,s*=e.itemSize;for(let i=0,n=this.itemSize;i<n;i++)this.array[t+i]=e.array[s+i];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(2===this.itemSize)for(let e=0,s=this.count;e<s;e++)vs.fromBufferAttribute(this,e),vs.applyMatrix3(t),this.setXY(e,vs.x,vs.y);else if(3===this.itemSize)for(let e=0,s=this.count;e<s;e++)ws.fromBufferAttribute(this,e),ws.applyMatrix3(t),this.setXYZ(e,ws.x,ws.y,ws.z);return this}applyMatrix4(t){for(let e=0,s=this.count;e<s;e++)ws.fromBufferAttribute(this,e),ws.applyMatrix4(t),this.setXYZ(e,ws.x,ws.y,ws.z);return this}applyNormalMatrix(t){for(let e=0,s=this.count;e<s;e++)ws.fromBufferAttribute(this,e),ws.applyNormalMatrix(t),this.setXYZ(e,ws.x,ws.y,ws.z);return this}transformDirection(t){for(let e=0,s=this.count;e<s;e++)ws.fromBufferAttribute(this,e),ws.transformDirection(t),this.setXYZ(e,ws.x,ws.y,ws.z);return this}set(t,e=0){return this.array.set(t,e),this}getComponent(t,e){let s=this.array[t*this.itemSize+e];return this.normalized&&(s=At(s,this.array)),s}setComponent(t,e,s){return this.normalized&&(s=St(s,this.array)),this.array[t*this.itemSize+e]=s,this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=At(e,this.array)),e}setX(t,e){return this.normalized&&(e=St(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=At(e,this.array)),e}setY(t,e){return this.normalized&&(e=St(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=At(e,this.array)),e}setZ(t,e){return this.normalized&&(e=St(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=At(e,this.array)),e}setW(t,e){return this.normalized&&(e=St(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,s){return t*=this.itemSize,this.normalized&&(e=St(e,this.array),s=St(s,this.array)),this.array[t+0]=e,this.array[t+1]=s,this}setXYZ(t,e,s,i){return t*=this.itemSize,this.normalized&&(e=St(e,this.array),s=St(s,this.array),i=St(i,this.array)),this.array[t+0]=e,this.array[t+1]=s,this.array[t+2]=i,this}setXYZW(t,e,s,i,n){return t*=this.itemSize,this.normalized&&(e=St(e,this.array),s=St(s,this.array),i=St(i,this.array),n=St(n,this.array)),this.array[t+0]=e,this.array[t+1]=s,this.array[t+2]=i,this.array[t+3]=n,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(t.name=this.name),35044!==this.usage&&(t.usage=this.usage),t}}class As extends Ms{constructor(t,e,s){super(new Uint16Array(t),e,s)}}class Ss extends Ms{constructor(t,e,s){super(new Uint32Array(t),e,s)}}class zs extends Ms{constructor(t,e,s){super(new Float32Array(t),e,s)}}let Is=0;const Ts=new Ae,Bs=new Qe,Cs=new Yt,Es=new Qt,ks=new Qt,Ps=new Yt;class Fs extends _t{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Is++}),this.uuid=wt(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(function(t){for(let e=t.length-1;e>=0;--e)if(t[e]>=65535)return!0;return!1}(t)?Ss:As)(t,1):this.index=t,this}setIndirect(t){return this.indirect=t,this}getIndirect(){return this.indirect}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return void 0!==this.attributes[t]}addGroup(t,e,s=0){this.groups.push({start:t,count:e,materialIndex:s})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);const s=this.attributes.normal;if(void 0!==s){const e=(new Tt).getNormalMatrix(t);s.applyNormalMatrix(e),s.needsUpdate=!0}const i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(t),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(t){return Ts.makeRotationFromQuaternion(t),this.applyMatrix4(Ts),this}rotateX(t){return Ts.makeRotationX(t),this.applyMatrix4(Ts),this}rotateY(t){return Ts.makeRotationY(t),this.applyMatrix4(Ts),this}rotateZ(t){return Ts.makeRotationZ(t),this.applyMatrix4(Ts),this}translate(t,e,s){return Ts.makeTranslation(t,e,s),this.applyMatrix4(Ts),this}scale(t,e,s){return Ts.makeScale(t,e,s),this.applyMatrix4(Ts),this}lookAt(t){return Bs.lookAt(t),Bs.updateMatrix(),this.applyMatrix4(Bs.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Cs).negate(),this.translate(Cs.x,Cs.y,Cs.z),this}setFromPoints(t){const e=this.getAttribute("position");if(void 0===e){const e=[];for(let s=0,i=t.length;s<i;s++){const i=t[s];e.push(i.x,i.y,i.z||0)}this.setAttribute("position",new zs(e,3))}else{for(let s=0,i=e.count;s<i;s++){const i=t[s];e.setXYZ(s,i.x,i.y,i.z||0)}t.length>e.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),e.needsUpdate=!0}return this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Qt);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),void this.boundingBox.set(new Yt(-1/0,-1/0,-1/0),new Yt(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let t=0,s=e.length;t<s;t++){const s=e[t];Es.setFromBufferAttribute(s),this.morphTargetsRelative?(Ps.addVectors(this.boundingBox.min,Es.min),this.boundingBox.expandByPoint(Ps),Ps.addVectors(this.boundingBox.max,Es.max),this.boundingBox.expandByPoint(Ps)):(this.boundingBox.expandByPoint(Es.min),this.boundingBox.expandByPoint(Es.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new me);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),void this.boundingSphere.set(new Yt,1/0);if(t){const s=this.boundingSphere.center;if(Es.setFromBufferAttribute(t),e)for(let t=0,s=e.length;t<s;t++){const s=e[t];ks.setFromBufferAttribute(s),this.morphTargetsRelative?(Ps.addVectors(Es.min,ks.min),Es.expandByPoint(Ps),Ps.addVectors(Es.max,ks.max),Es.expandByPoint(Ps)):(Es.expandByPoint(ks.min),Es.expandByPoint(ks.max))}Es.getCenter(s);let i=0;for(let e=0,n=t.count;e<n;e++)Ps.fromBufferAttribute(t,e),i=Math.max(i,s.distanceToSquared(Ps));if(e)for(let n=0,r=e.length;n<r;n++){const r=e[n],o=this.morphTargetsRelative;for(let e=0,n=r.count;e<n;e++)Ps.fromBufferAttribute(r,e),o&&(Cs.fromBufferAttribute(t,e),Ps.add(Cs)),i=Math.max(i,s.distanceToSquared(Ps))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(null===t||void 0===e.position||void 0===e.normal||void 0===e.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const s=e.position,i=e.normal,n=e.uv;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new Ms(new Float32Array(4*s.count),4));const r=this.getAttribute("tangent"),o=[],a=[];for(let t=0;t<s.count;t++)o[t]=new Yt,a[t]=new Yt;const h=new Yt,l=new Yt,c=new Yt,u=new It,d=new It,p=new It,f=new Yt,m=new Yt;function b(t,e,i){h.fromBufferAttribute(s,t),l.fromBufferAttribute(s,e),c.fromBufferAttribute(s,i),u.fromBufferAttribute(n,t),d.fromBufferAttribute(n,e),p.fromBufferAttribute(n,i),l.sub(h),c.sub(h),d.sub(u),p.sub(u);const r=1/(d.x*p.y-p.x*d.y);isFinite(r)&&(f.copy(l).multiplyScalar(p.y).addScaledVector(c,-d.y).multiplyScalar(r),m.copy(c).multiplyScalar(d.x).addScaledVector(l,-p.x).multiplyScalar(r),o[t].add(f),o[e].add(f),o[i].add(f),a[t].add(m),a[e].add(m),a[i].add(m))}let y=this.groups;0===y.length&&(y=[{start:0,count:t.count}]);for(let e=0,s=y.length;e<s;++e){const s=y[e],i=s.start;for(let e=i,n=i+s.count;e<n;e+=3)b(t.getX(e+0),t.getX(e+1),t.getX(e+2))}const g=new Yt,_=new Yt,x=new Yt,w=new Yt;function v(t){x.fromBufferAttribute(i,t),w.copy(x);const e=o[t];g.copy(e),g.sub(x.multiplyScalar(x.dot(e))).normalize(),_.crossVectors(w,e);const s=_.dot(a[t])<0?-1:1;r.setXYZW(t,g.x,g.y,g.z,s)}for(let e=0,s=y.length;e<s;++e){const s=y[e],i=s.start;for(let e=i,n=i+s.count;e<n;e+=3)v(t.getX(e+0)),v(t.getX(e+1)),v(t.getX(e+2))}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(void 0!==e){let s=this.getAttribute("normal");if(void 0===s)s=new Ms(new Float32Array(3*e.count),3),this.setAttribute("normal",s);else for(let t=0,e=s.count;t<e;t++)s.setXYZ(t,0,0,0);const i=new Yt,n=new Yt,r=new Yt,o=new Yt,a=new Yt,h=new Yt,l=new Yt,c=new Yt;if(t)for(let u=0,d=t.count;u<d;u+=3){const d=t.getX(u+0),p=t.getX(u+1),f=t.getX(u+2);i.fromBufferAttribute(e,d),n.fromBufferAttribute(e,p),r.fromBufferAttribute(e,f),l.subVectors(r,n),c.subVectors(i,n),l.cross(c),o.fromBufferAttribute(s,d),a.fromBufferAttribute(s,p),h.fromBufferAttribute(s,f),o.add(l),a.add(l),h.add(l),s.setXYZ(d,o.x,o.y,o.z),s.setXYZ(p,a.x,a.y,a.z),s.setXYZ(f,h.x,h.y,h.z)}else for(let t=0,o=e.count;t<o;t+=3)i.fromBufferAttribute(e,t+0),n.fromBufferAttribute(e,t+1),r.fromBufferAttribute(e,t+2),l.subVectors(r,n),c.subVectors(i,n),l.cross(c),s.setXYZ(t+0,l.x,l.y,l.z),s.setXYZ(t+1,l.x,l.y,l.z),s.setXYZ(t+2,l.x,l.y,l.z);this.normalizeNormals(),s.needsUpdate=!0}}normalizeNormals(){const t=this.attributes.normal;for(let e=0,s=t.count;e<s;e++)Ps.fromBufferAttribute(t,e),Ps.normalize(),t.setXYZ(e,Ps.x,Ps.y,Ps.z)}toNonIndexed(){function t(t,e){const s=t.array,i=t.itemSize,n=t.normalized,r=new s.constructor(e.length*i);let o=0,a=0;for(let n=0,h=e.length;n<h;n++){o=t.isInterleavedBufferAttribute?e[n]*t.data.stride+t.offset:e[n]*i;for(let t=0;t<i;t++)r[a++]=s[o++]}return new Ms(r,i,n)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new Fs,s=this.index.array,i=this.attributes;for(const n in i){const r=t(i[n],s);e.setAttribute(n,r)}const n=this.morphAttributes;for(const i in n){const r=[],o=n[i];for(let e=0,i=o.length;e<i;e++){const i=t(o[e],s);r.push(i)}e.morphAttributes[i]=r}e.morphTargetsRelative=this.morphTargetsRelative;const r=this.groups;for(let t=0,s=r.length;t<s;t++){const s=r[t];e.addGroup(s.start,s.count,s.materialIndex)}return e}toJSON(){const t={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){const e=this.parameters;for(const s in e)void 0!==e[s]&&(t[s]=e[s]);return t}t.data={attributes:{}};const e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const s=this.attributes;for(const e in s){const i=s[e];t.data.attributes[e]=i.toJSON(t.data)}const i={};let n=!1;for(const e in this.morphAttributes){const s=this.morphAttributes[e],r=[];for(let e=0,i=s.length;e<i;e++){const i=s[e];r.push(i.toJSON(t.data))}r.length>0&&(i[e]=r,n=!0)}n&&(t.data.morphAttributes=i,t.data.morphTargetsRelative=this.morphTargetsRelative);const r=this.groups;r.length>0&&(t.data.groups=JSON.parse(JSON.stringify(r)));const o=this.boundingSphere;return null!==o&&(t.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),t}clone(){return(new this.constructor).copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const s=t.index;null!==s&&this.setIndex(s.clone(e));const i=t.attributes;for(const t in i){const s=i[t];this.setAttribute(t,s.clone(e))}const n=t.morphAttributes;for(const t in n){const s=[],i=n[t];for(let t=0,n=i.length;t<n;t++)s.push(i[t].clone(e));this.morphAttributes[t]=s}this.morphTargetsRelative=t.morphTargetsRelative;const r=t.groups;for(let t=0,e=r.length;t<e;t++){const e=r[t];this.addGroup(e.start,e.count,e.materialIndex)}const o=t.boundingBox;null!==o&&(this.boundingBox=o.clone());const a=t.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const Rs=new Ae,Ls=new Me,Os=new me,Vs=new Yt,Us=new Yt,Ds=new Yt,Ns=new Yt,Ws=new Yt,Zs=new Yt,qs=new Yt,Hs=new Yt;class js extends Qe{constructor(t=new Fs,e=new xs){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const s=t[e[0]];if(void 0!==s){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=s.length;t<e;t++){const e=s[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}getVertexPosition(t,e){const s=this.geometry,i=s.attributes.position,n=s.morphAttributes.position,r=s.morphTargetsRelative;e.fromBufferAttribute(i,t);const o=this.morphTargetInfluences;if(n&&o){Zs.set(0,0,0);for(let s=0,i=n.length;s<i;s++){const i=o[s],a=n[s];0!==i&&(Ws.fromBufferAttribute(a,t),r?Zs.addScaledVector(Ws,i):Zs.addScaledVector(Ws.sub(e),i))}e.add(Zs)}return e}raycast(t,e){const s=this.geometry,i=this.material,n=this.matrixWorld;if(void 0!==i){if(null===s.boundingSphere&&s.computeBoundingSphere(),Os.copy(s.boundingSphere),Os.applyMatrix4(n),Ls.copy(t.ray).recast(t.near),!1===Os.containsPoint(Ls.origin)){if(null===Ls.intersectSphere(Os,Vs))return;if(Ls.origin.distanceToSquared(Vs)>(t.far-t.near)**2)return}Rs.copy(n).invert(),Ls.copy(t.ray).applyMatrix4(Rs),null!==s.boundingBox&&!1===Ls.intersectsBox(s.boundingBox)||this._computeIntersections(t,e,Ls)}}_computeIntersections(t,e,s){let i;const n=this.geometry,r=this.material,o=n.index,a=n.attributes.position,h=n.attributes.uv,l=n.attributes.uv1,c=n.attributes.normal,u=n.groups,d=n.drawRange;if(null!==o)if(Array.isArray(r))for(let n=0,a=u.length;n<a;n++){const a=u[n],p=r[a.materialIndex];for(let n=Math.max(a.start,d.start),r=Math.min(o.count,Math.min(a.start+a.count,d.start+d.count));n<r;n+=3){i=Gs(this,p,t,s,h,l,c,o.getX(n),o.getX(n+1),o.getX(n+2)),i&&(i.faceIndex=Math.floor(n/3),i.face.materialIndex=a.materialIndex,e.push(i))}}else{for(let n=Math.max(0,d.start),a=Math.min(o.count,d.start+d.count);n<a;n+=3){i=Gs(this,r,t,s,h,l,c,o.getX(n),o.getX(n+1),o.getX(n+2)),i&&(i.faceIndex=Math.floor(n/3),e.push(i))}}else if(void 0!==a)if(Array.isArray(r))for(let n=0,o=u.length;n<o;n++){const o=u[n],p=r[o.materialIndex];for(let n=Math.max(o.start,d.start),r=Math.min(a.count,Math.min(o.start+o.count,d.start+d.count));n<r;n+=3){i=Gs(this,p,t,s,h,l,c,n,n+1,n+2),i&&(i.faceIndex=Math.floor(n/3),i.face.materialIndex=o.materialIndex,e.push(i))}}else{for(let n=Math.max(0,d.start),o=Math.min(a.count,d.start+d.count);n<o;n+=3){i=Gs(this,r,t,s,h,l,c,n,n+1,n+2),i&&(i.faceIndex=Math.floor(n/3),e.push(i))}}}}function Gs(t,e,s,i,n,r,o,a,h,l){t.getVertexPosition(a,Us),t.getVertexPosition(h,Ds),t.getVertexPosition(l,Ns);const c=function(t,e,s,i,n,r,o,a){let h;if(h=1===e.side?i.intersectTriangle(o,r,n,!0,a):i.intersectTriangle(n,r,o,0===e.side,a),null===h)return null;Hs.copy(a),Hs.applyMatrix4(t.matrixWorld);const l=s.ray.origin.distanceTo(Hs);return l<s.near||l>s.far?null:{distance:l,point:Hs.clone(),object:t}}(t,e,s,i,Us,Ds,Ns,qs);if(c){const t=new Yt;us.getBarycoord(qs,Us,Ds,Ns,t),n&&(c.uv=us.getInterpolatedAttribute(n,a,h,l,t,new It)),r&&(c.uv1=us.getInterpolatedAttribute(r,a,h,l,t,new It)),o&&(c.normal=us.getInterpolatedAttribute(o,a,h,l,t,new Yt),c.normal.dot(i.direction)>0&&c.normal.multiplyScalar(-1));const e={a:a,b:h,c:l,normal:new Yt,materialIndex:0};us.getNormal(Us,Ds,Ns,e.normal),c.face=e,c.barycoord=t}return c}const Ys=new Yt,Xs=new Yt,Js=new Tt;class Qs{constructor(t=new Yt(1,0,0),e=0){this.isPlane=!0,this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,s,i){return this.normal.set(t,e,s),this.constant=i,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,s){const i=Ys.subVectors(s,e).cross(Xs.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(i,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(t).addScaledVector(this.normal,-this.distanceToPoint(t))}intersectLine(t,e){const s=t.delta(Ys),i=this.normal.dot(s);if(0===i)return 0===this.distanceToPoint(t.start)?e.copy(t.start):null;const n=-(t.start.dot(this.normal)+this.constant)/i;return n<0||n>1?null:e.copy(t.start).addScaledVector(s,n)}intersectsLine(t){const e=this.distanceToPoint(t.start),s=this.distanceToPoint(t.end);return e<0&&s>0||s<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const s=e||Js.getNormalMatrix(t),i=this.coplanarPoint(Ys).applyMatrix4(t),n=this.normal.applyMatrix3(s).normalize();return this.constant=-i.dot(n),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const $s=new me,Ks=new Yt;class ti{constructor(t=new Qs,e=new Qs,s=new Qs,i=new Qs,n=new Qs,r=new Qs){this.planes=[t,e,s,i,n,r]}set(t,e,s,i,n,r){const o=this.planes;return o[0].copy(t),o[1].copy(e),o[2].copy(s),o[3].copy(i),o[4].copy(n),o[5].copy(r),this}copy(t){const e=this.planes;for(let s=0;s<6;s++)e[s].copy(t.planes[s]);return this}setFromProjectionMatrix(t,e=2e3){const s=this.planes,i=t.elements,n=i[0],r=i[1],o=i[2],a=i[3],h=i[4],l=i[5],c=i[6],u=i[7],d=i[8],p=i[9],f=i[10],m=i[11],b=i[12],y=i[13],g=i[14],_=i[15];if(s[0].setComponents(a-n,u-h,m-d,_-b).normalize(),s[1].setComponents(a+n,u+h,m+d,_+b).normalize(),s[2].setComponents(a+r,u+l,m+p,_+y).normalize(),s[3].setComponents(a-r,u-l,m-p,_-y).normalize(),s[4].setComponents(a-o,u-c,m-f,_-g).normalize(),e===yt)s[5].setComponents(a+o,u+c,m+f,_+g).normalize();else{if(e!==gt)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+e);s[5].setComponents(o,c,f,g).normalize()}return this}intersectsObject(t){if(void 0!==t.boundingSphere)null===t.boundingSphere&&t.computeBoundingSphere(),$s.copy(t.boundingSphere).applyMatrix4(t.matrixWorld);else{const e=t.geometry;null===e.boundingSphere&&e.computeBoundingSphere(),$s.copy(e.boundingSphere).applyMatrix4(t.matrixWorld)}return this.intersectsSphere($s)}intersectsSprite(t){return $s.center.set(0,0,0),$s.radius=.7071067811865476,$s.applyMatrix4(t.matrixWorld),this.intersectsSphere($s)}intersectsSphere(t){const e=this.planes,s=t.center,i=-t.radius;for(let t=0;t<6;t++){if(e[t].distanceToPoint(s)<i)return!1}return!0}intersectsBox(t){const e=this.planes;for(let s=0;s<6;s++){const i=e[s];if(Ks.x=i.normal.x>0?t.max.x:t.min.x,Ks.y=i.normal.y>0?t.max.y:t.min.y,Ks.z=i.normal.z>0?t.max.z:t.min.z,i.distanceToPoint(Ks)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let s=0;s<6;s++)if(e[s].distanceToPoint(t)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}class ei extends Ht{constructor(t=null,e=1,s=1,i,n,r,o,a,h=1003,l=1003,c,u){super(null,r,o,a,h,l,i,n,c,u),this.isDataTexture=!0,this.image={data:t,width:e,height:s},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class si extends Ms{constructor(t,e,s,i=1){super(t,e,s),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}const ii=new Ae,ni=new Ae,ri=[],oi=new Qt,ai=new Ae,hi=new js,li=new me;class ci extends js{constructor(t,e,s){super(t,e),this.isInstancedMesh=!0,this.instanceMatrix=new si(new Float32Array(16*s),16),this.instanceColor=null,this.morphTexture=null,this.count=s,this.boundingBox=null,this.boundingSphere=null;for(let t=0;t<s;t++)this.setMatrixAt(t,ai)}computeBoundingBox(){const t=this.geometry,e=this.count;null===this.boundingBox&&(this.boundingBox=new Qt),null===t.boundingBox&&t.computeBoundingBox(),this.boundingBox.makeEmpty();for(let s=0;s<e;s++)this.getMatrixAt(s,ii),oi.copy(t.boundingBox).applyMatrix4(ii),this.boundingBox.union(oi)}computeBoundingSphere(){const t=this.geometry,e=this.count;null===this.boundingSphere&&(this.boundingSphere=new me),null===t.boundingSphere&&t.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let s=0;s<e;s++)this.getMatrixAt(s,ii),li.copy(t.boundingSphere).applyMatrix4(ii),this.boundingSphere.union(li)}copy(t,e){return super.copy(t,e),this.instanceMatrix.copy(t.instanceMatrix),null!==t.morphTexture&&(this.morphTexture=t.morphTexture.clone()),null!==t.instanceColor&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this}getColorAt(t,e){e.fromArray(this.instanceColor.array,3*t)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,16*t)}getMorphAt(t,e){const s=e.morphTargetInfluences,i=this.morphTexture.source.data.data,n=t*(s.length+1)+1;for(let t=0;t<s.length;t++)s[t]=i[n+t]}raycast(t,e){const s=this.matrixWorld,i=this.count;if(hi.geometry=this.geometry,hi.material=this.material,void 0!==hi.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),li.copy(this.boundingSphere),li.applyMatrix4(s),!1!==t.ray.intersectsSphere(li)))for(let n=0;n<i;n++){this.getMatrixAt(n,ii),ni.multiplyMatrices(s,ii),hi.matrixWorld=ni,hi.raycast(t,ri);for(let t=0,s=ri.length;t<s;t++){const s=ri[t];s.instanceId=n,s.object=this,e.push(s)}ri.length=0}}setColorAt(t,e){null===this.instanceColor&&(this.instanceColor=new si(new Float32Array(3*this.instanceMatrix.count).fill(1),3)),e.toArray(this.instanceColor.array,3*t)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,16*t)}setMorphAt(t,e){const s=e.morphTargetInfluences,i=s.length+1;null===this.morphTexture&&(this.morphTexture=new ei(new Float32Array(i*this.count),i,this.count,1028,1015));const n=this.morphTexture.source.data.data;let r=0;for(let t=0;t<s.length;t++)r+=s[t];const o=this.geometry.morphTargetsRelative?1:1-r,a=i*t;n[a]=o,n.set(s,a+1)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),null!==this.morphTexture&&(this.morphTexture.dispose(),this.morphTexture=null),this}}const ui=new Ae;function di(t,e){return t.distance-e.distance}function pi(t,e,s,i){let n=!0;if(t.layers.test(e.layers)){!1===t.raycast(e,s)&&(n=!1)}if(!0===n&&!0===i){const i=t.children;for(let t=0,n=i.length;t<n;t++)pi(i[t],e,s,!0)}}const fi=new Yt,mi=new Yt;class bi{constructor(t=new Yt,e=new Yt){this.start=t,this.end=e}set(t,e){return this.start.copy(t),this.end.copy(e),this}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,e){return this.delta(e).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,e){fi.subVectors(t,this.start),mi.subVectors(this.end,this.start);const s=mi.dot(mi);let i=mi.dot(fi)/s;return e&&(i=vt(i,0,1)),i}closestPointToPoint(t,e,s){const i=this.closestPointToPointParameter(t,e);return this.delta(s).multiplyScalar(i).add(this.start)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"170"}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="170")
/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */;function yi(t){let e=t.length;for(;--e>=0;)t[e]=0}const gi=256,_i=286,xi=30,wi=15,vi=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Mi=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Ai=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Si=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),zi=new Array(576);yi(zi);const Ii=new Array(60);yi(Ii);const Ti=new Array(512);yi(Ti);const Bi=new Array(256);yi(Bi);const Ci=new Array(29);yi(Ci);const Ei=new Array(xi);function ki(t,e,s,i,n){this.static_tree=t,this.extra_bits=e,this.extra_base=s,this.elems=i,this.max_length=n,this.has_stree=t&&t.length}let Pi,Fi,Ri;function Li(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}yi(Ei);const Oi=t=>t<256?Ti[t]:Ti[256+(t>>>7)],Vi=(t,e)=>{t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255},Ui=(t,e,s)=>{t.bi_valid>16-s?(t.bi_buf|=e<<t.bi_valid&65535,Vi(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=s-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=s)},Di=(t,e,s)=>{Ui(t,s[2*e],s[2*e+1])},Ni=(t,e)=>{let s=0;do{s|=1&t,t>>>=1,s<<=1}while(--e>0);return s>>>1},Wi=(t,e,s)=>{const i=new Array(16);let n,r,o=0;for(n=1;n<=wi;n++)o=o+s[n-1]<<1,i[n]=o;for(r=0;r<=e;r++){let e=t[2*r+1];0!==e&&(t[2*r]=Ni(i[e]++,e))}},Zi=t=>{let e;for(e=0;e<_i;e++)t.dyn_ltree[2*e]=0;for(e=0;e<xi;e++)t.dyn_dtree[2*e]=0;for(e=0;e<19;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},qi=t=>{t.bi_valid>8?Vi(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},Hi=(t,e,s,i)=>{const n=2*e,r=2*s;return t[n]<t[r]||t[n]===t[r]&&i[e]<=i[s]},ji=(t,e,s)=>{const i=t.heap[s];let n=s<<1;for(;n<=t.heap_len&&(n<t.heap_len&&Hi(e,t.heap[n+1],t.heap[n],t.depth)&&n++,!Hi(e,i,t.heap[n],t.depth));)t.heap[s]=t.heap[n],s=n,n<<=1;t.heap[s]=i},Gi=(t,e,s)=>{let i,n,r,o,a=0;if(0!==t.sym_next)do{i=255&t.pending_buf[t.sym_buf+a++],i+=(255&t.pending_buf[t.sym_buf+a++])<<8,n=t.pending_buf[t.sym_buf+a++],0===i?Di(t,n,e):(r=Bi[n],Di(t,r+gi+1,e),o=vi[r],0!==o&&(n-=Ci[r],Ui(t,n,o)),i--,r=Oi(i),Di(t,r,s),o=Mi[r],0!==o&&(i-=Ei[r],Ui(t,i,o)))}while(a<t.sym_next);Di(t,256,e)},Yi=(t,e)=>{const s=e.dyn_tree,i=e.stat_desc.static_tree,n=e.stat_desc.has_stree,r=e.stat_desc.elems;let o,a,h,l=-1;for(t.heap_len=0,t.heap_max=573,o=0;o<r;o++)0!==s[2*o]?(t.heap[++t.heap_len]=l=o,t.depth[o]=0):s[2*o+1]=0;for(;t.heap_len<2;)h=t.heap[++t.heap_len]=l<2?++l:0,s[2*h]=1,t.depth[h]=0,t.opt_len--,n&&(t.static_len-=i[2*h+1]);for(e.max_code=l,o=t.heap_len>>1;o>=1;o--)ji(t,s,o);h=r;do{o=t.heap[1],t.heap[1]=t.heap[t.heap_len--],ji(t,s,1),a=t.heap[1],t.heap[--t.heap_max]=o,t.heap[--t.heap_max]=a,s[2*h]=s[2*o]+s[2*a],t.depth[h]=(t.depth[o]>=t.depth[a]?t.depth[o]:t.depth[a])+1,s[2*o+1]=s[2*a+1]=h,t.heap[1]=h++,ji(t,s,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],((t,e)=>{const s=e.dyn_tree,i=e.max_code,n=e.stat_desc.static_tree,r=e.stat_desc.has_stree,o=e.stat_desc.extra_bits,a=e.stat_desc.extra_base,h=e.stat_desc.max_length;let l,c,u,d,p,f,m=0;for(d=0;d<=wi;d++)t.bl_count[d]=0;for(s[2*t.heap[t.heap_max]+1]=0,l=t.heap_max+1;l<573;l++)c=t.heap[l],d=s[2*s[2*c+1]+1]+1,d>h&&(d=h,m++),s[2*c+1]=d,c>i||(t.bl_count[d]++,p=0,c>=a&&(p=o[c-a]),f=s[2*c],t.opt_len+=f*(d+p),r&&(t.static_len+=f*(n[2*c+1]+p)));if(0!==m){do{for(d=h-1;0===t.bl_count[d];)d--;t.bl_count[d]--,t.bl_count[d+1]+=2,t.bl_count[h]--,m-=2}while(m>0);for(d=h;0!==d;d--)for(c=t.bl_count[d];0!==c;)u=t.heap[--l],u>i||(s[2*u+1]!==d&&(t.opt_len+=(d-s[2*u+1])*s[2*u],s[2*u+1]=d),c--)}})(t,e),Wi(s,l,t.bl_count)},Xi=(t,e,s)=>{let i,n,r=-1,o=e[1],a=0,h=7,l=4;for(0===o&&(h=138,l=3),e[2*(s+1)+1]=65535,i=0;i<=s;i++)n=o,o=e[2*(i+1)+1],++a<h&&n===o||(a<l?t.bl_tree[2*n]+=a:0!==n?(n!==r&&t.bl_tree[2*n]++,t.bl_tree[32]++):a<=10?t.bl_tree[34]++:t.bl_tree[36]++,a=0,r=n,0===o?(h=138,l=3):n===o?(h=6,l=3):(h=7,l=4))},Ji=(t,e,s)=>{let i,n,r=-1,o=e[1],a=0,h=7,l=4;for(0===o&&(h=138,l=3),i=0;i<=s;i++)if(n=o,o=e[2*(i+1)+1],!(++a<h&&n===o)){if(a<l)do{Di(t,n,t.bl_tree)}while(0!=--a);else 0!==n?(n!==r&&(Di(t,n,t.bl_tree),a--),Di(t,16,t.bl_tree),Ui(t,a-3,2)):a<=10?(Di(t,17,t.bl_tree),Ui(t,a-3,3)):(Di(t,18,t.bl_tree),Ui(t,a-11,7));a=0,r=n,0===o?(h=138,l=3):n===o?(h=6,l=3):(h=7,l=4)}};let Qi=!1;const $i=(t,e,s,i)=>{Ui(t,0+(i?1:0),3),qi(t),Vi(t,s),Vi(t,~s),s&&t.pending_buf.set(t.window.subarray(e,e+s),t.pending),t.pending+=s};var Ki={_tr_init:t=>{Qi||((()=>{let t,e,s,i,n;const r=new Array(16);for(s=0,i=0;i<28;i++)for(Ci[i]=s,t=0;t<1<<vi[i];t++)Bi[s++]=i;for(Bi[s-1]=i,n=0,i=0;i<16;i++)for(Ei[i]=n,t=0;t<1<<Mi[i];t++)Ti[n++]=i;for(n>>=7;i<xi;i++)for(Ei[i]=n<<7,t=0;t<1<<Mi[i]-7;t++)Ti[256+n++]=i;for(e=0;e<=wi;e++)r[e]=0;for(t=0;t<=143;)zi[2*t+1]=8,t++,r[8]++;for(;t<=255;)zi[2*t+1]=9,t++,r[9]++;for(;t<=279;)zi[2*t+1]=7,t++,r[7]++;for(;t<=287;)zi[2*t+1]=8,t++,r[8]++;for(Wi(zi,287,r),t=0;t<xi;t++)Ii[2*t+1]=5,Ii[2*t]=Ni(t,5);Pi=new ki(zi,vi,257,_i,wi),Fi=new ki(Ii,Mi,0,xi,wi),Ri=new ki(new Array(0),Ai,0,19,7)})(),Qi=!0),t.l_desc=new Li(t.dyn_ltree,Pi),t.d_desc=new Li(t.dyn_dtree,Fi),t.bl_desc=new Li(t.bl_tree,Ri),t.bi_buf=0,t.bi_valid=0,Zi(t)},_tr_stored_block:$i,_tr_flush_block:(t,e,s,i)=>{let n,r,o=0;t.level>0?(2===t.strm.data_type&&(t.strm.data_type=(t=>{let e,s=4093624447;for(e=0;e<=31;e++,s>>>=1)if(1&s&&0!==t.dyn_ltree[2*e])return 0;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return 1;for(e=32;e<gi;e++)if(0!==t.dyn_ltree[2*e])return 1;return 0})(t)),Yi(t,t.l_desc),Yi(t,t.d_desc),o=(t=>{let e;for(Xi(t,t.dyn_ltree,t.l_desc.max_code),Xi(t,t.dyn_dtree,t.d_desc.max_code),Yi(t,t.bl_desc),e=18;e>=3&&0===t.bl_tree[2*Si[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e})(t),n=t.opt_len+3+7>>>3,r=t.static_len+3+7>>>3,r<=n&&(n=r)):n=r=s+5,s+4<=n&&-1!==e?$i(t,e,s,i):4===t.strategy||r===n?(Ui(t,2+(i?1:0),3),Gi(t,zi,Ii)):(Ui(t,4+(i?1:0),3),((t,e,s,i)=>{let n;for(Ui(t,e-257,5),Ui(t,s-1,5),Ui(t,i-4,4),n=0;n<i;n++)Ui(t,t.bl_tree[2*Si[n]+1],3);Ji(t,t.dyn_ltree,e-1),Ji(t,t.dyn_dtree,s-1)})(t,t.l_desc.max_code+1,t.d_desc.max_code+1,o+1),Gi(t,t.dyn_ltree,t.dyn_dtree)),Zi(t),i&&qi(t)},_tr_tally:(t,e,s)=>(t.pending_buf[t.sym_buf+t.sym_next++]=e,t.pending_buf[t.sym_buf+t.sym_next++]=e>>8,t.pending_buf[t.sym_buf+t.sym_next++]=s,0===e?t.dyn_ltree[2*s]++:(t.matches++,e--,t.dyn_ltree[2*(Bi[s]+gi+1)]++,t.dyn_dtree[2*Oi(e)]++),t.sym_next===t.sym_end),_tr_align:t=>{Ui(t,2,3),Di(t,256,zi),(t=>{16===t.bi_valid?(Vi(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(t)}};var tn=(t,e,s,i)=>{let n=65535&t,r=t>>>16&65535,o=0;for(;0!==s;){o=s>2e3?2e3:s,s-=o;do{n=n+e[i++]|0,r=r+n|0}while(--o);n%=65521,r%=65521}return n|r<<16};const en=new Uint32Array((()=>{let t,e=[];for(var s=0;s<256;s++){t=s;for(var i=0;i<8;i++)t=1&t?3988292384^t>>>1:t>>>1;e[s]=t}return e})());var sn=(t,e,s,i)=>{const n=en,r=i+s;t^=-1;for(let s=i;s<r;s++)t=t>>>8^n[255&(t^e[s])];return~t},nn={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},rn={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:on,_tr_stored_block:an,_tr_flush_block:hn,_tr_tally:ln,_tr_align:cn}=Ki,{Z_NO_FLUSH:un,Z_PARTIAL_FLUSH:dn,Z_FULL_FLUSH:pn,Z_FINISH:fn,Z_BLOCK:mn,Z_OK:bn,Z_STREAM_END:yn,Z_STREAM_ERROR:gn,Z_DATA_ERROR:_n,Z_BUF_ERROR:xn,Z_DEFAULT_COMPRESSION:wn,Z_FILTERED:vn,Z_HUFFMAN_ONLY:Mn,Z_RLE:An,Z_FIXED:Sn,Z_DEFAULT_STRATEGY:zn,Z_UNKNOWN:In,Z_DEFLATED:Tn}=rn,Bn=258,Cn=262,En=42,kn=113,Pn=666,Fn=(t,e)=>(t.msg=nn[e],e),Rn=t=>2*t-(t>4?9:0),Ln=t=>{let e=t.length;for(;--e>=0;)t[e]=0},On=t=>{let e,s,i,n=t.w_size;e=t.hash_size,i=e;do{s=t.head[--i],t.head[i]=s>=n?s-n:0}while(--e);e=n,i=e;do{s=t.prev[--i],t.prev[i]=s>=n?s-n:0}while(--e)};let Vn=(t,e,s)=>(e<<t.hash_shift^s)&t.hash_mask;const Un=t=>{const e=t.state;let s=e.pending;s>t.avail_out&&(s=t.avail_out),0!==s&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+s),t.next_out),t.next_out+=s,e.pending_out+=s,t.total_out+=s,t.avail_out-=s,e.pending-=s,0===e.pending&&(e.pending_out=0))},Dn=(t,e)=>{hn(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,Un(t.strm)},Nn=(t,e)=>{t.pending_buf[t.pending++]=e},Wn=(t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e},Zn=(t,e,s,i)=>{let n=t.avail_in;return n>i&&(n=i),0===n?0:(t.avail_in-=n,e.set(t.input.subarray(t.next_in,t.next_in+n),s),1===t.state.wrap?t.adler=tn(t.adler,e,n,s):2===t.state.wrap&&(t.adler=sn(t.adler,e,n,s)),t.next_in+=n,t.total_in+=n,n)},qn=(t,e)=>{let s,i,n=t.max_chain_length,r=t.strstart,o=t.prev_length,a=t.nice_match;const h=t.strstart>t.w_size-Cn?t.strstart-(t.w_size-Cn):0,l=t.window,c=t.w_mask,u=t.prev,d=t.strstart+Bn;let p=l[r+o-1],f=l[r+o];t.prev_length>=t.good_match&&(n>>=2),a>t.lookahead&&(a=t.lookahead);do{if(s=e,l[s+o]===f&&l[s+o-1]===p&&l[s]===l[r]&&l[++s]===l[r+1]){r+=2,s++;do{}while(l[++r]===l[++s]&&l[++r]===l[++s]&&l[++r]===l[++s]&&l[++r]===l[++s]&&l[++r]===l[++s]&&l[++r]===l[++s]&&l[++r]===l[++s]&&l[++r]===l[++s]&&r<d);if(i=Bn-(d-r),r=d-Bn,i>o){if(t.match_start=e,o=i,i>=a)break;p=l[r+o-1],f=l[r+o]}}}while((e=u[e&c])>h&&0!=--n);return o<=t.lookahead?o:t.lookahead},Hn=t=>{const e=t.w_size;let s,i,n;do{if(i=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-Cn)&&(t.window.set(t.window.subarray(e,e+e-i),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,t.insert>t.strstart&&(t.insert=t.strstart),On(t),i+=e),0===t.strm.avail_in)break;if(s=Zn(t.strm,t.window,t.strstart+t.lookahead,i),t.lookahead+=s,t.lookahead+t.insert>=3)for(n=t.strstart-t.insert,t.ins_h=t.window[n],t.ins_h=Vn(t,t.ins_h,t.window[n+1]);t.insert&&(t.ins_h=Vn(t,t.ins_h,t.window[n+3-1]),t.prev[n&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=n,n++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<Cn&&0!==t.strm.avail_in)},jn=(t,e)=>{let s,i,n,r=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,o=0,a=t.strm.avail_in;do{if(s=65535,n=t.bi_valid+42>>3,t.strm.avail_out<n)break;if(n=t.strm.avail_out-n,i=t.strstart-t.block_start,s>i+t.strm.avail_in&&(s=i+t.strm.avail_in),s>n&&(s=n),s<r&&(0===s&&e!==fn||e===un||s!==i+t.strm.avail_in))break;o=e===fn&&s===i+t.strm.avail_in?1:0,an(t,0,0,o),t.pending_buf[t.pending-4]=s,t.pending_buf[t.pending-3]=s>>8,t.pending_buf[t.pending-2]=~s,t.pending_buf[t.pending-1]=~s>>8,Un(t.strm),i&&(i>s&&(i=s),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+i),t.strm.next_out),t.strm.next_out+=i,t.strm.avail_out-=i,t.strm.total_out+=i,t.block_start+=i,s-=i),s&&(Zn(t.strm,t.strm.output,t.strm.next_out,s),t.strm.next_out+=s,t.strm.avail_out-=s,t.strm.total_out+=s)}while(0===o);return a-=t.strm.avail_in,a&&(a>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=a&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-a,t.strm.next_in),t.strstart),t.strstart+=a,t.insert+=a>t.w_size-t.insert?t.w_size-t.insert:a),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),o?4:e!==un&&e!==fn&&0===t.strm.avail_in&&t.strstart===t.block_start?2:(n=t.window_size-t.strstart,t.strm.avail_in>n&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,n+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),n>t.strm.avail_in&&(n=t.strm.avail_in),n&&(Zn(t.strm,t.window,t.strstart,n),t.strstart+=n,t.insert+=n>t.w_size-t.insert?t.w_size-t.insert:n),t.high_water<t.strstart&&(t.high_water=t.strstart),n=t.bi_valid+42>>3,n=t.pending_buf_size-n>65535?65535:t.pending_buf_size-n,r=n>t.w_size?t.w_size:n,i=t.strstart-t.block_start,(i>=r||(i||e===fn)&&e!==un&&0===t.strm.avail_in&&i<=n)&&(s=i>n?n:i,o=e===fn&&0===t.strm.avail_in&&s===i?1:0,an(t,t.block_start,s,o),t.block_start+=s,Un(t.strm)),o?3:1)},Gn=(t,e)=>{let s,i;for(;;){if(t.lookahead<Cn){if(Hn(t),t.lookahead<Cn&&e===un)return 1;if(0===t.lookahead)break}if(s=0,t.lookahead>=3&&(t.ins_h=Vn(t,t.ins_h,t.window[t.strstart+3-1]),s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==s&&t.strstart-s<=t.w_size-Cn&&(t.match_length=qn(t,s)),t.match_length>=3)if(i=ln(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do{t.strstart++,t.ins_h=Vn(t,t.ins_h,t.window[t.strstart+3-1]),s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!=--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=Vn(t,t.ins_h,t.window[t.strstart+1]);else i=ln(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(i&&(Dn(t,!1),0===t.strm.avail_out))return 1}return t.insert=t.strstart<2?t.strstart:2,e===fn?(Dn(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(Dn(t,!1),0===t.strm.avail_out)?1:2},Yn=(t,e)=>{let s,i,n;for(;;){if(t.lookahead<Cn){if(Hn(t),t.lookahead<Cn&&e===un)return 1;if(0===t.lookahead)break}if(s=0,t.lookahead>=3&&(t.ins_h=Vn(t,t.ins_h,t.window[t.strstart+3-1]),s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,0!==s&&t.prev_length<t.max_lazy_match&&t.strstart-s<=t.w_size-Cn&&(t.match_length=qn(t,s),t.match_length<=5&&(t.strategy===vn||3===t.match_length&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){n=t.strstart+t.lookahead-3,i=ln(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=n&&(t.ins_h=Vn(t,t.ins_h,t.window[t.strstart+3-1]),s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!=--t.prev_length);if(t.match_available=0,t.match_length=2,t.strstart++,i&&(Dn(t,!1),0===t.strm.avail_out))return 1}else if(t.match_available){if(i=ln(t,0,t.window[t.strstart-1]),i&&Dn(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(i=ln(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,e===fn?(Dn(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(Dn(t,!1),0===t.strm.avail_out)?1:2};function Xn(t,e,s,i,n){this.good_length=t,this.max_lazy=e,this.nice_length=s,this.max_chain=i,this.func=n}const Jn=[new Xn(0,0,0,0,jn),new Xn(4,4,8,4,Gn),new Xn(4,5,16,8,Gn),new Xn(4,6,32,32,Gn),new Xn(4,4,16,16,Yn),new Xn(8,16,32,32,Yn),new Xn(8,16,128,128,Yn),new Xn(8,32,128,256,Yn),new Xn(32,128,258,1024,Yn),new Xn(32,258,258,4096,Yn)];function Qn(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Tn,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),Ln(this.dyn_ltree),Ln(this.dyn_dtree),Ln(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),Ln(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),Ln(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const $n=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.status!==En&&57!==e.status&&69!==e.status&&73!==e.status&&91!==e.status&&103!==e.status&&e.status!==kn&&e.status!==Pn?1:0},Kn=t=>{if($n(t))return Fn(t,gn);t.total_in=t.total_out=0,t.data_type=In;const e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=2===e.wrap?57:e.wrap?En:kn,t.adler=2===e.wrap?0:1,e.last_flush=-2,on(e),bn},tr=t=>{const e=Kn(t);var s;return e===bn&&((s=t.state).window_size=2*s.w_size,Ln(s.head),s.max_lazy_match=Jn[s.level].max_lazy,s.good_match=Jn[s.level].good_length,s.nice_match=Jn[s.level].nice_length,s.max_chain_length=Jn[s.level].max_chain,s.strstart=0,s.block_start=0,s.lookahead=0,s.insert=0,s.match_length=s.prev_length=2,s.match_available=0,s.ins_h=0),e},er=(t,e,s,i,n,r)=>{if(!t)return gn;let o=1;if(e===wn&&(e=6),i<0?(o=0,i=-i):i>15&&(o=2,i-=16),n<1||n>9||s!==Tn||i<8||i>15||e<0||e>9||r<0||r>Sn||8===i&&1!==o)return Fn(t,gn);8===i&&(i=9);const a=new Qn;return t.state=a,a.strm=t,a.status=En,a.wrap=o,a.gzhead=null,a.w_bits=i,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=n+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+3-1)/3),a.window=new Uint8Array(2*a.w_size),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<n+6,a.pending_buf_size=4*a.lit_bufsize,a.pending_buf=new Uint8Array(a.pending_buf_size),a.sym_buf=a.lit_bufsize,a.sym_end=3*(a.lit_bufsize-1),a.level=e,a.strategy=r,a.method=s,tr(t)};var sr={deflateInit:(t,e)=>er(t,e,Tn,15,8,zn),deflateInit2:er,deflateReset:tr,deflateResetKeep:Kn,deflateSetHeader:(t,e)=>$n(t)||2!==t.state.wrap?gn:(t.state.gzhead=e,bn),deflate:(t,e)=>{if($n(t)||e>mn||e<0)return t?Fn(t,gn):gn;const s=t.state;if(!t.output||0!==t.avail_in&&!t.input||s.status===Pn&&e!==fn)return Fn(t,0===t.avail_out?xn:gn);const i=s.last_flush;if(s.last_flush=e,0!==s.pending){if(Un(t),0===t.avail_out)return s.last_flush=-1,bn}else if(0===t.avail_in&&Rn(e)<=Rn(i)&&e!==fn)return Fn(t,xn);if(s.status===Pn&&0!==t.avail_in)return Fn(t,xn);if(s.status===En&&0===s.wrap&&(s.status=kn),s.status===En){let e=Tn+(s.w_bits-8<<4)<<8,i=-1;if(i=s.strategy>=Mn||s.level<2?0:s.level<6?1:6===s.level?2:3,e|=i<<6,0!==s.strstart&&(e|=32),e+=31-e%31,Wn(s,e),0!==s.strstart&&(Wn(s,t.adler>>>16),Wn(s,65535&t.adler)),t.adler=1,s.status=kn,Un(t),0!==s.pending)return s.last_flush=-1,bn}if(57===s.status)if(t.adler=0,Nn(s,31),Nn(s,139),Nn(s,8),s.gzhead)Nn(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),Nn(s,255&s.gzhead.time),Nn(s,s.gzhead.time>>8&255),Nn(s,s.gzhead.time>>16&255),Nn(s,s.gzhead.time>>24&255),Nn(s,9===s.level?2:s.strategy>=Mn||s.level<2?4:0),Nn(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(Nn(s,255&s.gzhead.extra.length),Nn(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(t.adler=sn(t.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=69;else if(Nn(s,0),Nn(s,0),Nn(s,0),Nn(s,0),Nn(s,0),Nn(s,9===s.level?2:s.strategy>=Mn||s.level<2?4:0),Nn(s,3),s.status=kn,Un(t),0!==s.pending)return s.last_flush=-1,bn;if(69===s.status){if(s.gzhead.extra){let e=s.pending,i=(65535&s.gzhead.extra.length)-s.gzindex;for(;s.pending+i>s.pending_buf_size;){let n=s.pending_buf_size-s.pending;if(s.pending_buf.set(s.gzhead.extra.subarray(s.gzindex,s.gzindex+n),s.pending),s.pending=s.pending_buf_size,s.gzhead.hcrc&&s.pending>e&&(t.adler=sn(t.adler,s.pending_buf,s.pending-e,e)),s.gzindex+=n,Un(t),0!==s.pending)return s.last_flush=-1,bn;e=0,i-=n}let n=new Uint8Array(s.gzhead.extra);s.pending_buf.set(n.subarray(s.gzindex,s.gzindex+i),s.pending),s.pending+=i,s.gzhead.hcrc&&s.pending>e&&(t.adler=sn(t.adler,s.pending_buf,s.pending-e,e)),s.gzindex=0}s.status=73}if(73===s.status){if(s.gzhead.name){let e,i=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>i&&(t.adler=sn(t.adler,s.pending_buf,s.pending-i,i)),Un(t),0!==s.pending)return s.last_flush=-1,bn;i=0}e=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,Nn(s,e)}while(0!==e);s.gzhead.hcrc&&s.pending>i&&(t.adler=sn(t.adler,s.pending_buf,s.pending-i,i)),s.gzindex=0}s.status=91}if(91===s.status){if(s.gzhead.comment){let e,i=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>i&&(t.adler=sn(t.adler,s.pending_buf,s.pending-i,i)),Un(t),0!==s.pending)return s.last_flush=-1,bn;i=0}e=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,Nn(s,e)}while(0!==e);s.gzhead.hcrc&&s.pending>i&&(t.adler=sn(t.adler,s.pending_buf,s.pending-i,i))}s.status=103}if(103===s.status){if(s.gzhead.hcrc){if(s.pending+2>s.pending_buf_size&&(Un(t),0!==s.pending))return s.last_flush=-1,bn;Nn(s,255&t.adler),Nn(s,t.adler>>8&255),t.adler=0}if(s.status=kn,Un(t),0!==s.pending)return s.last_flush=-1,bn}if(0!==t.avail_in||0!==s.lookahead||e!==un&&s.status!==Pn){let i=0===s.level?jn(s,e):s.strategy===Mn?((t,e)=>{let s;for(;;){if(0===t.lookahead&&(Hn(t),0===t.lookahead)){if(e===un)return 1;break}if(t.match_length=0,s=ln(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,s&&(Dn(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===fn?(Dn(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(Dn(t,!1),0===t.strm.avail_out)?1:2})(s,e):s.strategy===An?((t,e)=>{let s,i,n,r;const o=t.window;for(;;){if(t.lookahead<=Bn){if(Hn(t),t.lookahead<=Bn&&e===un)return 1;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=3&&t.strstart>0&&(n=t.strstart-1,i=o[n],i===o[++n]&&i===o[++n]&&i===o[++n])){r=t.strstart+Bn;do{}while(i===o[++n]&&i===o[++n]&&i===o[++n]&&i===o[++n]&&i===o[++n]&&i===o[++n]&&i===o[++n]&&i===o[++n]&&n<r);t.match_length=Bn-(r-n),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=3?(s=ln(t,1,t.match_length-3),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(s=ln(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),s&&(Dn(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===fn?(Dn(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(Dn(t,!1),0===t.strm.avail_out)?1:2})(s,e):Jn[s.level].func(s,e);if(3!==i&&4!==i||(s.status=Pn),1===i||3===i)return 0===t.avail_out&&(s.last_flush=-1),bn;if(2===i&&(e===dn?cn(s):e!==mn&&(an(s,0,0,!1),e===pn&&(Ln(s.head),0===s.lookahead&&(s.strstart=0,s.block_start=0,s.insert=0))),Un(t),0===t.avail_out))return s.last_flush=-1,bn}return e!==fn?bn:s.wrap<=0?yn:(2===s.wrap?(Nn(s,255&t.adler),Nn(s,t.adler>>8&255),Nn(s,t.adler>>16&255),Nn(s,t.adler>>24&255),Nn(s,255&t.total_in),Nn(s,t.total_in>>8&255),Nn(s,t.total_in>>16&255),Nn(s,t.total_in>>24&255)):(Wn(s,t.adler>>>16),Wn(s,65535&t.adler)),Un(t),s.wrap>0&&(s.wrap=-s.wrap),0!==s.pending?bn:yn)},deflateEnd:t=>{if($n(t))return gn;const e=t.state.status;return t.state=null,e===kn?Fn(t,_n):bn},deflateSetDictionary:(t,e)=>{let s=e.length;if($n(t))return gn;const i=t.state,n=i.wrap;if(2===n||1===n&&i.status!==En||i.lookahead)return gn;if(1===n&&(t.adler=tn(t.adler,e,s,0)),i.wrap=0,s>=i.w_size){0===n&&(Ln(i.head),i.strstart=0,i.block_start=0,i.insert=0);let t=new Uint8Array(i.w_size);t.set(e.subarray(s-i.w_size,s),0),e=t,s=i.w_size}const r=t.avail_in,o=t.next_in,a=t.input;for(t.avail_in=s,t.next_in=0,t.input=e,Hn(i);i.lookahead>=3;){let t=i.strstart,e=i.lookahead-2;do{i.ins_h=Vn(i,i.ins_h,i.window[t+3-1]),i.prev[t&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=t,t++}while(--e);i.strstart=t,i.lookahead=2,Hn(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,t.next_in=o,t.input=a,t.avail_in=r,i.wrap=n,bn},deflateInfo:"pako deflate (from Nodeca project)"};const ir=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var nr=function(t){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const s=e.shift();if(s){if("object"!=typeof s)throw new TypeError(s+"must be non-object");for(const e in s)ir(s,e)&&(t[e]=s[e])}}return t},rr=t=>{let e=0;for(let s=0,i=t.length;s<i;s++)e+=t[s].length;const s=new Uint8Array(e);for(let e=0,i=0,n=t.length;e<n;e++){let n=t[e];s.set(n,i),i+=n.length}return s};let or=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){or=!1}const ar=new Uint8Array(256);for(let t=0;t<256;t++)ar[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;ar[254]=ar[254]=1;var hr=t=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(t);let e,s,i,n,r,o=t.length,a=0;for(n=0;n<o;n++)s=t.charCodeAt(n),55296==(64512&s)&&n+1<o&&(i=t.charCodeAt(n+1),56320==(64512&i)&&(s=65536+(s-55296<<10)+(i-56320),n++)),a+=s<128?1:s<2048?2:s<65536?3:4;for(e=new Uint8Array(a),r=0,n=0;r<a;n++)s=t.charCodeAt(n),55296==(64512&s)&&n+1<o&&(i=t.charCodeAt(n+1),56320==(64512&i)&&(s=65536+(s-55296<<10)+(i-56320),n++)),s<128?e[r++]=s:s<2048?(e[r++]=192|s>>>6,e[r++]=128|63&s):s<65536?(e[r++]=224|s>>>12,e[r++]=128|s>>>6&63,e[r++]=128|63&s):(e[r++]=240|s>>>18,e[r++]=128|s>>>12&63,e[r++]=128|s>>>6&63,e[r++]=128|63&s);return e},lr=(t,e)=>{const s=e||t.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(t.subarray(0,e));let i,n;const r=new Array(2*s);for(n=0,i=0;i<s;){let e=t[i++];if(e<128){r[n++]=e;continue}let o=ar[e];if(o>4)r[n++]=65533,i+=o-1;else{for(e&=2===o?31:3===o?15:7;o>1&&i<s;)e=e<<6|63&t[i++],o--;o>1?r[n++]=65533:e<65536?r[n++]=e:(e-=65536,r[n++]=55296|e>>10&1023,r[n++]=56320|1023&e)}}return((t,e)=>{if(e<65534&&t.subarray&&or)return String.fromCharCode.apply(null,t.length===e?t:t.subarray(0,e));let s="";for(let i=0;i<e;i++)s+=String.fromCharCode(t[i]);return s})(r,n)},cr=(t,e)=>{(e=e||t.length)>t.length&&(e=t.length);let s=e-1;for(;s>=0&&128==(192&t[s]);)s--;return s<0||0===s?e:s+ar[t[s]]>e?s:e};var ur=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const dr=Object.prototype.toString,{Z_NO_FLUSH:pr,Z_SYNC_FLUSH:fr,Z_FULL_FLUSH:mr,Z_FINISH:br,Z_OK:yr,Z_STREAM_END:gr,Z_DEFAULT_COMPRESSION:_r,Z_DEFAULT_STRATEGY:xr,Z_DEFLATED:wr}=rn;function vr(t){this.options=nr({level:_r,method:wr,chunkSize:16384,windowBits:15,memLevel:8,strategy:xr},t||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ur,this.strm.avail_out=0;let s=sr.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(s!==yr)throw new Error(nn[s]);if(e.header&&sr.deflateSetHeader(this.strm,e.header),e.dictionary){let t;if(t="string"==typeof e.dictionary?hr(e.dictionary):"[object ArrayBuffer]"===dr.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,s=sr.deflateSetDictionary(this.strm,t),s!==yr)throw new Error(nn[s]);this._dict_set=!0}}function Mr(t,e){const s=new vr(e);if(s.push(t,!0),s.err)throw s.msg||nn[s.err];return s.result}vr.prototype.push=function(t,e){const s=this.strm,i=this.options.chunkSize;let n,r;if(this.ended)return!1;for(r=e===~~e?e:!0===e?br:pr,"string"==typeof t?s.input=hr(t):"[object ArrayBuffer]"===dr.call(t)?s.input=new Uint8Array(t):s.input=t,s.next_in=0,s.avail_in=s.input.length;;)if(0===s.avail_out&&(s.output=new Uint8Array(i),s.next_out=0,s.avail_out=i),(r===fr||r===mr)&&s.avail_out<=6)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else{if(n=sr.deflate(s,r),n===gr)return s.next_out>0&&this.onData(s.output.subarray(0,s.next_out)),n=sr.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===yr;if(0!==s.avail_out){if(r>0&&s.next_out>0)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else if(0===s.avail_in)break}else this.onData(s.output)}return!0},vr.prototype.onData=function(t){this.chunks.push(t)},vr.prototype.onEnd=function(t){t===yr&&(this.result=rr(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var Ar={Deflate:vr,deflate:Mr,deflateRaw:function(t,e){return(e=e||{}).raw=!0,Mr(t,e)},gzip:function(t,e){return(e=e||{}).gzip=!0,Mr(t,e)}};const Sr=16209;var zr=function(t,e){let s,i,n,r,o,a,h,l,c,u,d,p,f,m,b,y,g,_,x,w,v,M,A,S;const z=t.state;s=t.next_in,A=t.input,i=s+(t.avail_in-5),n=t.next_out,S=t.output,r=n-(e-t.avail_out),o=n+(t.avail_out-257),a=z.dmax,h=z.wsize,l=z.whave,c=z.wnext,u=z.window,d=z.hold,p=z.bits,f=z.lencode,m=z.distcode,b=(1<<z.lenbits)-1,y=(1<<z.distbits)-1;t:do{p<15&&(d+=A[s++]<<p,p+=8,d+=A[s++]<<p,p+=8),g=f[d&b];e:for(;;){if(_=g>>>24,d>>>=_,p-=_,_=g>>>16&255,0===_)S[n++]=65535&g;else{if(!(16&_)){if(64&_){if(32&_){z.mode=16191;break t}t.msg="invalid literal/length code",z.mode=Sr;break t}g=f[(65535&g)+(d&(1<<_)-1)];continue e}for(x=65535&g,_&=15,_&&(p<_&&(d+=A[s++]<<p,p+=8),x+=d&(1<<_)-1,d>>>=_,p-=_),p<15&&(d+=A[s++]<<p,p+=8,d+=A[s++]<<p,p+=8),g=m[d&y];;){if(_=g>>>24,d>>>=_,p-=_,_=g>>>16&255,16&_){if(w=65535&g,_&=15,p<_&&(d+=A[s++]<<p,p+=8,p<_&&(d+=A[s++]<<p,p+=8)),w+=d&(1<<_)-1,w>a){t.msg="invalid distance too far back",z.mode=Sr;break t}if(d>>>=_,p-=_,_=n-r,w>_){if(_=w-_,_>l&&z.sane){t.msg="invalid distance too far back",z.mode=Sr;break t}if(v=0,M=u,0===c){if(v+=h-_,_<x){x-=_;do{S[n++]=u[v++]}while(--_);v=n-w,M=S}}else if(c<_){if(v+=h+c-_,_-=c,_<x){x-=_;do{S[n++]=u[v++]}while(--_);if(v=0,c<x){_=c,x-=_;do{S[n++]=u[v++]}while(--_);v=n-w,M=S}}}else if(v+=c-_,_<x){x-=_;do{S[n++]=u[v++]}while(--_);v=n-w,M=S}for(;x>2;)S[n++]=M[v++],S[n++]=M[v++],S[n++]=M[v++],x-=3;x&&(S[n++]=M[v++],x>1&&(S[n++]=M[v++]))}else{v=n-w;do{S[n++]=S[v++],S[n++]=S[v++],S[n++]=S[v++],x-=3}while(x>2);x&&(S[n++]=S[v++],x>1&&(S[n++]=S[v++]))}break}if(64&_){t.msg="invalid distance code",z.mode=Sr;break t}g=m[(65535&g)+(d&(1<<_)-1)]}}break}}while(s<i&&n<o);x=p>>3,s-=x,p-=x<<3,d&=(1<<p)-1,t.next_in=s,t.next_out=n,t.avail_in=s<i?i-s+5:5-(s-i),t.avail_out=n<o?o-n+257:257-(n-o),z.hold=d,z.bits=p};const Ir=15,Tr=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Br=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Cr=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Er=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var kr=(t,e,s,i,n,r,o,a)=>{const h=a.bits;let l,c,u,d,p,f,m=0,b=0,y=0,g=0,_=0,x=0,w=0,v=0,M=0,A=0,S=null;const z=new Uint16Array(16),I=new Uint16Array(16);let T,B,C,E=null;for(m=0;m<=Ir;m++)z[m]=0;for(b=0;b<i;b++)z[e[s+b]]++;for(_=h,g=Ir;g>=1&&0===z[g];g--);if(_>g&&(_=g),0===g)return n[r++]=20971520,n[r++]=20971520,a.bits=1,0;for(y=1;y<g&&0===z[y];y++);for(_<y&&(_=y),v=1,m=1;m<=Ir;m++)if(v<<=1,v-=z[m],v<0)return-1;if(v>0&&(0===t||1!==g))return-1;for(I[1]=0,m=1;m<Ir;m++)I[m+1]=I[m]+z[m];for(b=0;b<i;b++)0!==e[s+b]&&(o[I[e[s+b]]++]=b);if(0===t?(S=E=o,f=20):1===t?(S=Tr,E=Br,f=257):(S=Cr,E=Er,f=0),A=0,b=0,m=y,p=r,x=_,w=0,u=-1,M=1<<_,d=M-1,1===t&&M>852||2===t&&M>592)return 1;for(;;){T=m-w,o[b]+1<f?(B=0,C=o[b]):o[b]>=f?(B=E[o[b]-f],C=S[o[b]-f]):(B=96,C=0),l=1<<m-w,c=1<<x,y=c;do{c-=l,n[p+(A>>w)+c]=T<<24|B<<16|C}while(0!==c);for(l=1<<m-1;A&l;)l>>=1;if(0!==l?(A&=l-1,A+=l):A=0,b++,0==--z[m]){if(m===g)break;m=e[s+o[b]]}if(m>_&&(A&d)!==u){for(0===w&&(w=_),p+=y,x=m-w,v=1<<x;x+w<g&&(v-=z[x+w],!(v<=0));)x++,v<<=1;if(M+=1<<x,1===t&&M>852||2===t&&M>592)return 1;u=A&d,n[u]=_<<24|x<<16|p-r}}return 0!==A&&(n[p+A]=m-w<<24|64<<16),a.bits=_,0};const{Z_FINISH:Pr,Z_BLOCK:Fr,Z_TREES:Rr,Z_OK:Lr,Z_STREAM_END:Or,Z_NEED_DICT:Vr,Z_STREAM_ERROR:Ur,Z_DATA_ERROR:Dr,Z_MEM_ERROR:Nr,Z_BUF_ERROR:Wr,Z_DEFLATED:Zr}=rn,qr=16180,Hr=16190,jr=16191,Gr=16192,Yr=16194,Xr=16199,Jr=16200,Qr=16206,$r=16209,Kr=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function to(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const eo=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.mode<qr||e.mode>16211?1:0},so=t=>{if(eo(t))return Ur;const e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=qr,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(852),e.distcode=e.distdyn=new Int32Array(592),e.sane=1,e.back=-1,Lr},io=t=>{if(eo(t))return Ur;const e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,so(t)},no=(t,e)=>{let s;if(eo(t))return Ur;const i=t.state;return e<0?(s=0,e=-e):(s=5+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?Ur:(null!==i.window&&i.wbits!==e&&(i.window=null),i.wrap=s,i.wbits=e,io(t))},ro=(t,e)=>{if(!t)return Ur;const s=new to;t.state=s,s.strm=t,s.window=null,s.mode=qr;const i=no(t,e);return i!==Lr&&(t.state=null),i};let oo,ao,ho=!0;const lo=t=>{if(ho){oo=new Int32Array(512),ao=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(kr(1,t.lens,0,288,oo,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;kr(2,t.lens,0,32,ao,0,t.work,{bits:5}),ho=!1}t.lencode=oo,t.lenbits=9,t.distcode=ao,t.distbits=5},co=(t,e,s,i)=>{let n;const r=t.state;return null===r.window&&(r.wsize=1<<r.wbits,r.wnext=0,r.whave=0,r.window=new Uint8Array(r.wsize)),i>=r.wsize?(r.window.set(e.subarray(s-r.wsize,s),0),r.wnext=0,r.whave=r.wsize):(n=r.wsize-r.wnext,n>i&&(n=i),r.window.set(e.subarray(s-i,s-i+n),r.wnext),(i-=n)?(r.window.set(e.subarray(s-i,s),0),r.wnext=i,r.whave=r.wsize):(r.wnext+=n,r.wnext===r.wsize&&(r.wnext=0),r.whave<r.wsize&&(r.whave+=n))),0};var uo={inflateReset:io,inflateReset2:no,inflateResetKeep:so,inflateInit:t=>ro(t,15),inflateInit2:ro,inflate:(t,e)=>{let s,i,n,r,o,a,h,l,c,u,d,p,f,m,b,y,g,_,x,w,v,M,A=0;const S=new Uint8Array(4);let z,I;const T=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(eo(t)||!t.output||!t.input&&0!==t.avail_in)return Ur;s=t.state,s.mode===jr&&(s.mode=Gr),o=t.next_out,n=t.output,h=t.avail_out,r=t.next_in,i=t.input,a=t.avail_in,l=s.hold,c=s.bits,u=a,d=h,M=Lr;t:for(;;)switch(s.mode){case qr:if(0===s.wrap){s.mode=Gr;break}for(;c<16;){if(0===a)break t;a--,l+=i[r++]<<c,c+=8}if(2&s.wrap&&35615===l){0===s.wbits&&(s.wbits=15),s.check=0,S[0]=255&l,S[1]=l>>>8&255,s.check=sn(s.check,S,2,0),l=0,c=0,s.mode=16181;break}if(s.head&&(s.head.done=!1),!(1&s.wrap)||(((255&l)<<8)+(l>>8))%31){t.msg="incorrect header check",s.mode=$r;break}if((15&l)!==Zr){t.msg="unknown compression method",s.mode=$r;break}if(l>>>=4,c-=4,v=8+(15&l),0===s.wbits&&(s.wbits=v),v>15||v>s.wbits){t.msg="invalid window size",s.mode=$r;break}s.dmax=1<<s.wbits,s.flags=0,t.adler=s.check=1,s.mode=512&l?16189:jr,l=0,c=0;break;case 16181:for(;c<16;){if(0===a)break t;a--,l+=i[r++]<<c,c+=8}if(s.flags=l,(255&s.flags)!==Zr){t.msg="unknown compression method",s.mode=$r;break}if(57344&s.flags){t.msg="unknown header flags set",s.mode=$r;break}s.head&&(s.head.text=l>>8&1),512&s.flags&&4&s.wrap&&(S[0]=255&l,S[1]=l>>>8&255,s.check=sn(s.check,S,2,0)),l=0,c=0,s.mode=16182;case 16182:for(;c<32;){if(0===a)break t;a--,l+=i[r++]<<c,c+=8}s.head&&(s.head.time=l),512&s.flags&&4&s.wrap&&(S[0]=255&l,S[1]=l>>>8&255,S[2]=l>>>16&255,S[3]=l>>>24&255,s.check=sn(s.check,S,4,0)),l=0,c=0,s.mode=16183;case 16183:for(;c<16;){if(0===a)break t;a--,l+=i[r++]<<c,c+=8}s.head&&(s.head.xflags=255&l,s.head.os=l>>8),512&s.flags&&4&s.wrap&&(S[0]=255&l,S[1]=l>>>8&255,s.check=sn(s.check,S,2,0)),l=0,c=0,s.mode=16184;case 16184:if(1024&s.flags){for(;c<16;){if(0===a)break t;a--,l+=i[r++]<<c,c+=8}s.length=l,s.head&&(s.head.extra_len=l),512&s.flags&&4&s.wrap&&(S[0]=255&l,S[1]=l>>>8&255,s.check=sn(s.check,S,2,0)),l=0,c=0}else s.head&&(s.head.extra=null);s.mode=16185;case 16185:if(1024&s.flags&&(p=s.length,p>a&&(p=a),p&&(s.head&&(v=s.head.extra_len-s.length,s.head.extra||(s.head.extra=new Uint8Array(s.head.extra_len)),s.head.extra.set(i.subarray(r,r+p),v)),512&s.flags&&4&s.wrap&&(s.check=sn(s.check,i,p,r)),a-=p,r+=p,s.length-=p),s.length))break t;s.length=0,s.mode=16186;case 16186:if(2048&s.flags){if(0===a)break t;p=0;do{v=i[r+p++],s.head&&v&&s.length<65536&&(s.head.name+=String.fromCharCode(v))}while(v&&p<a);if(512&s.flags&&4&s.wrap&&(s.check=sn(s.check,i,p,r)),a-=p,r+=p,v)break t}else s.head&&(s.head.name=null);s.length=0,s.mode=16187;case 16187:if(4096&s.flags){if(0===a)break t;p=0;do{v=i[r+p++],s.head&&v&&s.length<65536&&(s.head.comment+=String.fromCharCode(v))}while(v&&p<a);if(512&s.flags&&4&s.wrap&&(s.check=sn(s.check,i,p,r)),a-=p,r+=p,v)break t}else s.head&&(s.head.comment=null);s.mode=16188;case 16188:if(512&s.flags){for(;c<16;){if(0===a)break t;a--,l+=i[r++]<<c,c+=8}if(4&s.wrap&&l!==(65535&s.check)){t.msg="header crc mismatch",s.mode=$r;break}l=0,c=0}s.head&&(s.head.hcrc=s.flags>>9&1,s.head.done=!0),t.adler=s.check=0,s.mode=jr;break;case 16189:for(;c<32;){if(0===a)break t;a--,l+=i[r++]<<c,c+=8}t.adler=s.check=Kr(l),l=0,c=0,s.mode=Hr;case Hr:if(0===s.havedict)return t.next_out=o,t.avail_out=h,t.next_in=r,t.avail_in=a,s.hold=l,s.bits=c,Vr;t.adler=s.check=1,s.mode=jr;case jr:if(e===Fr||e===Rr)break t;case Gr:if(s.last){l>>>=7&c,c-=7&c,s.mode=Qr;break}for(;c<3;){if(0===a)break t;a--,l+=i[r++]<<c,c+=8}switch(s.last=1&l,l>>>=1,c-=1,3&l){case 0:s.mode=16193;break;case 1:if(lo(s),s.mode=Xr,e===Rr){l>>>=2,c-=2;break t}break;case 2:s.mode=16196;break;case 3:t.msg="invalid block type",s.mode=$r}l>>>=2,c-=2;break;case 16193:for(l>>>=7&c,c-=7&c;c<32;){if(0===a)break t;a--,l+=i[r++]<<c,c+=8}if((65535&l)!=(l>>>16^65535)){t.msg="invalid stored block lengths",s.mode=$r;break}if(s.length=65535&l,l=0,c=0,s.mode=Yr,e===Rr)break t;case Yr:s.mode=16195;case 16195:if(p=s.length,p){if(p>a&&(p=a),p>h&&(p=h),0===p)break t;n.set(i.subarray(r,r+p),o),a-=p,r+=p,h-=p,o+=p,s.length-=p;break}s.mode=jr;break;case 16196:for(;c<14;){if(0===a)break t;a--,l+=i[r++]<<c,c+=8}if(s.nlen=257+(31&l),l>>>=5,c-=5,s.ndist=1+(31&l),l>>>=5,c-=5,s.ncode=4+(15&l),l>>>=4,c-=4,s.nlen>286||s.ndist>30){t.msg="too many length or distance symbols",s.mode=$r;break}s.have=0,s.mode=16197;case 16197:for(;s.have<s.ncode;){for(;c<3;){if(0===a)break t;a--,l+=i[r++]<<c,c+=8}s.lens[T[s.have++]]=7&l,l>>>=3,c-=3}for(;s.have<19;)s.lens[T[s.have++]]=0;if(s.lencode=s.lendyn,s.lenbits=7,z={bits:s.lenbits},M=kr(0,s.lens,0,19,s.lencode,0,s.work,z),s.lenbits=z.bits,M){t.msg="invalid code lengths set",s.mode=$r;break}s.have=0,s.mode=16198;case 16198:for(;s.have<s.nlen+s.ndist;){for(;A=s.lencode[l&(1<<s.lenbits)-1],b=A>>>24,y=A>>>16&255,g=65535&A,!(b<=c);){if(0===a)break t;a--,l+=i[r++]<<c,c+=8}if(g<16)l>>>=b,c-=b,s.lens[s.have++]=g;else{if(16===g){for(I=b+2;c<I;){if(0===a)break t;a--,l+=i[r++]<<c,c+=8}if(l>>>=b,c-=b,0===s.have){t.msg="invalid bit length repeat",s.mode=$r;break}v=s.lens[s.have-1],p=3+(3&l),l>>>=2,c-=2}else if(17===g){for(I=b+3;c<I;){if(0===a)break t;a--,l+=i[r++]<<c,c+=8}l>>>=b,c-=b,v=0,p=3+(7&l),l>>>=3,c-=3}else{for(I=b+7;c<I;){if(0===a)break t;a--,l+=i[r++]<<c,c+=8}l>>>=b,c-=b,v=0,p=11+(127&l),l>>>=7,c-=7}if(s.have+p>s.nlen+s.ndist){t.msg="invalid bit length repeat",s.mode=$r;break}for(;p--;)s.lens[s.have++]=v}}if(s.mode===$r)break;if(0===s.lens[256]){t.msg="invalid code -- missing end-of-block",s.mode=$r;break}if(s.lenbits=9,z={bits:s.lenbits},M=kr(1,s.lens,0,s.nlen,s.lencode,0,s.work,z),s.lenbits=z.bits,M){t.msg="invalid literal/lengths set",s.mode=$r;break}if(s.distbits=6,s.distcode=s.distdyn,z={bits:s.distbits},M=kr(2,s.lens,s.nlen,s.ndist,s.distcode,0,s.work,z),s.distbits=z.bits,M){t.msg="invalid distances set",s.mode=$r;break}if(s.mode=Xr,e===Rr)break t;case Xr:s.mode=Jr;case Jr:if(a>=6&&h>=258){t.next_out=o,t.avail_out=h,t.next_in=r,t.avail_in=a,s.hold=l,s.bits=c,zr(t,d),o=t.next_out,n=t.output,h=t.avail_out,r=t.next_in,i=t.input,a=t.avail_in,l=s.hold,c=s.bits,s.mode===jr&&(s.back=-1);break}for(s.back=0;A=s.lencode[l&(1<<s.lenbits)-1],b=A>>>24,y=A>>>16&255,g=65535&A,!(b<=c);){if(0===a)break t;a--,l+=i[r++]<<c,c+=8}if(y&&!(240&y)){for(_=b,x=y,w=g;A=s.lencode[w+((l&(1<<_+x)-1)>>_)],b=A>>>24,y=A>>>16&255,g=65535&A,!(_+b<=c);){if(0===a)break t;a--,l+=i[r++]<<c,c+=8}l>>>=_,c-=_,s.back+=_}if(l>>>=b,c-=b,s.back+=b,s.length=g,0===y){s.mode=16205;break}if(32&y){s.back=-1,s.mode=jr;break}if(64&y){t.msg="invalid literal/length code",s.mode=$r;break}s.extra=15&y,s.mode=16201;case 16201:if(s.extra){for(I=s.extra;c<I;){if(0===a)break t;a--,l+=i[r++]<<c,c+=8}s.length+=l&(1<<s.extra)-1,l>>>=s.extra,c-=s.extra,s.back+=s.extra}s.was=s.length,s.mode=16202;case 16202:for(;A=s.distcode[l&(1<<s.distbits)-1],b=A>>>24,y=A>>>16&255,g=65535&A,!(b<=c);){if(0===a)break t;a--,l+=i[r++]<<c,c+=8}if(!(240&y)){for(_=b,x=y,w=g;A=s.distcode[w+((l&(1<<_+x)-1)>>_)],b=A>>>24,y=A>>>16&255,g=65535&A,!(_+b<=c);){if(0===a)break t;a--,l+=i[r++]<<c,c+=8}l>>>=_,c-=_,s.back+=_}if(l>>>=b,c-=b,s.back+=b,64&y){t.msg="invalid distance code",s.mode=$r;break}s.offset=g,s.extra=15&y,s.mode=16203;case 16203:if(s.extra){for(I=s.extra;c<I;){if(0===a)break t;a--,l+=i[r++]<<c,c+=8}s.offset+=l&(1<<s.extra)-1,l>>>=s.extra,c-=s.extra,s.back+=s.extra}if(s.offset>s.dmax){t.msg="invalid distance too far back",s.mode=$r;break}s.mode=16204;case 16204:if(0===h)break t;if(p=d-h,s.offset>p){if(p=s.offset-p,p>s.whave&&s.sane){t.msg="invalid distance too far back",s.mode=$r;break}p>s.wnext?(p-=s.wnext,f=s.wsize-p):f=s.wnext-p,p>s.length&&(p=s.length),m=s.window}else m=n,f=o-s.offset,p=s.length;p>h&&(p=h),h-=p,s.length-=p;do{n[o++]=m[f++]}while(--p);0===s.length&&(s.mode=Jr);break;case 16205:if(0===h)break t;n[o++]=s.length,h--,s.mode=Jr;break;case Qr:if(s.wrap){for(;c<32;){if(0===a)break t;a--,l|=i[r++]<<c,c+=8}if(d-=h,t.total_out+=d,s.total+=d,4&s.wrap&&d&&(t.adler=s.check=s.flags?sn(s.check,n,d,o-d):tn(s.check,n,d,o-d)),d=h,4&s.wrap&&(s.flags?l:Kr(l))!==s.check){t.msg="incorrect data check",s.mode=$r;break}l=0,c=0}s.mode=16207;case 16207:if(s.wrap&&s.flags){for(;c<32;){if(0===a)break t;a--,l+=i[r++]<<c,c+=8}if(4&s.wrap&&l!==(4294967295&s.total)){t.msg="incorrect length check",s.mode=$r;break}l=0,c=0}s.mode=16208;case 16208:M=Or;break t;case $r:M=Dr;break t;case 16210:return Nr;default:return Ur}return t.next_out=o,t.avail_out=h,t.next_in=r,t.avail_in=a,s.hold=l,s.bits=c,(s.wsize||d!==t.avail_out&&s.mode<$r&&(s.mode<Qr||e!==Pr))&&co(t,t.output,t.next_out,d-t.avail_out),u-=t.avail_in,d-=t.avail_out,t.total_in+=u,t.total_out+=d,s.total+=d,4&s.wrap&&d&&(t.adler=s.check=s.flags?sn(s.check,n,d,t.next_out-d):tn(s.check,n,d,t.next_out-d)),t.data_type=s.bits+(s.last?64:0)+(s.mode===jr?128:0)+(s.mode===Xr||s.mode===Yr?256:0),(0===u&&0===d||e===Pr)&&M===Lr&&(M=Wr),M},inflateEnd:t=>{if(eo(t))return Ur;let e=t.state;return e.window&&(e.window=null),t.state=null,Lr},inflateGetHeader:(t,e)=>{if(eo(t))return Ur;const s=t.state;return 2&s.wrap?(s.head=e,e.done=!1,Lr):Ur},inflateSetDictionary:(t,e)=>{const s=e.length;let i,n,r;return eo(t)?Ur:(i=t.state,0!==i.wrap&&i.mode!==Hr?Ur:i.mode===Hr&&(n=1,n=tn(n,e,s,0),n!==i.check)?Dr:(r=co(t,e,s,s),r?(i.mode=16210,Nr):(i.havedict=1,Lr)))},inflateInfo:"pako inflate (from Nodeca project)"};var po=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const fo=Object.prototype.toString,{Z_NO_FLUSH:mo,Z_FINISH:bo,Z_OK:yo,Z_STREAM_END:go,Z_NEED_DICT:_o,Z_STREAM_ERROR:xo,Z_DATA_ERROR:wo,Z_MEM_ERROR:vo}=rn;function Mo(t){this.options=nr({chunkSize:65536,windowBits:15,to:""},t||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(15&e.windowBits||(e.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ur,this.strm.avail_out=0;let s=uo.inflateInit2(this.strm,e.windowBits);if(s!==yo)throw new Error(nn[s]);if(this.header=new po,uo.inflateGetHeader(this.strm,this.header),e.dictionary&&("string"==typeof e.dictionary?e.dictionary=hr(e.dictionary):"[object ArrayBuffer]"===fo.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(s=uo.inflateSetDictionary(this.strm,e.dictionary),s!==yo)))throw new Error(nn[s])}function Ao(t,e){const s=new Mo(e);if(s.push(t),s.err)throw s.msg||nn[s.err];return s.result}Mo.prototype.push=function(t,e){const s=this.strm,i=this.options.chunkSize,n=this.options.dictionary;let r,o,a;if(this.ended)return!1;for(o=e===~~e?e:!0===e?bo:mo,"[object ArrayBuffer]"===fo.call(t)?s.input=new Uint8Array(t):s.input=t,s.next_in=0,s.avail_in=s.input.length;;){for(0===s.avail_out&&(s.output=new Uint8Array(i),s.next_out=0,s.avail_out=i),r=uo.inflate(s,o),r===_o&&n&&(r=uo.inflateSetDictionary(s,n),r===yo?r=uo.inflate(s,o):r===wo&&(r=_o));s.avail_in>0&&r===go&&s.state.wrap>0&&0!==t[s.next_in];)uo.inflateReset(s),r=uo.inflate(s,o);switch(r){case xo:case wo:case _o:case vo:return this.onEnd(r),this.ended=!0,!1}if(a=s.avail_out,s.next_out&&(0===s.avail_out||r===go))if("string"===this.options.to){let t=cr(s.output,s.next_out),e=s.next_out-t,n=lr(s.output,t);s.next_out=e,s.avail_out=i-e,e&&s.output.set(s.output.subarray(t,t+e),0),this.onData(n)}else this.onData(s.output.length===s.next_out?s.output:s.output.subarray(0,s.next_out));if(r!==yo||0!==a){if(r===go)return r=uo.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,!0;if(0===s.avail_in)break}}return!0},Mo.prototype.onData=function(t){this.chunks.push(t)},Mo.prototype.onEnd=function(t){t===yo&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=rr(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var So={Inflate:Mo,inflate:Ao,inflateRaw:function(t,e){return(e=e||{}).raw=!0,Ao(t,e)},ungzip:Ao};const{Deflate:zo,deflate:Io,deflateRaw:To,gzip:Bo}=Ar,{Inflate:Co,inflate:Eo,inflateRaw:ko,ungzip:Po}=So;var Fo={Deflate:zo,deflate:Io,deflateRaw:To,gzip:Bo,Inflate:Co,inflate:Eo,inflateRaw:ko,ungzip:Po,constants:rn};const Ro=65536;var Lo=(t=>(t[t.POINT=0]="POINT",t[t.LINE=1]="LINE",t[t.FACE=2]="FACE",t))(Lo||{}),Oo=(t=>(t[t.LINE=0]="LINE",t[t.MESH=1]="MESH",t))(Oo||{}),Vo=(t=>(t[t.UPDATE=0]="UPDATE",t[t.CREATE=1]="CREATE",t[t.DELETE=2]="DELETE",t[t.FINISH=3]="FINISH",t))(Vo||{}),Uo=(t=>(t[t.GEOMETRY=0]="GEOMETRY",t[t.WIRES=1]="WIRES",t[t.INVISIBLE=2]="INVISIBLE",t))(Uo||{}),Do=(t=>(t[t.CREATE_MODEL=0]="CREATE_MODEL",t[t.DELETE_MODEL=1]="DELETE_MODEL",t[t.EXECUTE=2]="EXECUTE",t[t.RAYCAST=3]="RAYCAST",t[t.FETCH_AABBS=4]="FETCH_AABBS",t[t.REFRESH_VIEW=5]="REFRESH_VIEW",t[t.RECOMPUTE_MESHES=6]="RECOMPUTE_MESHES",t[t.CREATE_MATERIAL=7]="CREATE_MATERIAL",t[t.THROW_ERROR=8]="THROW_ERROR",t))(Do||{}),No=(t=>(t[t.VISIBLE=0]="VISIBLE",t))(No||{});const Wo=new Int32Array(2),Zo=new Float32Array(Wo.buffer),qo=new Float64Array(Wo.buffer),Ho=1===new Uint16Array(new Uint8Array([1,0]).buffer)[0];var jo,Go;(Go=jo||(jo={}))[Go.UTF8_BYTES=1]="UTF8_BYTES",Go[Go.UTF16_STRING=2]="UTF16_STRING";class Yo{constructor(t){this.bytes_=t,this.position_=0,this.text_decoder_=new TextDecoder}static allocate(t){return new Yo(new Uint8Array(t))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(t){this.position_=t}capacity(){return this.bytes_.length}readInt8(t){return this.readUint8(t)<<24>>24}readUint8(t){return this.bytes_[t]}readInt16(t){return this.readUint16(t)<<16>>16}readUint16(t){return this.bytes_[t]|this.bytes_[t+1]<<8}readInt32(t){return this.bytes_[t]|this.bytes_[t+1]<<8|this.bytes_[t+2]<<16|this.bytes_[t+3]<<24}readUint32(t){return this.readInt32(t)>>>0}readInt64(t){return BigInt.asIntN(64,BigInt(this.readUint32(t))+(BigInt(this.readUint32(t+4))<<BigInt(32)))}readUint64(t){return BigInt.asUintN(64,BigInt(this.readUint32(t))+(BigInt(this.readUint32(t+4))<<BigInt(32)))}readFloat32(t){return Wo[0]=this.readInt32(t),Zo[0]}readFloat64(t){return Wo[Ho?0:1]=this.readInt32(t),Wo[Ho?1:0]=this.readInt32(t+4),qo[0]}writeInt8(t,e){this.bytes_[t]=e}writeUint8(t,e){this.bytes_[t]=e}writeInt16(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8}writeUint16(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8}writeInt32(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24}writeUint32(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24}writeInt64(t,e){this.writeInt32(t,Number(BigInt.asIntN(32,e))),this.writeInt32(t+4,Number(BigInt.asIntN(32,e>>BigInt(32))))}writeUint64(t,e){this.writeUint32(t,Number(BigInt.asUintN(32,e))),this.writeUint32(t+4,Number(BigInt.asUintN(32,e>>BigInt(32))))}writeFloat32(t,e){Zo[0]=e,this.writeInt32(t,Wo[0])}writeFloat64(t,e){qo[0]=e,this.writeInt32(t,Wo[Ho?0:1]),this.writeInt32(t+4,Wo[Ho?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+4+4)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let t="";for(let e=0;e<4;e++)t+=String.fromCharCode(this.readInt8(this.position_+4+e));return t}__offset(t,e){const s=t-this.readInt32(t);return e<this.readInt16(s)?this.readInt16(s+e):0}__union(t,e){return t.bb_pos=e+this.readInt32(e),t.bb=this,t}__string(t,e){t+=this.readInt32(t);const s=this.readInt32(t);t+=4;const i=this.bytes_.subarray(t,t+s);return e===jo.UTF8_BYTES?i:this.text_decoder_.decode(i)}__union_with_string(t,e){return"string"==typeof t?this.__string(e):this.__union(t,e)}__indirect(t){return t+this.readInt32(t)}__vector(t){return t+this.readInt32(t)+4}__vector_len(t){return this.readInt32(t+this.readInt32(t))}__has_identifier(t){if(4!=t.length)throw new Error("FlatBuffers: file identifier must be length 4");for(let e=0;e<4;e++)if(t.charCodeAt(e)!=this.readInt8(this.position()+4+e))return!1;return!0}createScalarList(t,e){const s=[];for(let i=0;i<e;++i){const e=t(i);null!==e&&s.push(e)}return s}createObjList(t,e){const s=[];for(let i=0;i<e;++i){const e=t(i);null!==e&&s.push(e.unpack())}return s}}const Xo=1.25,Jo=65535,Qo=Math.pow(2,-24),$o=Symbol("SKIP_GENERATION");function Ko(t){return function(t){return t.index?t.index.count:t.attributes.position.count}(t)/3}function ta(t,e){if(!t.index){const s=t.attributes.position.count,i=function(t,e=ArrayBuffer){return t>65535?new Uint32Array(new e(4*t)):new Uint16Array(new e(2*t))}(s,e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer);t.setIndex(new Ms(i,1));for(let t=0;t<s;t++)i[t]=t}}function ea(t){const e=Ko(t),s=t.drawRange,i=s.start/3,n=(s.start+s.count)/3,r=Math.max(0,i),o=Math.min(e,n)-r;return[{offset:Math.floor(r),count:Math.floor(o)}]}function sa(t){if(!t.groups||!t.groups.length)return ea(t);const e=[],s=new Set,i=t.drawRange,n=i.start/3,r=(i.start+i.count)/3;for(const e of t.groups){const t=e.start/3,i=(e.start+e.count)/3;s.add(Math.max(n,t)),s.add(Math.min(r,i))}const o=Array.from(s.values()).sort(((t,e)=>t-e));for(let t=0;t<o.length-1;t++){const s=o[t],i=o[t+1];e.push({offset:Math.floor(s),count:Math.floor(i-s)})}return e}function ia(t,e,s){return s.min.x=e[t],s.min.y=e[t+1],s.min.z=e[t+2],s.max.x=e[t+3],s.max.y=e[t+4],s.max.z=e[t+5],s}function na(t){let e=-1,s=-1/0;for(let i=0;i<3;i++){const n=t[i+3]-t[i];n>s&&(s=n,e=i)}return e}function ra(t,e){e.set(t)}function oa(t,e,s){let i,n;for(let r=0;r<3;r++){const o=r+3;i=t[r],n=e[r],s[r]=i<n?i:n,i=t[o],n=e[o],s[o]=i>n?i:n}}function aa(t,e,s){for(let i=0;i<3;i++){const n=e[t+2*i],r=e[t+2*i+1],o=n-r,a=n+r;o<s[i]&&(s[i]=o),a>s[i+3]&&(s[i+3]=a)}}function ha(t){const e=t[3]-t[0],s=t[4]-t[1],i=t[5]-t[2];return 2*(e*s+s*i+i*e)}function la(t,e,s,i,n=null){let r=1/0,o=1/0,a=1/0,h=-1/0,l=-1/0,c=-1/0,u=1/0,d=1/0,p=1/0,f=-1/0,m=-1/0,b=-1/0;const y=null!==n;for(let i=6*e,n=6*(e+s);i<n;i+=6){const e=t[i+0],s=t[i+1],n=e-s,g=e+s;n<r&&(r=n),g>h&&(h=g),y&&e<u&&(u=e),y&&e>f&&(f=e);const _=t[i+2],x=t[i+3],w=_-x,v=_+x;w<o&&(o=w),v>l&&(l=v),y&&_<d&&(d=_),y&&_>m&&(m=_);const M=t[i+4],A=t[i+5],S=M-A,z=M+A;S<a&&(a=S),z>c&&(c=z),y&&M<p&&(p=M),y&&M>b&&(b=M)}i[0]=r,i[1]=o,i[2]=a,i[3]=h,i[4]=l,i[5]=c,y&&(n[0]=u,n[1]=d,n[2]=p,n[3]=f,n[4]=m,n[5]=b)}const ca=32,ua=(t,e)=>t.candidate-e.candidate,da=new Array(ca).fill().map((()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0}))),pa=new Float32Array(6);class fa{constructor(){}}function ma(t,e,s,i,n,r){let o=i,a=i+n-1;const h=r.pos,l=2*r.axis;for(;;){for(;o<=a&&s[6*o+l]<h;)o++;for(;o<=a&&s[6*a+l]>=h;)a--;if(!(o<a))return o;for(let t=0;t<3;t++){let s=e[3*o+t];e[3*o+t]=e[3*a+t],e[3*a+t]=s}for(let t=0;t<6;t++){let e=s[6*o+t];s[6*o+t]=s[6*a+t],s[6*a+t]=e}o++,a--}}function ba(t,e,s,i,n,r){let o=i,a=i+n-1;const h=r.pos,l=2*r.axis;for(;;){for(;o<=a&&s[6*o+l]<h;)o++;for(;o<=a&&s[6*a+l]>=h;)a--;if(!(o<a))return o;{let e=t[o];t[o]=t[a],t[a]=e;for(let t=0;t<6;t++){let e=s[6*o+t];s[6*o+t]=s[6*a+t],s[6*a+t]=e}o++,a--}}}function ya(t,e){const s=t.geometry,i=s.index?s.index.array:null,n=e.maxDepth,r=e.verbose,o=e.maxLeafTris,a=e.strategy,h=e.onProgress,l=Ko(s),c=t._indirectBuffer;let u=!1;const d=new Float32Array(6),p=new Float32Array(6),f=function(t,e){var s;(s=e)[0]=s[1]=s[2]=1/0,s[3]=s[4]=s[5]=-1/0;const i=t.attributes.position,n=t.index?t.index.array:null,r=Ko(t),o=new Float32Array(6*r),a=i.normalized,h=i.array,l=i.offset||0;let c=3;i.isInterleavedBufferAttribute&&(c=i.data.stride);const u=["getX","getY","getZ"];for(let t=0;t<r;t++){const s=3*t,r=6*t;let d=s+0,p=s+1,f=s+2;n&&(d=n[d],p=n[p],f=n[f]),a||(d=d*c+l,p=p*c+l,f=f*c+l);for(let t=0;t<3;t++){let s,n,l;a?(s=i[u[t]](d),n=i[u[t]](p),l=i[u[t]](f)):(s=h[d+t],n=h[p+t],l=h[f+t]);let c=s;n<c&&(c=n),l<c&&(c=l);let m=s;n>m&&(m=n),l>m&&(m=l);const b=(m-c)/2,y=2*t;o[r+y+0]=c+b,o[r+y+1]=b+(Math.abs(c)+b)*Qo,c<e[t]&&(e[t]=c),m>e[t+3]&&(e[t+3]=m)}}return o}(s,d),m=e.indirect?ba:ma,b=[],y=e.indirect?ea(s):sa(s);if(1===y.length){const t=y[0],e=new fa;e.boundingData=d,function(t,e,s,i){let n=1/0,r=1/0,o=1/0,a=-1/0,h=-1/0,l=-1/0;for(let i=6*e,c=6*(e+s);i<c;i+=6){const e=t[i+0];e<n&&(n=e),e>a&&(a=e);const s=t[i+2];s<r&&(r=s),s>h&&(h=s);const c=t[i+4];c<o&&(o=c),c>l&&(l=c)}i[0]=n,i[1]=r,i[2]=o,i[3]=a,i[4]=h,i[5]=l}(f,t.offset,t.count,p),_(e,t.offset,t.count,p),b.push(e)}else for(let t of y){const e=new fa;e.boundingData=new Float32Array(6),la(f,t.offset,t.count,e.boundingData,p),_(e,t.offset,t.count,p),b.push(e)}return b;function g(t){h&&h(t/l)}function _(t,e,h,l=null,d=0){if(!u&&d>=n&&(u=!0,r&&(console.warn(`MeshBVH: Max depth of ${n} reached when generating BVH. Consider increasing maxDepth.`),console.warn(s))),h<=o||d>=n)return g(e+h),t.offset=e,t.count=h,t;const b=function(t,e,s,i,n,r){let o=-1,a=0;if(0===r)o=na(e),-1!==o&&(a=(e[o]+e[o+3])/2);else if(1===r)o=na(t),-1!==o&&(a=function(t,e,s,i){let n=0;for(let r=e,o=e+s;r<o;r++)n+=t[6*r+2*i];return n/s}(s,i,n,o));else if(2===r){const r=ha(t);let h=Xo*n;const l=6*i,c=6*(i+n);for(let t=0;t<3;t++){const i=e[t],u=(e[t+3]-i)/ca;if(n<8){const e=[...da];e.length=n;let i=0;for(let n=l;n<c;n+=6,i++){const r=e[i];r.candidate=s[n+2*t],r.count=0;const{bounds:o,leftCacheBounds:a,rightCacheBounds:h}=r;for(let t=0;t<3;t++)h[t]=1/0,h[t+3]=-1/0,a[t]=1/0,a[t+3]=-1/0,o[t]=1/0,o[t+3]=-1/0;aa(n,s,o)}e.sort(ua);let u=n;for(let t=0;t<u;t++){const s=e[t];for(;t+1<u&&e[t+1].candidate===s.candidate;)e.splice(t+1,1),u--}for(let i=l;i<c;i+=6){const n=s[i+2*t];for(let t=0;t<u;t++){const r=e[t];n>=r.candidate?aa(i,s,r.rightCacheBounds):(aa(i,s,r.leftCacheBounds),r.count++)}}for(let s=0;s<u;s++){const i=e[s],l=i.count,c=n-i.count,u=i.leftCacheBounds,d=i.rightCacheBounds;let p=0;0!==l&&(p=ha(u)/r);let f=0;0!==c&&(f=ha(d)/r);const m=1+Xo*(p*l+f*c);m<h&&(o=t,h=m,a=i.candidate)}}else{for(let t=0;t<ca;t++){const e=da[t];e.count=0,e.candidate=i+u+t*u;const s=e.bounds;for(let t=0;t<3;t++)s[t]=1/0,s[t+3]=-1/0}for(let e=l;e<c;e+=6){let n=~~((s[e+2*t]-i)/u);n>=ca&&(n=31);const r=da[n];r.count++,aa(e,s,r.bounds)}const e=da[31];ra(e.bounds,e.rightCacheBounds);for(let t=30;t>=0;t--){const e=da[t],s=da[t+1];oa(e.bounds,s.rightCacheBounds,e.rightCacheBounds)}let d=0;for(let e=0;e<31;e++){const s=da[e],i=s.count,l=s.bounds,c=da[e+1].rightCacheBounds;0!==i&&(0===d?ra(l,pa):oa(l,pa,pa)),d+=i;let u=0,p=0;0!==d&&(u=ha(pa)/r);const f=n-d;0!==f&&(p=ha(c)/r);const m=1+Xo*(u*d+p*f);m<h&&(o=t,h=m,a=s.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${r} used.`);return{axis:o,pos:a}}(t.boundingData,l,f,e,h,a);if(-1===b.axis)return g(e+h),t.offset=e,t.count=h,t;const y=m(c,i,f,e,h,b);if(y===e||y===e+h)g(e+h),t.offset=e,t.count=h;else{t.splitAxis=b.axis;const s=new fa,i=e,n=y-e;t.left=s,s.boundingData=new Float32Array(6),la(f,i,n,s.boundingData,p),_(s,i,n,p,d+1);const r=new fa,o=y,a=h-n;t.right=r,r.boundingData=new Float32Array(6),la(f,o,a,r.boundingData,p),_(r,o,a,p,d+1)}return t}}function ga(t,e){const s=t.geometry;e.indirect&&(t._indirectBuffer=function(t,e){const s=(t.index?t.index.count:t.attributes.position.count)/3,i=s>65536,n=i?4:2,r=e?new SharedArrayBuffer(s*n):new ArrayBuffer(s*n),o=i?new Uint32Array(r):new Uint16Array(r);for(let t=0,e=o.length;t<e;t++)o[t]=t;return o}(s,e.useSharedArrayBuffer),function(t){if(0===t.groups.length)return!1;const e=Ko(t),s=sa(t).sort(((t,e)=>t.offset-e.offset)),i=s[s.length-1];i.count=Math.min(e-i.offset,i.count);let n=0;return s.forEach((({count:t})=>n+=t)),e!==n}(s)&&!e.verbose&&console.warn('MeshBVH: Provided geometry contains groups that do not fully span the vertex contents while using the "indirect" option. BVH may incorrectly report intersections on unrendered portions of the geometry.')),t._indirectBuffer||ta(s,e);const i=ya(t,e);let n,r,o;const a=[],h=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let t=0;t<i.length;t++){const e=i[t];const s=new h(32*l(e));n=new Float32Array(s),r=new Uint32Array(s),o=new Uint16Array(s),c(0,e),a.push(s)}return void(t._roots=a);function l(t){return t.count?1:1+l(t.left)+l(t.right)}function c(t,e){const s=t/4,i=t/2,a=!!e.count,h=e.boundingData;for(let t=0;t<6;t++)n[s+t]=h[t];if(a){const n=e.offset,a=e.count;return r[s+6]=n,o[i+14]=a,o[i+15]=Jo,t+32}{const i=e.left,n=e.right,o=e.splitAxis;let a;if(a=c(t+32,i),a/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return r[s+6]=a/4,a=c(a,n),r[s+7]=o,a}}}class _a{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(t,e){let s=1/0,i=-1/0;for(let n=0,r=t.length;n<r;n++){const r=t[n][e];s=r<s?r:s,i=r>i?r:i}this.min=s,this.max=i}setFromPoints(t,e){let s=1/0,i=-1/0;for(let n=0,r=e.length;n<r;n++){const r=e[n],o=t.dot(r);s=o<s?o:s,i=o>i?o:i}this.min=s,this.max=i}isSeparated(t){return this.min>t.max||t.min>this.max}}_a.prototype.setFromBox=function(){const t=new Yt;return function(e,s){const i=s.min,n=s.max;let r=1/0,o=-1/0;for(let s=0;s<=1;s++)for(let a=0;a<=1;a++)for(let h=0;h<=1;h++){t.x=i.x*s+n.x*(1-s),t.y=i.y*a+n.y*(1-a),t.z=i.z*h+n.z*(1-h);const l=e.dot(t);r=Math.min(l,r),o=Math.max(l,o)}this.min=r,this.max=o}}();const xa=function(){const t=new Yt,e=new Yt,s=new Yt;return function(i,n,r){const o=i.start,a=t,h=n.start,l=e;s.subVectors(o,h),t.subVectors(i.end,i.start),e.subVectors(n.end,n.start);const c=s.dot(l),u=l.dot(a),d=l.dot(l),p=s.dot(a),f=a.dot(a)*d-u*u;let m,b;m=0!==f?(c*u-p*d)/f:0,b=(c+m*u)/d,r.x=m,r.y=b}}(),wa=function(){const t=new It,e=new Yt,s=new Yt;return function(i,n,r,o){xa(i,n,t);let a=t.x,h=t.y;if(a>=0&&a<=1&&h>=0&&h<=1)return i.at(a,r),void n.at(h,o);if(a>=0&&a<=1)return h<0?n.at(0,o):n.at(1,o),void i.closestPointToPoint(o,!0,r);if(h>=0&&h<=1)return a<0?i.at(0,r):i.at(1,r),void n.closestPointToPoint(r,!0,o);{let t,l;t=a<0?i.start:i.end,l=h<0?n.start:n.end;const c=e,u=s;return i.closestPointToPoint(l,!0,e),n.closestPointToPoint(t,!0,s),c.distanceToSquared(l)<=u.distanceToSquared(t)?(r.copy(c),void o.copy(l)):(r.copy(t),void o.copy(u))}}}(),va=function(){const t=new Yt,e=new Yt,s=new Qs,i=new bi;return function(n,r){const{radius:o,center:a}=n,{a:h,b:l,c:c}=r;i.start=h,i.end=l;if(i.closestPointToPoint(a,!0,t).distanceTo(a)<=o)return!0;i.start=h,i.end=c;if(i.closestPointToPoint(a,!0,t).distanceTo(a)<=o)return!0;i.start=l,i.end=c;if(i.closestPointToPoint(a,!0,t).distanceTo(a)<=o)return!0;const u=r.getPlane(s);if(Math.abs(u.distanceToPoint(a))<=o){const t=u.projectPoint(a,e);if(r.containsPoint(t))return!0}return!1}}();function Ma(t){return Math.abs(t)<1e-15}class Aa extends us{constructor(...t){super(...t),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map((()=>new Yt)),this.satBounds=new Array(4).fill().map((()=>new _a)),this.points=[this.a,this.b,this.c],this.sphere=new me,this.plane=new Qs,this.needsUpdate=!0}intersectsSphere(t){return va(t,this)}update(){const t=this.a,e=this.b,s=this.c,i=this.points,n=this.satAxes,r=this.satBounds,o=n[0],a=r[0];this.getNormal(o),a.setFromPoints(o,i);const h=n[1],l=r[1];h.subVectors(t,e),l.setFromPoints(h,i);const c=n[2],u=r[2];c.subVectors(e,s),u.setFromPoints(c,i);const d=n[3],p=r[3];d.subVectors(s,t),p.setFromPoints(d,i),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(o,t),this.needsUpdate=!1}}Aa.prototype.closestPointToSegment=function(){const t=new Yt,e=new Yt,s=new bi;return function(i,n=null,r=null){const{start:o,end:a}=i,h=this.points;let l,c=1/0;for(let o=0;o<3;o++){const a=(o+1)%3;s.start.copy(h[o]),s.end.copy(h[a]),wa(s,i,t,e),l=t.distanceToSquared(e),l<c&&(c=l,n&&n.copy(t),r&&r.copy(e))}return this.closestPointToPoint(o,t),l=o.distanceToSquared(t),l<c&&(c=l,n&&n.copy(t),r&&r.copy(o)),this.closestPointToPoint(a,t),l=a.distanceToSquared(t),l<c&&(c=l,n&&n.copy(t),r&&r.copy(a)),Math.sqrt(c)}}(),Aa.prototype.intersectsTriangle=function(){const t=new Aa,e=new Array(3),s=new Array(3),i=new _a,n=new _a,r=new Yt,o=new Yt,a=new Yt,h=new Yt,l=new Yt,c=new bi,u=new bi,d=new bi,p=new Yt;function f(t,e,s){const i=t.points;let n=0,r=-1;for(let t=0;t<3;t++){const{start:a,end:h}=c;a.copy(i[t]),h.copy(i[(t+1)%3]),c.delta(o);const l=Ma(e.distanceToPoint(a));if(Ma(e.normal.dot(o))&&l){s.copy(c),n=2;break}const u=e.intersectLine(c,p);if(!u&&l&&p.copy(a),(u||l)&&!Ma(p.distanceTo(h))){if(n<=1){(1===n?s.start:s.end).copy(p),l&&(r=n)}else if(n>=2){(1===r?s.start:s.end).copy(p),n=2;break}if(n++,2===n&&-1===r)break}}return n}return function(o,c=null,p=!1){this.needsUpdate&&this.update(),o.isExtendedTriangle?o.needsUpdate&&o.update():(t.copy(o),t.update(),o=t);const m=this.plane,b=o.plane;if(Math.abs(m.normal.dot(b.normal))>1-1e-10){const t=this.satBounds,a=this.satAxes;s[0]=o.a,s[1]=o.b,s[2]=o.c;for(let e=0;e<4;e++){const n=t[e],r=a[e];if(i.setFromPoints(r,s),n.isSeparated(i))return!1}const h=o.satBounds,l=o.satAxes;e[0]=this.a,e[1]=this.b,e[2]=this.c;for(let t=0;t<4;t++){const s=h[t],n=l[t];if(i.setFromPoints(n,e),s.isSeparated(i))return!1}for(let t=0;t<4;t++){const o=a[t];for(let t=0;t<4;t++){const a=l[t];if(r.crossVectors(o,a),i.setFromPoints(r,e),n.setFromPoints(r,s),i.isSeparated(n))return!1}}return c&&(p||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),c.start.set(0,0,0),c.end.set(0,0,0)),!0}{const t=f(this,b,u);if(1===t&&o.containsPoint(u.end))return c&&(c.start.copy(u.end),c.end.copy(u.end)),!0;if(2!==t)return!1;const e=f(o,m,d);if(1===e&&this.containsPoint(d.end))return c&&(c.start.copy(d.end),c.end.copy(d.end)),!0;if(2!==e)return!1;if(u.delta(a),d.delta(h),a.dot(h)<0){let t=d.start;d.start=d.end,d.end=t}const s=u.start.dot(a),i=u.end.dot(a),n=d.start.dot(a),r=d.end.dot(a);return(s===r||n===i||i<n!==s<r)&&(c&&(l.subVectors(u.start,d.start),l.dot(a)>0?c.start.copy(u.start):c.start.copy(d.start),l.subVectors(u.end,d.end),l.dot(a)<0?c.end.copy(u.end):c.end.copy(d.end)),!0)}}}(),Aa.prototype.distanceToPoint=function(){const t=new Yt;return function(e){return this.closestPointToPoint(e,t),e.distanceTo(t)}}(),Aa.prototype.distanceToTriangle=function(){const t=new Yt,e=new Yt,s=["a","b","c"],i=new bi,n=new bi;return function(r,o=null,a=null){const h=o||a?i:null;if(this.intersectsTriangle(r,h))return(o||a)&&(o&&h.getCenter(o),a&&h.getCenter(a)),0;let l=1/0;for(let e=0;e<3;e++){let i;const n=s[e],h=r[n];this.closestPointToPoint(h,t),i=h.distanceToSquared(t),i<l&&(l=i,o&&o.copy(t),a&&a.copy(h));const c=this[n];r.closestPointToPoint(c,t),i=c.distanceToSquared(t),i<l&&(l=i,o&&o.copy(c),a&&a.copy(t))}for(let h=0;h<3;h++){const c=s[h],u=s[(h+1)%3];i.set(this[c],this[u]);for(let h=0;h<3;h++){const c=s[h],u=s[(h+1)%3];n.set(r[c],r[u]),wa(i,n,t,e);const d=t.distanceToSquared(e);d<l&&(l=d,o&&o.copy(t),a&&a.copy(e))}}return Math.sqrt(l)}}();class Sa{constructor(t,e,s){this.isOrientedBox=!0,this.min=new Yt,this.max=new Yt,this.matrix=new Ae,this.invMatrix=new Ae,this.points=new Array(8).fill().map((()=>new Yt)),this.satAxes=new Array(3).fill().map((()=>new Yt)),this.satBounds=new Array(3).fill().map((()=>new _a)),this.alignedSatBounds=new Array(3).fill().map((()=>new _a)),this.needsUpdate=!1,t&&this.min.copy(t),e&&this.max.copy(e),s&&this.matrix.copy(s)}set(t,e,s){this.min.copy(t),this.max.copy(e),this.matrix.copy(s),this.needsUpdate=!0}copy(t){this.min.copy(t.min),this.max.copy(t.max),this.matrix.copy(t.matrix),this.needsUpdate=!0}}Sa.prototype.update=function(){return function(){const t=this.matrix,e=this.min,s=this.max,i=this.points;for(let n=0;n<=1;n++)for(let r=0;r<=1;r++)for(let o=0;o<=1;o++){const a=i[1*n|2*r|4*o];a.x=n?s.x:e.x,a.y=r?s.y:e.y,a.z=o?s.z:e.z,a.applyMatrix4(t)}const n=this.satBounds,r=this.satAxes,o=i[0];for(let t=0;t<3;t++){const e=r[t],s=n[t],a=i[1<<t];e.subVectors(o,a),s.setFromPoints(e,i)}const a=this.alignedSatBounds;a[0].setFromPointsField(i,"x"),a[1].setFromPointsField(i,"y"),a[2].setFromPointsField(i,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}}(),Sa.prototype.intersectsBox=function(){const t=new _a;return function(e){this.needsUpdate&&this.update();const s=e.min,i=e.max,n=this.satBounds,r=this.satAxes,o=this.alignedSatBounds;if(t.min=s.x,t.max=i.x,o[0].isSeparated(t))return!1;if(t.min=s.y,t.max=i.y,o[1].isSeparated(t))return!1;if(t.min=s.z,t.max=i.z,o[2].isSeparated(t))return!1;for(let s=0;s<3;s++){const i=r[s],o=n[s];if(t.setFromBox(i,e),o.isSeparated(t))return!1}return!0}}(),Sa.prototype.intersectsTriangle=function(){const t=new Aa,e=new Array(3),s=new _a,i=new _a,n=new Yt;return function(r){this.needsUpdate&&this.update(),r.isExtendedTriangle?r.needsUpdate&&r.update():(t.copy(r),t.update(),r=t);const o=this.satBounds,a=this.satAxes;e[0]=r.a,e[1]=r.b,e[2]=r.c;for(let t=0;t<3;t++){const i=o[t],n=a[t];if(s.setFromPoints(n,e),i.isSeparated(s))return!1}const h=r.satBounds,l=r.satAxes,c=this.points;for(let t=0;t<3;t++){const e=h[t],i=l[t];if(s.setFromPoints(i,c),e.isSeparated(s))return!1}for(let t=0;t<3;t++){const r=a[t];for(let t=0;t<4;t++){const o=l[t];if(n.crossVectors(r,o),s.setFromPoints(n,e),i.setFromPoints(n,c),s.isSeparated(i))return!1}}return!0}}(),Sa.prototype.closestPointToPoint=function(){return function(t,e){return this.needsUpdate&&this.update(),e.copy(t).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),e}}(),Sa.prototype.distanceToPoint=function(){const t=new Yt;return function(e){return this.closestPointToPoint(e,t),e.distanceTo(t)}}(),Sa.prototype.distanceToBox=function(){const t=["x","y","z"],e=new Array(12).fill().map((()=>new bi)),s=new Array(12).fill().map((()=>new bi)),i=new Yt,n=new Yt;return function(r,o=0,a=null,h=null){if(this.needsUpdate&&this.update(),this.intersectsBox(r))return(a||h)&&(r.getCenter(n),this.closestPointToPoint(n,i),r.closestPointToPoint(i,n),a&&a.copy(i),h&&h.copy(n)),0;const l=o*o,c=r.min,u=r.max,d=this.points;let p=1/0;for(let t=0;t<8;t++){const e=d[t];n.copy(e).clamp(c,u);const s=e.distanceToSquared(n);if(s<p&&(p=s,a&&a.copy(e),h&&h.copy(n),s<l))return Math.sqrt(s)}let f=0;for(let i=0;i<3;i++)for(let n=0;n<=1;n++)for(let r=0;r<=1;r++){const o=(i+1)%3,a=(i+2)%3,h=1<<i|n<<o|r<<a,l=d[n<<o|r<<a],p=d[h];e[f].set(l,p);const m=t[i],b=t[o],y=t[a],g=s[f],_=g.start,x=g.end;_[m]=c[m],_[b]=n?c[b]:u[b],_[y]=r?c[y]:u[b],x[m]=u[m],x[b]=n?c[b]:u[b],x[y]=r?c[y]:u[b],f++}for(let t=0;t<=1;t++)for(let e=0;e<=1;e++)for(let s=0;s<=1;s++){n.x=t?u.x:c.x,n.y=e?u.y:c.y,n.z=s?u.z:c.z,this.closestPointToPoint(n,i);const r=n.distanceToSquared(i);if(r<p&&(p=r,a&&a.copy(i),h&&h.copy(n),r<l))return Math.sqrt(r)}for(let t=0;t<12;t++){const r=e[t];for(let t=0;t<12;t++){const e=s[t];wa(r,e,i,n);const o=i.distanceToSquared(n);if(o<p&&(p=o,a&&a.copy(i),h&&h.copy(n),o<l))return Math.sqrt(o)}}return Math.sqrt(p)}}();class za{constructor(t){this._getNewPrimitive=t,this._primitives=[]}getPrimitive(){const t=this._primitives;return 0===t.length?this._getNewPrimitive():t.pop()}releasePrimitive(t){this._primitives.push(t)}}class Ia extends za{constructor(){super((()=>new Aa))}}const Ta=new Ia;function Ba(t,e){return 65535===e[t+15]}function Ca(t,e){return e[t+6]}function Ea(t,e){return e[t+14]}function ka(t){return t+8}function Pa(t,e){return e[t+6]}function Fa(t,e){return e[t+7]}const Ra=new class{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;const t=[];let e=null;this.setBuffer=s=>{e&&t.push(e),e=s,this.float32Array=new Float32Array(s),this.uint16Array=new Uint16Array(s),this.uint32Array=new Uint32Array(s)},this.clearBuffer=()=>{e=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,0!==t.length&&this.setBuffer(t.pop())}}};let La,Oa;const Va=[],Ua=new za((()=>new Qt));function Da(t,e,s,i,n,r){La=Ua.getPrimitive(),Oa=Ua.getPrimitive(),Va.push(La,Oa),Ra.setBuffer(t._roots[e]);const o=Na(0,t.geometry,s,i,n,r);Ra.clearBuffer(),Ua.releasePrimitive(La),Ua.releasePrimitive(Oa),Va.pop(),Va.pop();const a=Va.length;return a>0&&(Oa=Va[a-1],La=Va[a-2]),o}function Na(t,e,s,i,n=null,r=0,o=0){const{float32Array:a,uint16Array:h,uint32Array:l}=Ra;let c=2*t;if(Ba(c,h)){const e=Ca(t,l),s=Ea(c,h);return ia(t,a,La),i(e,s,!1,o,r+t,La)}{let c=function(t){const{uint16Array:e,uint32Array:s}=Ra;let i=2*t;for(;!Ba(i,e);)i=2*(t=ka(t));return Ca(t,s)},u=function(t){const{uint16Array:e,uint32Array:s}=Ra;let i=2*t;for(;!Ba(i,e);)i=2*(t=Pa(t,s));return Ca(t,s)+Ea(i,e)};const d=ka(t),p=Pa(t,l);let f,m,b,y,g=d,_=p;if(n&&(b=La,y=Oa,ia(g,a,b),ia(_,a,y),f=n(b),m=n(y),m<f)){g=p,_=d;const t=f;f=m,m=t,b=y}b||(b=La,ia(g,a,b));const x=s(b,Ba(2*g,h),f,o+1,r+g);let w;if(2===x){const t=c(g);w=i(t,u(g)-t,!0,o+1,r+g,b)}else w=x&&Na(g,e,s,i,n,r,o+1);if(w)return!0;y=Oa,ia(_,a,y);const v=s(y,Ba(2*_,h),m,o+1,r+_);let M;if(2===v){const t=c(_);M=i(t,u(_)-t,!0,o+1,r+_,y)}else M=v&&Na(_,e,s,i,n,r,o+1);return!!M}}const Wa=new Yt,Za=new Yt;const qa=new Yt,Ha=new Yt,ja=new Yt,Ga=new It,Ya=new It,Xa=new It,Ja=new Yt,Qa=new Yt,$a=new Yt,Ka=new Yt;function th(t,e,s,i,n){const r=3*i;let o=r+0,a=r+1,h=r+2;const l=t.index;t.index&&(o=l.getX(o),a=l.getX(a),h=l.getX(h));const{position:c,normal:u,uv:d,uv1:p}=t.attributes,f=function(t,e,s,i,n,r,o,a,h){qa.fromBufferAttribute(e,r),Ha.fromBufferAttribute(e,o),ja.fromBufferAttribute(e,a);const l=function(t,e,s,i,n,r){let o;return o=1===r?t.intersectTriangle(i,s,e,!0,n):t.intersectTriangle(e,s,i,2!==r,n),null===o?null:{distance:t.origin.distanceTo(n),point:n.clone()}}(t,qa,Ha,ja,Ka,h);if(l){i&&(Ga.fromBufferAttribute(i,r),Ya.fromBufferAttribute(i,o),Xa.fromBufferAttribute(i,a),l.uv=us.getInterpolation(Ka,qa,Ha,ja,Ga,Ya,Xa,new It)),n&&(Ga.fromBufferAttribute(n,r),Ya.fromBufferAttribute(n,o),Xa.fromBufferAttribute(n,a),l.uv1=us.getInterpolation(Ka,qa,Ha,ja,Ga,Ya,Xa,new It)),s&&(Ja.fromBufferAttribute(s,r),Qa.fromBufferAttribute(s,o),$a.fromBufferAttribute(s,a),l.normal=us.getInterpolation(Ka,qa,Ha,ja,Ja,Qa,$a,new Yt),l.normal.dot(t.direction)>0&&l.normal.multiplyScalar(-1));const e={a:r,b:o,c:a,normal:new Yt,materialIndex:0};us.getNormal(qa,Ha,ja,e.normal),l.face=e,l.faceIndex=r}return l}(s,c,u,d,p,o,a,h,e);return f?(f.faceIndex=i,n&&n.push(f),f):null}function eh(t,e,s,i){const n=t.a,r=t.b,o=t.c;let a=e,h=e+1,l=e+2;s&&(a=s.getX(a),h=s.getX(h),l=s.getX(l)),n.x=i.getX(a),n.y=i.getY(a),n.z=i.getZ(a),r.x=i.getX(h),r.y=i.getY(h),r.z=i.getZ(h),o.x=i.getX(l),o.y=i.getY(l),o.z=i.getZ(l)}function sh(t,e,s,i,n,r,o){const{geometry:a}=s,{index:h}=a,l=a.attributes.position;for(let s=t,a=e+t;s<a;s++){let t;if(t=s,eh(o,3*t,h,l),o.needsUpdate=!0,i(o,t,n,r))return!0}return!1}function ih(t,e=null){e&&Array.isArray(e)&&(e=new Set(e));const s=t.geometry,i=s.index?s.index.array:null,n=s.attributes.position;let r,o,a,h,l=0;const c=t._roots;for(let t=0,e=c.length;t<e;t++)r=c[t],o=new Uint32Array(r),a=new Uint16Array(r),h=new Float32Array(r),u(0,l),l+=r.byteLength;function u(t,s,r=!1){const l=2*t;if(a[l+15]===Jo){const e=o[t+6];let s=1/0,r=1/0,c=1/0,u=-1/0,d=-1/0,p=-1/0;for(let t=3*e,o=3*(e+a[l+14]);t<o;t++){let e=i[t];const o=n.getX(e),a=n.getY(e),h=n.getZ(e);o<s&&(s=o),o>u&&(u=o),a<r&&(r=a),a>d&&(d=a),h<c&&(c=h),h>p&&(p=h)}return(h[t+0]!==s||h[t+1]!==r||h[t+2]!==c||h[t+3]!==u||h[t+4]!==d||h[t+5]!==p)&&(h[t+0]=s,h[t+1]=r,h[t+2]=c,h[t+3]=u,h[t+4]=d,h[t+5]=p,!0)}{const i=t+8,n=o[t+6],a=i+s,l=n+s;let c=r,d=!1,p=!1;e?c||(d=e.has(a),p=e.has(l),c=!d&&!p):(d=!0,p=!0);const f=c||p;let m=!1;(c||d)&&(m=u(i,s,c));let b=!1;f&&(b=u(n,s,c));const y=m||b;if(y)for(let e=0;e<3;e++){const s=i+e,r=n+e,o=h[s],a=h[s+3],l=h[r],c=h[r+3];h[t+e]=o<l?o:l,h[t+e+3]=a>c?a:c}return y}}}const nh=new Qt;function rh(t,e,s,i){return ia(t,e,nh),s.intersectBox(nh,i)}function oh(t,e,s,i,n,r,o){const{geometry:a}=s,{index:h}=a,l=a.attributes.position;for(let a=t,c=e+t;a<c;a++){let t;if(t=s.resolveTriangleIndex(a),eh(o,3*t,h,l),o.needsUpdate=!0,i(o,t,n,r))return!0}return!1}const ah=new Yt;function hh(t,e,s,i,n){Ra.setBuffer(t._roots[e]),lh(0,t,s,i,n),Ra.clearBuffer()}function lh(t,e,s,i,n){const{float32Array:r,uint16Array:o,uint32Array:a}=Ra,h=2*t;if(Ba(h,o)){!function(t,e,s,i,n,r){const{geometry:o,_indirectBuffer:a}=t;for(let t=i,a=i+n;t<a;t++)th(o,e,s,t,r)}(e,s,i,Ca(t,a),Ea(h,o),n)}else{const o=ka(t);rh(o,r,i,ah)&&lh(o,e,s,i,n);const h=Pa(t,a);rh(h,r,i,ah)&&lh(h,e,s,i,n)}}const ch=new Yt,uh=["x","y","z"];function dh(t,e,s,i){Ra.setBuffer(t._roots[e]);const n=ph(0,t,s,i);return Ra.clearBuffer(),n}function ph(t,e,s,i){const{float32Array:n,uint16Array:r,uint32Array:o}=Ra;let a=2*t;if(Ba(a,r)){return function(t,e,s,i,n){const{geometry:r,_indirectBuffer:o}=t;let a=1/0,h=null;for(let t=i,o=i+n;t<o;t++){let i;i=th(r,e,s,t),i&&i.distance<a&&(h=i,a=i.distance)}return h}(e,s,i,Ca(t,o),Ea(a,r))}{const r=Fa(t,o),a=uh[r],h=i.direction[a]>=0;let l,c;h?(l=ka(t),c=Pa(t,o)):(l=Pa(t,o),c=ka(t));const u=rh(l,n,i,ch)?ph(l,e,s,i):null;if(u){const t=u.point[a];if(h?t<=n[c+r]:t>=n[c+r+3])return u}const d=rh(c,n,i,ch)?ph(c,e,s,i):null;return u&&d?u.distance<=d.distance?u:d:u||d||null}}const fh=new Qt,mh=new Aa,bh=new Aa,yh=new Ae,gh=new Sa,_h=new Sa;function xh(t,e,s,i){Ra.setBuffer(t._roots[e]);const n=wh(0,t,s,i);return Ra.clearBuffer(),n}function wh(t,e,s,i,n=null){const{float32Array:r,uint16Array:o,uint32Array:a}=Ra;let h=2*t;null===n&&(s.boundingBox||s.computeBoundingBox(),gh.set(s.boundingBox.min,s.boundingBox.max,i),n=gh);if(!Ba(h,o)){const o=t+8,h=a[t+6];ia(o,r,fh);if(n.intersectsBox(fh)&&wh(o,e,s,i,n))return!0;ia(h,r,fh);return!!(n.intersectsBox(fh)&&wh(h,e,s,i,n))}{const n=e.geometry,l=n.index,c=n.attributes.position,u=s.index,d=s.attributes.position,p=Ca(t,a),f=Ea(h,o);if(yh.copy(i).invert(),s.boundsTree){ia(t,r,_h),_h.matrix.copy(yh),_h.needsUpdate=!0;return s.boundsTree.shapecast({intersectsBounds:t=>_h.intersectsBox(t),intersectsTriangle:t=>{t.a.applyMatrix4(i),t.b.applyMatrix4(i),t.c.applyMatrix4(i),t.needsUpdate=!0;for(let e=3*p,s=3*(f+p);e<s;e+=3)if(eh(bh,e,l,c),bh.needsUpdate=!0,t.intersectsTriangle(bh))return!0;return!1}})}for(let t=3*p,e=3*(f+p);t<e;t+=3){eh(mh,t,l,c),mh.a.applyMatrix4(yh),mh.b.applyMatrix4(yh),mh.c.applyMatrix4(yh),mh.needsUpdate=!0;for(let t=0,e=u.count;t<e;t+=3)if(eh(bh,t,u,d),bh.needsUpdate=!0,mh.intersectsTriangle(bh))return!0}}}const vh=new Ae,Mh=new Sa,Ah=new Sa,Sh=new Yt,zh=new Yt,Ih=new Yt,Th=new Yt;function Bh(t,e,s,i={},n={},r=0,o=1/0){e.boundingBox||e.computeBoundingBox(),Mh.set(e.boundingBox.min,e.boundingBox.max,s),Mh.needsUpdate=!0;const a=t.geometry,h=a.attributes.position,l=a.index,c=e.attributes.position,u=e.index,d=Ta.getPrimitive(),p=Ta.getPrimitive();let f=Sh,m=zh,b=null,y=null;n&&(b=Ih,y=Th);let g=1/0,_=null,x=null;return vh.copy(s).invert(),Ah.matrix.copy(vh),t.shapecast({boundsTraverseOrder:t=>Mh.distanceToBox(t),intersectsBounds:(t,e,s)=>s<g&&s<o&&(e&&(Ah.min.copy(t.min),Ah.max.copy(t.max),Ah.needsUpdate=!0),!0),intersectsRange:(t,i)=>{if(e.boundsTree){return e.boundsTree.shapecast({boundsTraverseOrder:t=>Ah.distanceToBox(t),intersectsBounds:(t,e,s)=>s<g&&s<o,intersectsRange:(e,n)=>{for(let o=e,a=e+n;o<a;o++){eh(p,3*o,u,c),p.a.applyMatrix4(s),p.b.applyMatrix4(s),p.c.applyMatrix4(s),p.needsUpdate=!0;for(let e=t,s=t+i;e<s;e++){eh(d,3*e,l,h),d.needsUpdate=!0;const t=d.distanceToTriangle(p,f,b);if(t<g&&(m.copy(f),y&&y.copy(b),g=t,_=e,x=o),t<r)return!0}}}})}for(let n=0,o=Ko(e);n<o;n++){eh(p,3*n,u,c),p.a.applyMatrix4(s),p.b.applyMatrix4(s),p.c.applyMatrix4(s),p.needsUpdate=!0;for(let e=t,s=t+i;e<s;e++){eh(d,3*e,l,h),d.needsUpdate=!0;const t=d.distanceToTriangle(p,f,b);if(t<g&&(m.copy(f),y&&y.copy(b),g=t,_=e,x=n),t<r)return!0}}}}),Ta.releasePrimitive(d),Ta.releasePrimitive(p),g===1/0?null:(i.point?i.point.copy(m):i.point=m.clone(),i.distance=g,i.faceIndex=_,n&&(n.point?n.point.copy(y):n.point=y.clone(),n.point.applyMatrix4(vh),m.applyMatrix4(vh),n.distance=m.sub(n.point).length(),n.faceIndex=x),i)}function Ch(t,e=null){e&&Array.isArray(e)&&(e=new Set(e));const s=t.geometry,i=s.index?s.index.array:null,n=s.attributes.position;let r,o,a,h,l=0;const c=t._roots;for(let t=0,e=c.length;t<e;t++)r=c[t],o=new Uint32Array(r),a=new Uint16Array(r),h=new Float32Array(r),u(0,l),l+=r.byteLength;function u(s,r,l=!1){const c=2*s;if(a[c+15]===Jo){const e=o[s+6];let r=1/0,l=1/0,u=1/0,d=-1/0,p=-1/0,f=-1/0;for(let s=e,o=e+a[c+14];s<o;s++){const e=3*t.resolveTriangleIndex(s);for(let t=0;t<3;t++){let s=e+t;s=i?i[s]:s;const o=n.getX(s),a=n.getY(s),h=n.getZ(s);o<r&&(r=o),o>d&&(d=o),a<l&&(l=a),a>p&&(p=a),h<u&&(u=h),h>f&&(f=h)}}return(h[s+0]!==r||h[s+1]!==l||h[s+2]!==u||h[s+3]!==d||h[s+4]!==p||h[s+5]!==f)&&(h[s+0]=r,h[s+1]=l,h[s+2]=u,h[s+3]=d,h[s+4]=p,h[s+5]=f,!0)}{const t=s+8,i=o[s+6],n=t+r,a=i+r;let c=l,d=!1,p=!1;e?c||(d=e.has(n),p=e.has(a),c=!d&&!p):(d=!0,p=!0);const f=c||p;let m=!1;(c||d)&&(m=u(t,r,c));let b=!1;f&&(b=u(i,r,c));const y=m||b;if(y)for(let e=0;e<3;e++){const n=t+e,r=i+e,o=h[n],a=h[n+3],l=h[r],c=h[r+3];h[s+e]=o<l?o:l,h[s+e+3]=a>c?a:c}return y}}}const Eh=new Yt;function kh(t,e,s,i,n){Ra.setBuffer(t._roots[e]),Ph(0,t,s,i,n),Ra.clearBuffer()}function Ph(t,e,s,i,n){const{float32Array:r,uint16Array:o,uint32Array:a}=Ra,h=2*t;if(Ba(h,o)){!function(t,e,s,i,n,r){const{geometry:o,_indirectBuffer:a}=t;for(let t=i,h=i+n;t<h;t++)th(o,e,s,a?a[t]:t,r)}(e,s,i,Ca(t,a),Ea(h,o),n)}else{const o=ka(t);rh(o,r,i,Eh)&&Ph(o,e,s,i,n);const h=Pa(t,a);rh(h,r,i,Eh)&&Ph(h,e,s,i,n)}}const Fh=new Yt,Rh=["x","y","z"];function Lh(t,e,s,i){Ra.setBuffer(t._roots[e]);const n=Oh(0,t,s,i);return Ra.clearBuffer(),n}function Oh(t,e,s,i){const{float32Array:n,uint16Array:r,uint32Array:o}=Ra;let a=2*t;if(Ba(a,r)){return function(t,e,s,i,n){const{geometry:r,_indirectBuffer:o}=t;let a=1/0,h=null;for(let t=i,l=i+n;t<l;t++){let i;i=th(r,e,s,o?o[t]:t),i&&i.distance<a&&(h=i,a=i.distance)}return h}(e,s,i,Ca(t,o),Ea(a,r))}{const r=Fa(t,o),a=Rh[r],h=i.direction[a]>=0;let l,c;h?(l=ka(t),c=Pa(t,o)):(l=Pa(t,o),c=ka(t));const u=rh(l,n,i,Fh)?Oh(l,e,s,i):null;if(u){const t=u.point[a];if(h?t<=n[c+r]:t>=n[c+r+3])return u}const d=rh(c,n,i,Fh)?Oh(c,e,s,i):null;return u&&d?u.distance<=d.distance?u:d:u||d||null}}const Vh=new Qt,Uh=new Aa,Dh=new Aa,Nh=new Ae,Wh=new Sa,Zh=new Sa;function qh(t,e,s,i){Ra.setBuffer(t._roots[e]);const n=Hh(0,t,s,i);return Ra.clearBuffer(),n}function Hh(t,e,s,i,n=null){const{float32Array:r,uint16Array:o,uint32Array:a}=Ra;let h=2*t;null===n&&(s.boundingBox||s.computeBoundingBox(),Wh.set(s.boundingBox.min,s.boundingBox.max,i),n=Wh);if(!Ba(h,o)){const o=t+8,h=a[t+6];ia(o,r,Vh);if(n.intersectsBox(Vh)&&Hh(o,e,s,i,n))return!0;ia(h,r,Vh);return!!(n.intersectsBox(Vh)&&Hh(h,e,s,i,n))}{const n=e.geometry,l=n.index,c=n.attributes.position,u=s.index,d=s.attributes.position,p=Ca(t,a),f=Ea(h,o);if(Nh.copy(i).invert(),s.boundsTree){ia(t,r,Zh),Zh.matrix.copy(Nh),Zh.needsUpdate=!0;return s.boundsTree.shapecast({intersectsBounds:t=>Zh.intersectsBox(t),intersectsTriangle:t=>{t.a.applyMatrix4(i),t.b.applyMatrix4(i),t.c.applyMatrix4(i),t.needsUpdate=!0;for(let s=p,i=f+p;s<i;s++)if(eh(Dh,3*e.resolveTriangleIndex(s),l,c),Dh.needsUpdate=!0,t.intersectsTriangle(Dh))return!0;return!1}})}for(let t=p,s=f+p;t<s;t++){const s=e.resolveTriangleIndex(t);eh(Uh,3*s,l,c),Uh.a.applyMatrix4(Nh),Uh.b.applyMatrix4(Nh),Uh.c.applyMatrix4(Nh),Uh.needsUpdate=!0;for(let t=0,e=u.count;t<e;t+=3)if(eh(Dh,t,u,d),Dh.needsUpdate=!0,Uh.intersectsTriangle(Dh))return!0}}}const jh=new Ae,Gh=new Sa,Yh=new Sa,Xh=new Yt,Jh=new Yt,Qh=new Yt,$h=new Yt;function Kh(t,e,s,i={},n={},r=0,o=1/0){e.boundingBox||e.computeBoundingBox(),Gh.set(e.boundingBox.min,e.boundingBox.max,s),Gh.needsUpdate=!0;const a=t.geometry,h=a.attributes.position,l=a.index,c=e.attributes.position,u=e.index,d=Ta.getPrimitive(),p=Ta.getPrimitive();let f=Xh,m=Jh,b=null,y=null;n&&(b=Qh,y=$h);let g=1/0,_=null,x=null;return jh.copy(s).invert(),Yh.matrix.copy(jh),t.shapecast({boundsTraverseOrder:t=>Gh.distanceToBox(t),intersectsBounds:(t,e,s)=>s<g&&s<o&&(e&&(Yh.min.copy(t.min),Yh.max.copy(t.max),Yh.needsUpdate=!0),!0),intersectsRange:(i,n)=>{if(e.boundsTree){const a=e.boundsTree;return a.shapecast({boundsTraverseOrder:t=>Yh.distanceToBox(t),intersectsBounds:(t,e,s)=>s<g&&s<o,intersectsRange:(e,o)=>{for(let w=e,v=e+o;w<v;w++){const e=a.resolveTriangleIndex(w);eh(p,3*e,u,c),p.a.applyMatrix4(s),p.b.applyMatrix4(s),p.c.applyMatrix4(s),p.needsUpdate=!0;for(let e=i,s=i+n;e<s;e++){const s=t.resolveTriangleIndex(e);eh(d,3*s,l,h),d.needsUpdate=!0;const i=d.distanceToTriangle(p,f,b);if(i<g&&(m.copy(f),y&&y.copy(b),g=i,_=e,x=w),i<r)return!0}}}})}for(let o=0,a=Ko(e);o<a;o++){eh(p,3*o,u,c),p.a.applyMatrix4(s),p.b.applyMatrix4(s),p.c.applyMatrix4(s),p.needsUpdate=!0;for(let e=i,s=i+n;e<s;e++){const s=t.resolveTriangleIndex(e);eh(d,3*s,l,h),d.needsUpdate=!0;const i=d.distanceToTriangle(p,f,b);if(i<g&&(m.copy(f),y&&y.copy(b),g=i,_=e,x=o),i<r)return!0}}}}),Ta.releasePrimitive(d),Ta.releasePrimitive(p),g===1/0?null:(i.point?i.point.copy(m):i.point=m.clone(),i.distance=g,i.faceIndex=_,n&&(n.point?n.point.copy(y):n.point=y.clone(),n.point.applyMatrix4(jh),m.applyMatrix4(jh),n.distance=m.sub(n.point).length(),n.faceIndex=x),i)}const tl=new Ra.constructor,el=new Ra.constructor,sl=new za((()=>new Qt)),il=new Qt,nl=new Qt,rl=new Qt,ol=new Qt;let al=!1;function hl(t,e,s,i,n,r=0,o=0,a=0,h=0,l=null,c=!1){let u,d;c?(u=el,d=tl):(u=tl,d=el);const p=u.float32Array,f=u.uint32Array,m=u.uint16Array,b=d.float32Array,y=d.uint32Array,g=d.uint16Array,_=2*e,x=Ba(2*t,m),w=Ba(_,g);let v=!1;if(w&&x)v=c?n(Ca(e,y),Ea(2*e,g),Ca(t,f),Ea(2*t,m),h,o+e,a,r+t):n(Ca(t,f),Ea(2*t,m),Ca(e,y),Ea(2*e,g),a,r+t,h,o+e);else if(w){const l=sl.getPrimitive();ia(e,b,l),l.applyMatrix4(s);const u=ka(t),d=Pa(t,f);ia(u,p,il),ia(d,p,nl);const m=l.intersectsBox(il),y=l.intersectsBox(nl);v=m&&hl(e,u,i,s,n,o,r,h,a+1,l,!c)||y&&hl(e,d,i,s,n,o,r,h,a+1,l,!c),sl.releasePrimitive(l)}else{const u=ka(e),d=Pa(e,y);ia(u,b,rl),ia(d,b,ol);const m=l.intersectsBox(rl),g=l.intersectsBox(ol);if(m&&g)v=hl(t,u,s,i,n,r,o,a,h+1,l,c)||hl(t,d,s,i,n,r,o,a,h+1,l,c);else if(m)if(x)v=hl(t,u,s,i,n,r,o,a,h+1,l,c);else{const e=sl.getPrimitive();e.copy(rl).applyMatrix4(s);const l=ka(t),d=Pa(t,f);ia(l,p,il),ia(d,p,nl);const m=e.intersectsBox(il),b=e.intersectsBox(nl);v=m&&hl(u,l,i,s,n,o,r,h,a+1,e,!c)||b&&hl(u,d,i,s,n,o,r,h,a+1,e,!c),sl.releasePrimitive(e)}else if(g)if(x)v=hl(t,d,s,i,n,r,o,a,h+1,l,c);else{const e=sl.getPrimitive();e.copy(ol).applyMatrix4(s);const l=ka(t),u=Pa(t,f);ia(l,p,il),ia(u,p,nl);const m=e.intersectsBox(il),b=e.intersectsBox(nl);v=m&&hl(d,l,i,s,n,o,r,h,a+1,e,!c)||b&&hl(d,u,i,s,n,o,r,h,a+1,e,!c),sl.releasePrimitive(e)}}return v}const ll=new Sa,cl=new Qt;class ul{static serialize(t,e={}){e={cloneBuffers:!0,...e};const s=t.geometry,i=t._roots,n=t._indirectBuffer,r=s.getIndex();let o;return o=e.cloneBuffers?{roots:i.map((t=>t.slice())),index:r.array.slice(),indirectBuffer:n?n.slice():null}:{roots:i,index:r.array,indirectBuffer:n},o}static deserialize(t,e,s={}){s={setIndex:!0,indirect:Boolean(t.indirectBuffer),...s};const{index:i,roots:n,indirectBuffer:r}=t,o=new ul(e,{...s,[$o]:!0});if(o._roots=n,o._indirectBuffer=r||null,s.setIndex){const s=e.getIndex();if(null===s){const s=new Ms(t.index,1,!1);e.setIndex(s)}else s.array!==i&&(s.array.set(i),s.needsUpdate=!0)}return o}get indirect(){return!!this._indirectBuffer}constructor(t,e={}){if(!t.isBufferGeometry)throw new Error("MeshBVH: Only BufferGeometries are supported.");if(t.index&&t.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.");if((e=Object.assign({strategy:0,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,[$o]:!1},e)).useSharedArrayBuffer&&"undefined"==typeof SharedArrayBuffer)throw new Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=t,this._roots=null,this._indirectBuffer=null,e[$o]||(ga(this,e),!t.boundingBox&&e.setBoundingBox&&(t.boundingBox=this.getBoundingBox(new Qt)));const{_indirectBuffer:s}=this;this.resolveTriangleIndex=e.indirect?t=>s[t]:t=>t}refit(t=null){return(this.indirect?Ch:ih)(this,t)}traverse(t,e=0){const s=this._roots[e],i=new Uint32Array(s),n=new Uint16Array(s);!function e(r,o=0){const a=2*r,h=n[a+15]===Jo;if(h){const e=i[r+6],l=n[a+14];t(o,h,new Float32Array(s,4*r,6),e,l)}else{const n=r+8,a=i[r+6],l=i[r+7];t(o,h,new Float32Array(s,4*r,6),l)||(e(n,o+1),e(a,o+1))}}(0)}raycast(t,e=0){const s=this._roots,i=this.geometry,n=[],r=e.isMaterial,o=Array.isArray(e),a=i.groups,h=r?e.side:e,l=this.indirect?kh:hh;for(let i=0,r=s.length;i<r;i++){const s=o?e[a[i].materialIndex].side:h,r=n.length;if(l(this,i,s,t,n),o){const t=a[i].materialIndex;for(let e=r,s=n.length;e<s;e++)n[e].face.materialIndex=t}}return n}raycastFirst(t,e=0){const s=this._roots,i=this.geometry,n=e.isMaterial,r=Array.isArray(e);let o=null;const a=i.groups,h=n?e.side:e,l=this.indirect?Lh:dh;for(let i=0,n=s.length;i<n;i++){const s=l(this,i,r?e[a[i].materialIndex].side:h,t);null!=s&&(null==o||s.distance<o.distance)&&(o=s,r&&(s.face.materialIndex=a[i].materialIndex))}return o}intersectsGeometry(t,e){let s=!1;const i=this._roots,n=this.indirect?qh:xh;for(let r=0,o=i.length;r<o&&(s=n(this,r,t,e),!s);r++);return s}shapecast(t){const e=Ta.getPrimitive(),s=this.indirect?oh:sh;let{boundsTraverseOrder:i,intersectsBounds:n,intersectsRange:r,intersectsTriangle:o}=t;if(r&&o){const t=r;r=(i,n,r,a,h)=>!!t(i,n,r,a,h)||s(i,n,this,o,r,a,e)}else r||(r=o?(t,i,n,r)=>s(t,i,this,o,n,r,e):(t,e,s)=>s);let a=!1,h=0;const l=this._roots;for(let t=0,e=l.length;t<e;t++){const e=l[t];if(a=Da(this,t,n,r,i,h),a)break;h+=e.byteLength}return Ta.releasePrimitive(e),a}bvhcast(t,e,s){let{intersectsRanges:i,intersectsTriangles:n}=s;const r=Ta.getPrimitive(),o=this.geometry.index,a=this.geometry.attributes.position,h=this.indirect?t=>{const e=this.resolveTriangleIndex(t);eh(r,3*e,o,a)}:t=>{eh(r,3*t,o,a)},l=Ta.getPrimitive(),c=t.geometry.index,u=t.geometry.attributes.position,d=t.indirect?e=>{const s=t.resolveTriangleIndex(e);eh(l,3*s,c,u)}:t=>{eh(l,3*t,c,u)};if(n){const t=(t,s,i,o,a,c,u,p)=>{for(let f=i,m=i+o;f<m;f++){d(f),l.a.applyMatrix4(e),l.b.applyMatrix4(e),l.c.applyMatrix4(e),l.needsUpdate=!0;for(let e=t,i=t+s;e<i;e++)if(h(e),r.needsUpdate=!0,n(r,l,e,f,a,c,u,p))return!0}return!1};if(i){const e=i;i=function(s,i,n,r,o,a,h,l){return!!e(s,i,n,r,o,a,h,l)||t(s,i,n,r,o,a,h,l)}}else i=t}return function(t,e,s,i){if(al)throw new Error("MeshBVH: Recursive calls to bvhcast not supported.");al=!0;const n=t._roots,r=e._roots;let o,a=0,h=0;const l=(new Ae).copy(s).invert();for(let t=0,e=n.length;t<e;t++){tl.setBuffer(n[t]),h=0;const e=sl.getPrimitive();ia(0,tl.float32Array,e),e.applyMatrix4(l);for(let n=0,c=r.length;n<c&&(el.setBuffer(r[t]),o=hl(0,0,s,l,i,a,h,0,0,e),el.clearBuffer(),h+=r[n].length,!o);n++);if(sl.releasePrimitive(e),tl.clearBuffer(),a+=n[t].length,o)break}return al=!1,o}(this,t,e,i)}intersectsBox(t,e){return ll.set(t.min,t.max,e),ll.needsUpdate=!0,this.shapecast({intersectsBounds:t=>ll.intersectsBox(t),intersectsTriangle:t=>ll.intersectsTriangle(t)})}intersectsSphere(t){return this.shapecast({intersectsBounds:e=>t.intersectsBox(e),intersectsTriangle:e=>e.intersectsSphere(t)})}closestPointToGeometry(t,e,s={},i={},n=0,r=1/0){return(this.indirect?Kh:Bh)(this,t,e,s,i,n,r)}closestPointToPoint(t,e={},s=0,i=1/0){return function(t,e,s={},i=0,n=1/0){const r=i*i,o=n*n;let a=1/0,h=null;if(t.shapecast({boundsTraverseOrder:t=>(Wa.copy(e).clamp(t.min,t.max),Wa.distanceToSquared(e)),intersectsBounds:(t,e,s)=>s<a&&s<o,intersectsTriangle:(t,s)=>{t.closestPointToPoint(e,Wa);const i=e.distanceToSquared(Wa);return i<a&&(Za.copy(Wa),a=i,h=s),i<r}}),a===1/0)return null;const l=Math.sqrt(a);return s.point?s.point.copy(Za):s.point=Za.clone(),s.distance=l,s.faceIndex=h,s}(this,t,e,s,i)}getBoundingBox(t){t.makeEmpty();return this._roots.forEach((e=>{ia(0,new Float32Array(e),cl),t.union(cl)})),t}}function dl(t,e,s){return null===t?null:(t.point.applyMatrix4(e.matrixWorld),t.distance=t.point.distanceTo(s.ray.origin),t.object=e,t.distance<s.near||t.distance>s.far?null:t)}const pl=new Me,fl=new Ae,ml=js.prototype.raycast;function bl(t,e){if(this.geometry.boundsTree){if(void 0===this.material)return;fl.copy(this.matrixWorld).invert(),pl.copy(t.ray).applyMatrix4(fl);const s=this.geometry.boundsTree;if(!0===t.firstHitOnly){const i=dl(s.raycastFirst(pl,this.material),this,t);i&&e.push(i)}else{const i=s.raycast(pl,this.material);for(let s=0,n=i.length;s<n;s++){const n=dl(i[s],this,t);n&&e.push(n)}}}else ml.call(this,t,e)}function yl(t){return this.boundsTree=new ul(this,t),this.boundsTree}function gl(){this.boundsTree=null}const _l=class t{static transform(t,e,s=new ti){for(let i=0;i<s.planes.length;i++)s.planes[i].copy(t.planes[i]).applyMatrix4(e);return s}static isHitting(e,s){return t.hits(e,s,!1)}static isIncluded(e,s){return t.hits(e,s,!0)}static containedInIndependentPlanes(t,e){let s=!0;for(const i of e)s=s&&i.distanceToPoint(t)>=0;return s}};nt(_l,"hits",(()=>{const t=new Yt;return(e,s,i)=>{for(let n=0,r=e.length;n<r;n++){const r=e[n].normal;if(t.set(r.x>=0!==i?s.max.x:s.min.x,r.y>=0!==i?s.max.y:s.min.y,r.z>=0!==i?s.max.z:s.min.z),e[n].distanceToPoint(t)<0)return!1}return!0}})());let xl=_l;function wl(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var vl={exports:{}};function Ml(t,e,s){s=s||2;var i,n,r,o,a,h,l,c=e&&e.length,u=c?e[0]*s:t.length,d=Al(t,0,u,s,!0),p=[];if(!d||d.next===d.prev)return p;if(c&&(d=function(t,e,s,i){var n,r,o,a=[];for(n=0,r=e.length;n<r;n++)(o=Al(t,e[n]*i,n<r-1?e[n+1]*i:t.length,i,!1))===o.next&&(o.steiner=!0),a.push(Rl(o));for(a.sort(El),n=0;n<a.length;n++)s=kl(a[n],s);return s}(t,e,d,s)),t.length>80*s){i=r=t[0],n=o=t[1];for(var f=s;f<u;f+=s)(a=t[f])<i&&(i=a),(h=t[f+1])<n&&(n=h),a>r&&(r=a),h>o&&(o=h);l=0!==(l=Math.max(r-i,o-n))?32767/l:0}return zl(d,p,s,i,n,l,0),p}function Al(t,e,s,i,n){var r,o;if(n===Yl(t,e,s,i)>0)for(r=e;r<s;r+=i)o=Hl(r,t[r],t[r+1],o);else for(r=s-i;r>=e;r-=i)o=Hl(r,t[r],t[r+1],o);return o&&Ul(o,o.next)&&(jl(o),o=o.next),o}function Sl(t,e){if(!t)return t;e||(e=t);var s,i=t;do{if(s=!1,i.steiner||!Ul(i,i.next)&&0!==Vl(i.prev,i,i.next))i=i.next;else{if(jl(i),(i=e=i.prev)===i.next)break;s=!0}}while(s||i!==e);return e}function zl(t,e,s,i,n,r,o){if(t){!o&&r&&function(t,e,s,i){var n=t;do{0===n.z&&(n.z=Fl(n.x,n.y,e,s,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,function(t){var e,s,i,n,r,o,a,h,l=1;do{for(s=t,t=null,r=null,o=0;s;){for(o++,i=s,a=0,e=0;e<l&&(a++,i=i.nextZ);e++);for(h=l;a>0||h>0&&i;)0!==a&&(0===h||!i||s.z<=i.z)?(n=s,s=s.nextZ,a--):(n=i,i=i.nextZ,h--),r?r.nextZ=n:t=n,n.prevZ=r,r=n;s=i}r.nextZ=null,l*=2}while(o>1)}(n)}(t,i,n,r);for(var a,h,l=t;t.prev!==t.next;)if(a=t.prev,h=t.next,r?Tl(t,i,n,r):Il(t))e.push(a.i/s|0),e.push(t.i/s|0),e.push(h.i/s|0),jl(t),t=h.next,l=h.next;else if((t=h)===l){o?1===o?zl(t=Bl(Sl(t),e,s),e,s,i,n,r,2):2===o&&Cl(t,e,s,i,n,r):zl(Sl(t),e,s,i,n,r,1);break}}}function Il(t){var e=t.prev,s=t,i=t.next;if(Vl(e,s,i)>=0)return!1;for(var n=e.x,r=s.x,o=i.x,a=e.y,h=s.y,l=i.y,c=n<r?n<o?n:o:r<o?r:o,u=a<h?a<l?a:l:h<l?h:l,d=n>r?n>o?n:o:r>o?r:o,p=a>h?a>l?a:l:h>l?h:l,f=i.next;f!==e;){if(f.x>=c&&f.x<=d&&f.y>=u&&f.y<=p&&Ll(n,a,r,h,o,l,f.x,f.y)&&Vl(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function Tl(t,e,s,i){var n=t.prev,r=t,o=t.next;if(Vl(n,r,o)>=0)return!1;for(var a=n.x,h=r.x,l=o.x,c=n.y,u=r.y,d=o.y,p=a<h?a<l?a:l:h<l?h:l,f=c<u?c<d?c:d:u<d?u:d,m=a>h?a>l?a:l:h>l?h:l,b=c>u?c>d?c:d:u>d?u:d,y=Fl(p,f,e,s,i),g=Fl(m,b,e,s,i),_=t.prevZ,x=t.nextZ;_&&_.z>=y&&x&&x.z<=g;){if(_.x>=p&&_.x<=m&&_.y>=f&&_.y<=b&&_!==n&&_!==o&&Ll(a,c,h,u,l,d,_.x,_.y)&&Vl(_.prev,_,_.next)>=0)return!1;if(_=_.prevZ,x.x>=p&&x.x<=m&&x.y>=f&&x.y<=b&&x!==n&&x!==o&&Ll(a,c,h,u,l,d,x.x,x.y)&&Vl(x.prev,x,x.next)>=0)return!1;x=x.nextZ}for(;_&&_.z>=y;){if(_.x>=p&&_.x<=m&&_.y>=f&&_.y<=b&&_!==n&&_!==o&&Ll(a,c,h,u,l,d,_.x,_.y)&&Vl(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;x&&x.z<=g;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=b&&x!==n&&x!==o&&Ll(a,c,h,u,l,d,x.x,x.y)&&Vl(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function Bl(t,e,s){var i=t;do{var n=i.prev,r=i.next.next;!Ul(n,r)&&Dl(n,i,i.next,r)&&Zl(n,r)&&Zl(r,n)&&(e.push(n.i/s|0),e.push(i.i/s|0),e.push(r.i/s|0),jl(i),jl(i.next),i=t=r),i=i.next}while(i!==t);return Sl(i)}function Cl(t,e,s,i,n,r){var o=t;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&Ol(o,a)){var h=ql(o,a);return o=Sl(o,o.next),h=Sl(h,h.next),zl(o,e,s,i,n,r,0),void zl(h,e,s,i,n,r,0)}a=a.next}o=o.next}while(o!==t)}function El(t,e){return t.x-e.x}function kl(t,e){var s=function(t,e){var s,i=e,n=t.x,r=t.y,o=-1/0;do{if(r<=i.y&&r>=i.next.y&&i.next.y!==i.y){var a=i.x+(r-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(a<=n&&a>o&&(o=a,s=i.x<i.next.x?i:i.next,a===n))return s}i=i.next}while(i!==e);if(!s)return null;var h,l=s,c=s.x,u=s.y,d=1/0;i=s;do{n>=i.x&&i.x>=c&&n!==i.x&&Ll(r<u?n:o,r,c,u,r<u?o:n,r,i.x,i.y)&&(h=Math.abs(r-i.y)/(n-i.x),Zl(i,t)&&(h<d||h===d&&(i.x>s.x||i.x===s.x&&Pl(s,i)))&&(s=i,d=h)),i=i.next}while(i!==l);return s}(t,e);if(!s)return e;var i=ql(s,t);return Sl(i,i.next),Sl(s,s.next)}function Pl(t,e){return Vl(t.prev,t,e.prev)<0&&Vl(e.next,t,t.next)<0}function Fl(t,e,s,i,n){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-s)*n|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*n|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Rl(t){var e=t,s=t;do{(e.x<s.x||e.x===s.x&&e.y<s.y)&&(s=e),e=e.next}while(e!==t);return s}function Ll(t,e,s,i,n,r,o,a){return(n-o)*(e-a)>=(t-o)*(r-a)&&(t-o)*(i-a)>=(s-o)*(e-a)&&(s-o)*(r-a)>=(n-o)*(i-a)}function Ol(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var s=t;do{if(s.i!==t.i&&s.next.i!==t.i&&s.i!==e.i&&s.next.i!==e.i&&Dl(s,s.next,t,e))return!0;s=s.next}while(s!==t);return!1}(t,e)&&(Zl(t,e)&&Zl(e,t)&&function(t,e){var s=t,i=!1,n=(t.x+e.x)/2,r=(t.y+e.y)/2;do{s.y>r!=s.next.y>r&&s.next.y!==s.y&&n<(s.next.x-s.x)*(r-s.y)/(s.next.y-s.y)+s.x&&(i=!i),s=s.next}while(s!==t);return i}(t,e)&&(Vl(t.prev,t,e.prev)||Vl(t,e.prev,e))||Ul(t,e)&&Vl(t.prev,t,t.next)>0&&Vl(e.prev,e,e.next)>0)}function Vl(t,e,s){return(e.y-t.y)*(s.x-e.x)-(e.x-t.x)*(s.y-e.y)}function Ul(t,e){return t.x===e.x&&t.y===e.y}function Dl(t,e,s,i){var n=Wl(Vl(t,e,s)),r=Wl(Vl(t,e,i)),o=Wl(Vl(s,i,t)),a=Wl(Vl(s,i,e));return n!==r&&o!==a||(!(0!==n||!Nl(t,s,e))||(!(0!==r||!Nl(t,i,e))||(!(0!==o||!Nl(s,t,i))||!(0!==a||!Nl(s,e,i)))))}function Nl(t,e,s){return e.x<=Math.max(t.x,s.x)&&e.x>=Math.min(t.x,s.x)&&e.y<=Math.max(t.y,s.y)&&e.y>=Math.min(t.y,s.y)}function Wl(t){return t>0?1:t<0?-1:0}function Zl(t,e){return Vl(t.prev,t,t.next)<0?Vl(t,e,t.next)>=0&&Vl(t,t.prev,e)>=0:Vl(t,e,t.prev)<0||Vl(t,t.next,e)<0}function ql(t,e){var s=new Gl(t.i,t.x,t.y),i=new Gl(e.i,e.x,e.y),n=t.next,r=e.prev;return t.next=e,e.prev=t,s.next=n,n.prev=s,i.next=s,s.prev=i,r.next=i,i.prev=r,i}function Hl(t,e,s,i){var n=new Gl(t,e,s);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function jl(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Gl(t,e,s){this.i=t,this.x=e,this.y=s,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Yl(t,e,s,i){for(var n=0,r=e,o=s-i;r<s;r+=i)n+=(t[o]-t[r])*(t[r+1]+t[o+1]),o=r;return n}vl.exports=Ml,vl.exports.default=Ml,Ml.deviation=function(t,e,s,i){var n=e&&e.length,r=n?e[0]*s:t.length,o=Math.abs(Yl(t,0,r,s));if(n)for(var a=0,h=e.length;a<h;a++){var l=e[a]*s,c=a<h-1?e[a+1]*s:t.length;o-=Math.abs(Yl(t,l,c,s))}var u=0;for(a=0;a<i.length;a+=3){var d=i[a]*s,p=i[a+1]*s,f=i[a+2]*s;u+=Math.abs((t[d]-t[f])*(t[p+1]-t[d+1])-(t[d]-t[p])*(t[f+1]-t[d+1]))}return 0===o&&0===u?0:Math.abs((u-o)/o)},Ml.flatten=function(t){for(var e=t[0][0].length,s={vertices:[],holes:[],dimensions:e},i=0,n=0;n<t.length;n++){for(var r=0;r<t[n].length;r++)for(var o=0;o<e;o++)s.vertices.push(t[n][r][o]);n>0&&(i+=t[n-1].length,s.holes.push(i))}return s};const Xl=wl(vl.exports);class Jl{constructor(){nt(this,"_inverseMatrix",new Ae),nt(this,"_localPlane",new Qs),nt(this,"_tempLine",new bi),nt(this,"_tempVector",new Yt),nt(this,"_plane"),nt(this,"_plane2DCoordinateSystem",new Ae),nt(this,"_precission",1e4),nt(this,"_planeAxis")}get plane(){if(!this._plane)throw new Error("Plane not set");return this._plane}set plane(t){this._plane=t}createEdges(t){const{meshes:e,posAttr:s}=t;let i=0;s.array.fill(0);const n=[];let r=0;const o=new js;for(const t of e)if(t.geometry){if(t.geometry.boundsTree||t.geometry.computeBoundsTree(),!t.geometry.boundsTree)throw new Error("Bounds tree not found for edges generation.");if(t instanceof ci){if(0===t.count)continue;const e=t;for(let a=0;a<e.count;a++){o.geometry=t.geometry,o.matrix.copy(t.matrix);const h=new Ae;e.getMatrixAt(a,h),o.applyMatrix4(h),o.applyMatrix4(t.matrixWorld),o.updateMatrix(),o.updateMatrixWorld(),this._inverseMatrix.copy(o.matrixWorld).invert(),this._localPlane.copy(this.plane).applyMatrix4(this._inverseMatrix),i=this.shapecast(o,s,i),i!==r&&(n.push(i),r=i)}}else this._inverseMatrix.copy(t.matrixWorld).invert(),this._localPlane.copy(this.plane).applyMatrix4(this._inverseMatrix),i=this.shapecast(t,s,i),i!==r&&(n.push(i),r=i)}return{indexes:n,index:i}}createFills(t,e){this.updatePlane2DCoordinateSystem();const s=[];let i=0;for(let n=0;n<e.length;n++){const r=e[n],o=[];for(let t=i;t<r;t+=2)o.push(3*t);const a=this.computeFill(o,t);for(const t of a)s.push(t);i=r}return s}computeFill(t,e){const s=new Map,i={},n=new Map;let r=0;const o=new Map,a=new Map,h=new Set,l=this._precission;for(let c=0;c<t.length;c++){const u=t[c];let d=0,p=0,f=0,m=0;const b=e[u],y=e[u+1],g=e[u+2],_=e[u+3],x=e[u+4],w=e[u+5];if(this._tempVector.set(b,y,g),this._tempVector.applyMatrix4(this._plane2DCoordinateSystem),d=Math.trunc(this._tempVector.x*l)/l,p=Math.trunc(this._tempVector.y*l)/l,this._tempVector.set(_,x,w),this._tempVector.applyMatrix4(this._plane2DCoordinateSystem),f=Math.trunc(this._tempVector.x*l)/l,m=Math.trunc(this._tempVector.y*l)/l,d===f&&p===m)continue;const v=`${d}|${p}`,M=`${f}|${m}`;s.has(v)||s.set(v,u/3),s.has(M)||s.set(M,u/3+1);const A=s.get(v),S=s.get(M);i[A]=[d,p],i[S]=[f,m];const z=a.has(A),I=o.has(A),T=a.has(S),B=o.has(S);if(!(z||I||T||B))a.set(A,r),o.set(S,r),h.add(r),n.set(r,[A,S]),r++;else if(z&&B){const t=a.get(A),e=o.get(S);if(t!==e){const s=n.get(e),i=n.get(t);if(!s||!i)continue;n.delete(t),h.delete(t),o.set(i[i.length-1],e),o.delete(s[s.length-1]);for(const t of i)s.push(t)}else h.delete(e);a.delete(A),o.delete(S)}else if(I&&T){const t=a.get(S),e=o.get(A);if(t!==e){const s=n.get(e),i=n.get(t);if(!s||!i)continue;n.delete(t),h.delete(t),o.set(i[i.length-1],e),o.delete(s[s.length-1]);for(const t of i)s.push(t)}else h.delete(e);a.delete(S),o.delete(A)}else if(z&&T){const t=a.get(S),e=a.get(A),s=n.get(e),i=n.get(t);if(!s||!i)continue;n.delete(t),h.delete(t),a.delete(s[0]),a.delete(i[0]),o.delete(i[i.length-1]),a.set(i[i.length-1],e),i.reverse(),s.splice(0,0,...i)}else if(I&&B){const t=o.get(S),e=o.get(A),s=n.get(e),i=n.get(t);if(!s||!i)continue;n.delete(t),h.delete(t),o.delete(s[s.length-1]),o.delete(i[i.length-1]),a.delete(i[0]),o.set(i[0],e),i.reverse(),s.push(...i)}else if(z){const t=a.get(A),e=n.get(t);if(!e)continue;e.unshift(S),a.delete(A),a.set(S,t)}else if(I){const t=o.get(A),e=n.get(t);if(!e)continue;e.push(S),o.delete(A),o.set(S,t)}else if(T){const t=a.get(S),e=n.get(t);if(!e)continue;e.unshift(A),a.delete(S),a.set(A,t)}else if(B){const t=o.get(S),e=n.get(t);if(!e)continue;e.push(A),o.delete(S),o.set(A,t)}}const c=[];for(const[t,e]of n){if(h.has(t))continue;const s=[],n=new Map;let r=0;for(const t of e){const e=i[t];s.push(e[0],e[1]),n.set(r++,t)}const o=Xl(s);for(const t of o){const e=n.get(t);if(void 0===e)throw new Error("Map error!");c.push(e)}}return c}updatePlane2DCoordinateSystem(){this._plane2DCoordinateSystem=new Ae;const t=new Yt(1,0,0),e=new Yt(0,1,0),s=this.plane.normal,i=new Yt;this.plane.coplanarPoint(i),"x"===this._planeAxis?t.crossVectors(e,s):"y"===this._planeAxis?e.crossVectors(s,t):"z"===this._planeAxis||(t.crossVectors(e,s).normalize(),e.crossVectors(s,t)),this._plane2DCoordinateSystem.fromArray([t.x,t.y,t.z,0,e.x,e.y,e.z,0,s.x,s.y,s.z,0,i.x,i.y,i.z,1]),this._plane2DCoordinateSystem.invert()}shapecast(t,e,s){return t.geometry.boundsTree.shapecast({intersectsBounds:t=>this._localPlane.intersectsBox(t),intersectsTriangle:i=>{let n=0;if(this._tempLine.start.copy(i.a),this._tempLine.end.copy(i.b),this._localPlane.intersectLine(this._tempLine,this._tempVector)){const i=this._tempVector.applyMatrix4(t.matrixWorld);e.setXYZ(s,i.x,i.y,i.z),n++,s++}if(this._tempLine.start.copy(i.b),this._tempLine.end.copy(i.c),this._localPlane.intersectLine(this._tempLine,this._tempVector)){const i=this._tempVector.applyMatrix4(t.matrixWorld);e.setXYZ(s,i.x,i.y,i.z),n++,s++}if(this._tempLine.start.copy(i.c),this._tempLine.end.copy(i.a),this._localPlane.intersectLine(this._tempLine,this._tempVector)){const i=this._tempVector.applyMatrix4(t.matrixWorld);e.setXYZ(s,i.x,i.y,i.z),n++,s++}2!==n&&(s-=n)}}),s}}class Ql{constructor(){nt(this,"bb",null),nt(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsAttribute(t,e){return(e||new Ql).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsAttribute(t,e){return t.setPosition(t.position()+4),(e||new Ql).__init(t.readInt32(t.position())+t.position(),t)}data(t,e){const s=this.bb.__offset(this.bb_pos,4);return s?this.bb.__string(this.bb.__vector(this.bb_pos+s)+4*t,e):null}dataLength(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}static startAttribute(t){t.startObject(1)}static addData(t,e){t.addFieldOffset(0,e,0)}static createDataVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addOffset(e[s]);return t.endVector()}static startDataVector(t,e){t.startVector(4,e,4)}static endAttribute(t){const e=t.endObject();return t.requiredField(e,4),e}static createAttribute(t,e){return Ql.startAttribute(t),Ql.addData(t,e),Ql.endAttribute(t)}}class $l{constructor(){nt(this,"bb",null),nt(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}x(){return this.bb.readFloat32(this.bb_pos)}mutate_x(t){return this.bb.writeFloat32(this.bb_pos+0,t),!0}y(){return this.bb.readFloat32(this.bb_pos+4)}mutate_y(t){return this.bb.writeFloat32(this.bb_pos+4,t),!0}z(){return this.bb.readFloat32(this.bb_pos+8)}mutate_z(t){return this.bb.writeFloat32(this.bb_pos+8,t),!0}static sizeOf(){return 12}static createFloatVector(t,e,s,i){return t.prep(4,12),t.writeFloat32(i),t.writeFloat32(s),t.writeFloat32(e),t.offset()}}class Kl{constructor(){nt(this,"bb",null),nt(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}aperture(){return this.bb.readFloat32(this.bb_pos)}mutate_aperture(t){return this.bb.writeFloat32(this.bb_pos+0,t),!0}position(t){return(t||new $l).__init(this.bb_pos+4,this.bb)}radius(){return this.bb.readFloat32(this.bb_pos+16)}mutate_radius(t){return this.bb.writeFloat32(this.bb_pos+16,t),!0}xDirection(t){return(t||new $l).__init(this.bb_pos+20,this.bb)}yDirection(t){return(t||new $l).__init(this.bb_pos+32,this.bb)}static sizeOf(){return 44}static createCircleCurve(t,e,s,i,n,r,o,a,h,l,c,u){return t.prep(4,44),t.prep(4,12),t.writeFloat32(u),t.writeFloat32(c),t.writeFloat32(l),t.prep(4,12),t.writeFloat32(h),t.writeFloat32(a),t.writeFloat32(o),t.writeFloat32(r),t.prep(4,12),t.writeFloat32(n),t.writeFloat32(i),t.writeFloat32(s),t.writeFloat32(e),t.offset()}}class tc{constructor(){nt(this,"bb",null),nt(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}p1(t){return(t||new $l).__init(this.bb_pos,this.bb)}p2(t){return(t||new $l).__init(this.bb_pos+12,this.bb)}static sizeOf(){return 24}static createWire(t,e,s,i,n,r,o){return t.prep(4,24),t.prep(4,12),t.writeFloat32(o),t.writeFloat32(r),t.writeFloat32(n),t.prep(4,12),t.writeFloat32(i),t.writeFloat32(s),t.writeFloat32(e),t.offset()}}class ec{constructor(){nt(this,"bb",null),nt(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsWireSet(t,e){return(e||new ec).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsWireSet(t,e){return t.setPosition(t.position()+4),(e||new ec).__init(t.readInt32(t.position())+t.position(),t)}ps(t,e){const s=this.bb.__offset(this.bb_pos,4);return s?(e||new $l).__init(this.bb.__vector(this.bb_pos+s)+12*t,this.bb):null}psLength(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}static startWireSet(t){t.startObject(1)}static addPs(t,e){t.addFieldOffset(0,e,0)}static startPsVector(t,e){t.startVector(12,e,4)}static endWireSet(t){return t.endObject()}static createWireSet(t,e){return ec.startWireSet(t),ec.addPs(t,e),ec.endWireSet(t)}}class sc{constructor(){nt(this,"bb",null),nt(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsAxis(t,e){return(e||new sc).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsAxis(t,e){return t.setPosition(t.position()+4),(e||new sc).__init(t.readInt32(t.position())+t.position(),t)}wires(t,e){const s=this.bb.__offset(this.bb_pos,4);return s?(e||new tc).__init(this.bb.__vector(this.bb_pos+s)+24*t,this.bb):null}wiresLength(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}order(t){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readUint32(this.bb.__vector(this.bb_pos+e)+4*t):0}orderLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}orderArray(){const t=this.bb.__offset(this.bb_pos,6);return t?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}parts(t){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.readInt8(this.bb.__vector(this.bb_pos+e)+t):0}partsLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}partsArray(){const t=this.bb.__offset(this.bb_pos,8);return t?new Int8Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}wireSets(t,e){const s=this.bb.__offset(this.bb_pos,10);return s?(e||new ec).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+s)+4*t),this.bb):null}wireSetsLength(){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__vector_len(this.bb_pos+t):0}circleCurves(t,e){const s=this.bb.__offset(this.bb_pos,12);return s?(e||new Kl).__init(this.bb.__vector(this.bb_pos+s)+44*t,this.bb):null}circleCurvesLength(){const t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__vector_len(this.bb_pos+t):0}static startAxis(t){t.startObject(5)}static addWires(t,e){t.addFieldOffset(0,e,0)}static startWiresVector(t,e){t.startVector(24,e,4)}static addOrder(t,e){t.addFieldOffset(1,e,0)}static createOrderVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addInt32(e[s]);return t.endVector()}static startOrderVector(t,e){t.startVector(4,e,4)}static addParts(t,e){t.addFieldOffset(2,e,0)}static createPartsVector(t,e){t.startVector(1,e.length,1);for(let s=e.length-1;s>=0;s--)t.addInt8(e[s]);return t.endVector()}static startPartsVector(t,e){t.startVector(1,e,1)}static addWireSets(t,e){t.addFieldOffset(3,e,0)}static createWireSetsVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addOffset(e[s]);return t.endVector()}static startWireSetsVector(t,e){t.startVector(4,e,4)}static addCircleCurves(t,e){t.addFieldOffset(4,e,0)}static startCircleCurvesVector(t,e){t.startVector(44,e,4)}static endAxis(t){const e=t.endObject();return t.requiredField(e,4),t.requiredField(e,6),t.requiredField(e,8),t.requiredField(e,10),t.requiredField(e,12),e}static createAxis(t,e,s,i,n,r){return sc.startAxis(t),sc.addWires(t,e),sc.addOrder(t,s),sc.addParts(t,i),sc.addWireSets(t,n),sc.addCircleCurves(t,r),sc.endAxis(t)}}var ic=(t=>(t[t.NONE=0]="NONE",t[t.WIRE=1]="WIRE",t[t.WIRE_SET=2]="WIRE_SET",t[t.CIRCLE_CURVE=3]="CIRCLE_CURVE",t))(ic||{});class nc{constructor(){nt(this,"bb",null),nt(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}min(t){return(t||new $l).__init(this.bb_pos,this.bb)}max(t){return(t||new $l).__init(this.bb_pos+12,this.bb)}static sizeOf(){return 24}static createBoundingBox(t,e,s,i,n,r,o){return t.prep(4,24),t.prep(4,12),t.writeFloat32(o),t.writeFloat32(r),t.writeFloat32(n),t.prep(4,12),t.writeFloat32(i),t.writeFloat32(s),t.writeFloat32(e),t.offset()}}class rc{constructor(){nt(this,"bb",null),nt(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsCircleExtrusion(t,e){return(e||new rc).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsCircleExtrusion(t,e){return t.setPosition(t.position()+4),(e||new rc).__init(t.readInt32(t.position())+t.position(),t)}radius(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+8*t):0}radiusLength(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}radiusArray(){const t=this.bb.__offset(this.bb_pos,4);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}axes(t,e){const s=this.bb.__offset(this.bb_pos,6);return s?(e||new sc).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+s)+4*t),this.bb):null}axesLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}static startCircleExtrusion(t){t.startObject(2)}static addRadius(t,e){t.addFieldOffset(0,e,0)}static createRadiusVector(t,e){t.startVector(8,e.length,8);for(let s=e.length-1;s>=0;s--)t.addFloat64(e[s]);return t.endVector()}static startRadiusVector(t,e){t.startVector(8,e,8)}static addAxes(t,e){t.addFieldOffset(1,e,0)}static createAxesVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addOffset(e[s]);return t.endVector()}static startAxesVector(t,e){t.startVector(4,e,4)}static endCircleExtrusion(t){const e=t.endObject();return t.requiredField(e,4),t.requiredField(e,6),e}static createCircleExtrusion(t,e,s){return rc.startCircleExtrusion(t),rc.addRadius(t,e),rc.addAxes(t,s),rc.endCircleExtrusion(t)}}class oc{constructor(){nt(this,"bb",null),nt(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}x(){return this.bb.readFloat64(this.bb_pos)}mutate_x(t){return this.bb.writeFloat64(this.bb_pos+0,t),!0}y(){return this.bb.readFloat64(this.bb_pos+8)}mutate_y(t){return this.bb.writeFloat64(this.bb_pos+8,t),!0}z(){return this.bb.readFloat64(this.bb_pos+16)}mutate_z(t){return this.bb.writeFloat64(this.bb_pos+16,t),!0}static sizeOf(){return 24}static createDoubleVector(t,e,s,i){return t.prep(8,24),t.writeFloat64(i),t.writeFloat64(s),t.writeFloat64(e),t.offset()}}class ac{constructor(){nt(this,"bb",null),nt(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}r(){return this.bb.readUint8(this.bb_pos)}mutate_r(t){return this.bb.writeUint8(this.bb_pos+0,t),!0}g(){return this.bb.readUint8(this.bb_pos+1)}mutate_g(t){return this.bb.writeUint8(this.bb_pos+1,t),!0}b(){return this.bb.readUint8(this.bb_pos+2)}mutate_b(t){return this.bb.writeUint8(this.bb_pos+2,t),!0}a(){return this.bb.readUint8(this.bb_pos+3)}mutate_a(t){return this.bb.writeUint8(this.bb_pos+3,t),!0}renderedFaces(){return this.bb.readInt8(this.bb_pos+4)}mutate_rendered_faces(t){return this.bb.writeInt8(this.bb_pos+4,t),!0}stroke(){return this.bb.readInt8(this.bb_pos+5)}mutate_stroke(t){return this.bb.writeInt8(this.bb_pos+5,t),!0}static sizeOf(){return 6}static createMaterial(t,e,s,i,n,r,o){return t.prep(1,6),t.writeInt8(o),t.writeInt8(r),t.writeInt8(n),t.writeInt8(i),t.writeInt8(s),t.writeInt8(e),t.offset()}}class hc{constructor(){nt(this,"bb",null),nt(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}id(){return this.bb.readUint32(this.bb_pos)}mutate_id(t){return this.bb.writeUint32(this.bb_pos+0,t),!0}bbox(t){return(t||new nc).__init(this.bb_pos+4,this.bb)}representationClass(){return this.bb.readInt8(this.bb_pos+28)}mutate_representation_class(t){return this.bb.writeInt8(this.bb_pos+28,t),!0}static sizeOf(){return 32}static createRepresentation(t,e,s,i,n,r,o,a,h){return t.prep(4,32),t.pad(3),t.writeInt8(h),t.prep(4,24),t.prep(4,12),t.writeFloat32(a),t.writeFloat32(o),t.writeFloat32(r),t.prep(4,12),t.writeFloat32(n),t.writeFloat32(i),t.writeFloat32(s),t.writeInt32(e),t.offset()}}class lc{constructor(){nt(this,"bb",null),nt(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}item(){return this.bb.readUint32(this.bb_pos)}mutate_item(t){return this.bb.writeUint32(this.bb_pos+0,t),!0}material(){return this.bb.readUint32(this.bb_pos+4)}mutate_material(t){return this.bb.writeUint32(this.bb_pos+4,t),!0}representation(){return this.bb.readUint32(this.bb_pos+8)}mutate_representation(t){return this.bb.writeUint32(this.bb_pos+8,t),!0}localTransform(){return this.bb.readUint32(this.bb_pos+12)}mutate_local_transform(t){return this.bb.writeUint32(this.bb_pos+12,t),!0}static sizeOf(){return 16}static createSample(t,e,s,i,n){return t.prep(4,16),t.writeInt32(n),t.writeInt32(i),t.writeInt32(s),t.writeInt32(e),t.offset()}}class cc{constructor(){nt(this,"bb",null),nt(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsShellHole(t,e){return(e||new cc).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsShellHole(t,e){return t.setPosition(t.position()+4),(e||new cc).__init(t.readInt32(t.position())+t.position(),t)}indices(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readUint16(this.bb.__vector(this.bb_pos+e)+2*t):0}indicesLength(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}indicesArray(){const t=this.bb.__offset(this.bb_pos,4);return t?new Uint16Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}profileId(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readUint16(this.bb_pos+t):0}mutate_profile_id(t){const e=this.bb.__offset(this.bb_pos,6);return 0!==e&&(this.bb.writeUint16(this.bb_pos+e,t),!0)}static startShellHole(t){t.startObject(2)}static addIndices(t,e){t.addFieldOffset(0,e,0)}static createIndicesVector(t,e){t.startVector(2,e.length,2);for(let s=e.length-1;s>=0;s--)t.addInt16(e[s]);return t.endVector()}static startIndicesVector(t,e){t.startVector(2,e,2)}static addProfileId(t,e){t.addFieldInt16(1,e,0)}static endShellHole(t){const e=t.endObject();return t.requiredField(e,4),e}static createShellHole(t,e,s){return cc.startShellHole(t),cc.addIndices(t,e),cc.addProfileId(t,s),cc.endShellHole(t)}}class uc{constructor(){nt(this,"bb",null),nt(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsShellProfile(t,e){return(e||new uc).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsShellProfile(t,e){return t.setPosition(t.position()+4),(e||new uc).__init(t.readInt32(t.position())+t.position(),t)}indices(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readUint16(this.bb.__vector(this.bb_pos+e)+2*t):0}indicesLength(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}indicesArray(){const t=this.bb.__offset(this.bb_pos,4);return t?new Uint16Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}static startShellProfile(t){t.startObject(1)}static addIndices(t,e){t.addFieldOffset(0,e,0)}static createIndicesVector(t,e){t.startVector(2,e.length,2);for(let s=e.length-1;s>=0;s--)t.addInt16(e[s]);return t.endVector()}static startIndicesVector(t,e){t.startVector(2,e,2)}static endShellProfile(t){const e=t.endObject();return t.requiredField(e,4),e}static createShellProfile(t,e){return uc.startShellProfile(t),uc.addIndices(t,e),uc.endShellProfile(t)}}class dc{constructor(){nt(this,"bb",null),nt(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsShell(t,e){return(e||new dc).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsShell(t,e){return t.setPosition(t.position()+4),(e||new dc).__init(t.readInt32(t.position())+t.position(),t)}profiles(t,e){const s=this.bb.__offset(this.bb_pos,4);return s?(e||new uc).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+s)+4*t),this.bb):null}profilesLength(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}holes(t,e){const s=this.bb.__offset(this.bb_pos,6);return s?(e||new cc).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+s)+4*t),this.bb):null}holesLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}points(t,e){const s=this.bb.__offset(this.bb_pos,8);return s?(e||new $l).__init(this.bb.__vector(this.bb_pos+s)+12*t,this.bb):null}pointsLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}static startShell(t){t.startObject(3)}static addProfiles(t,e){t.addFieldOffset(0,e,0)}static createProfilesVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addOffset(e[s]);return t.endVector()}static startProfilesVector(t,e){t.startVector(4,e,4)}static addHoles(t,e){t.addFieldOffset(1,e,0)}static createHolesVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addOffset(e[s]);return t.endVector()}static startHolesVector(t,e){t.startVector(4,e,4)}static addPoints(t,e){t.addFieldOffset(2,e,0)}static startPointsVector(t,e){t.startVector(12,e,4)}static endShell(t){const e=t.endObject();return t.requiredField(e,4),t.requiredField(e,6),t.requiredField(e,8),e}static createShell(t,e,s,i){return dc.startShell(t),dc.addProfiles(t,e),dc.addHoles(t,s),dc.addPoints(t,i),dc.endShell(t)}}class pc{constructor(){nt(this,"bb",null),nt(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}position(t){return(t||new oc).__init(this.bb_pos,this.bb)}xDirection(t){return(t||new $l).__init(this.bb_pos+24,this.bb)}yDirection(t){return(t||new $l).__init(this.bb_pos+36,this.bb)}static sizeOf(){return 48}static createTransform(t,e,s,i,n,r,o,a,h,l){return t.prep(8,48),t.prep(4,12),t.writeFloat32(l),t.writeFloat32(h),t.writeFloat32(a),t.prep(4,12),t.writeFloat32(o),t.writeFloat32(r),t.writeFloat32(n),t.prep(8,24),t.writeFloat64(i),t.writeFloat64(s),t.writeFloat64(e),t.offset()}}class fc{constructor(){nt(this,"bb",null),nt(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsMeshes(t,e){return(e||new fc).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsMeshes(t,e){return t.setPosition(t.position()+4),(e||new fc).__init(t.readInt32(t.position())+t.position(),t)}coordinates(t){const e=this.bb.__offset(this.bb_pos,4);return e?(t||new pc).__init(this.bb_pos+e,this.bb):null}meshesItems(t){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readUint32(this.bb.__vector(this.bb_pos+e)+4*t):0}meshesItemsLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}meshesItemsArray(){const t=this.bb.__offset(this.bb_pos,6);return t?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}samples(t,e){const s=this.bb.__offset(this.bb_pos,8);return s?(e||new lc).__init(this.bb.__vector(this.bb_pos+s)+16*t,this.bb):null}samplesLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}representations(t,e){const s=this.bb.__offset(this.bb_pos,10);return s?(e||new hc).__init(this.bb.__vector(this.bb_pos+s)+32*t,this.bb):null}representationsLength(){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__vector_len(this.bb_pos+t):0}materials(t,e){const s=this.bb.__offset(this.bb_pos,12);return s?(e||new ac).__init(this.bb.__vector(this.bb_pos+s)+6*t,this.bb):null}materialsLength(){const t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__vector_len(this.bb_pos+t):0}circleExtrusions(t,e){const s=this.bb.__offset(this.bb_pos,14);return s?(e||new rc).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+s)+4*t),this.bb):null}circleExtrusionsLength(){const t=this.bb.__offset(this.bb_pos,14);return t?this.bb.__vector_len(this.bb_pos+t):0}shells(t,e){const s=this.bb.__offset(this.bb_pos,16);return s?(e||new dc).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+s)+4*t),this.bb):null}shellsLength(){const t=this.bb.__offset(this.bb_pos,16);return t?this.bb.__vector_len(this.bb_pos+t):0}localTransforms(t,e){const s=this.bb.__offset(this.bb_pos,18);return s?(e||new pc).__init(this.bb.__vector(this.bb_pos+s)+48*t,this.bb):null}localTransformsLength(){const t=this.bb.__offset(this.bb_pos,18);return t?this.bb.__vector_len(this.bb_pos+t):0}globalTransforms(t,e){const s=this.bb.__offset(this.bb_pos,20);return s?(e||new pc).__init(this.bb.__vector(this.bb_pos+s)+48*t,this.bb):null}globalTransformsLength(){const t=this.bb.__offset(this.bb_pos,20);return t?this.bb.__vector_len(this.bb_pos+t):0}static startMeshes(t){t.startObject(9)}static addCoordinates(t,e){t.addFieldStruct(0,e,0)}static addMeshesItems(t,e){t.addFieldOffset(1,e,0)}static createMeshesItemsVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addInt32(e[s]);return t.endVector()}static startMeshesItemsVector(t,e){t.startVector(4,e,4)}static addSamples(t,e){t.addFieldOffset(2,e,0)}static startSamplesVector(t,e){t.startVector(16,e,4)}static addRepresentations(t,e){t.addFieldOffset(3,e,0)}static startRepresentationsVector(t,e){t.startVector(32,e,4)}static addMaterials(t,e){t.addFieldOffset(4,e,0)}static startMaterialsVector(t,e){t.startVector(6,e,1)}static addCircleExtrusions(t,e){t.addFieldOffset(5,e,0)}static createCircleExtrusionsVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addOffset(e[s]);return t.endVector()}static startCircleExtrusionsVector(t,e){t.startVector(4,e,4)}static addShells(t,e){t.addFieldOffset(6,e,0)}static createShellsVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addOffset(e[s]);return t.endVector()}static startShellsVector(t,e){t.startVector(4,e,4)}static addLocalTransforms(t,e){t.addFieldOffset(7,e,0)}static startLocalTransformsVector(t,e){t.startVector(48,e,8)}static addGlobalTransforms(t,e){t.addFieldOffset(8,e,0)}static startGlobalTransformsVector(t,e){t.startVector(48,e,8)}static endMeshes(t){const e=t.endObject();return t.requiredField(e,4),t.requiredField(e,6),t.requiredField(e,8),t.requiredField(e,10),t.requiredField(e,12),t.requiredField(e,14),t.requiredField(e,16),t.requiredField(e,18),t.requiredField(e,20),e}static createMeshes(t,e,s,i,n,r,o,a,h,l){return fc.startMeshes(t),fc.addCoordinates(t,e),fc.addMeshesItems(t,s),fc.addSamples(t,i),fc.addRepresentations(t,n),fc.addMaterials(t,r),fc.addCircleExtrusions(t,o),fc.addShells(t,a),fc.addLocalTransforms(t,h),fc.addGlobalTransforms(t,l),fc.endMeshes(t)}}class mc{constructor(){nt(this,"bb",null),nt(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsRelation(t,e){return(e||new mc).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsRelation(t,e){return t.setPosition(t.position()+4),(e||new mc).__init(t.readInt32(t.position())+t.position(),t)}data(t,e){const s=this.bb.__offset(this.bb_pos,4);return s?this.bb.__string(this.bb.__vector(this.bb_pos+s)+4*t,e):null}dataLength(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}static startRelation(t){t.startObject(1)}static addData(t,e){t.addFieldOffset(0,e,0)}static createDataVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addOffset(e[s]);return t.endVector()}static startDataVector(t,e){t.startVector(4,e,4)}static endRelation(t){const e=t.endObject();return t.requiredField(e,4),e}static createRelation(t,e){return mc.startRelation(t),mc.addData(t,e),mc.endRelation(t)}}class bc{constructor(){nt(this,"bb",null),nt(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsSpatialStructure(t,e){return(e||new bc).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsSpatialStructure(t,e){return t.setPosition(t.position()+4),(e||new bc).__init(t.readInt32(t.position())+t.position(),t)}localId(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readUint32(this.bb_pos+t):null}mutate_local_id(t){const e=this.bb.__offset(this.bb_pos,4);return 0!==e&&(this.bb.writeUint32(this.bb_pos+e,t),!0)}category(t){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__string(this.bb_pos+e,t):null}children(t,e){const s=this.bb.__offset(this.bb_pos,8);return s?(e||new bc).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+s)+4*t),this.bb):null}childrenLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}static startSpatialStructure(t){t.startObject(3)}static addLocalId(t,e){t.addFieldInt32(0,e,null)}static addCategory(t,e){t.addFieldOffset(1,e,0)}static addChildren(t,e){t.addFieldOffset(2,e,0)}static createChildrenVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addOffset(e[s]);return t.endVector()}static startChildrenVector(t,e){t.startVector(4,e,4)}static endSpatialStructure(t){return t.endObject()}static createSpatialStructure(t,e,s,i){return bc.startSpatialStructure(t),null!==e&&bc.addLocalId(t,e),bc.addCategory(t,s),bc.addChildren(t,i),bc.endSpatialStructure(t)}}class yc{constructor(){nt(this,"bb",null),nt(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsModel(t,e){return(e||new yc).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsModel(t,e){return t.setPosition(t.position()+4),(e||new yc).__init(t.readInt32(t.position())+t.position(),t)}static bufferHasIdentifier(t){return t.__has_identifier("0001")}metadata(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}guids(t,e){const s=this.bb.__offset(this.bb_pos,6);return s?this.bb.__string(this.bb.__vector(this.bb_pos+s)+4*t,e):null}guidsLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}guidsItems(t){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.readUint32(this.bb.__vector(this.bb_pos+e)+4*t):0}guidsItemsLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}guidsItemsArray(){const t=this.bb.__offset(this.bb_pos,8);return t?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}maxLocalId(){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readUint32(this.bb_pos+t):0}mutate_max_local_id(t){const e=this.bb.__offset(this.bb_pos,10);return 0!==e&&(this.bb.writeUint32(this.bb_pos+e,t),!0)}localIds(t){const e=this.bb.__offset(this.bb_pos,12);return e?this.bb.readUint32(this.bb.__vector(this.bb_pos+e)+4*t):0}localIdsLength(){const t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__vector_len(this.bb_pos+t):0}localIdsArray(){const t=this.bb.__offset(this.bb_pos,12);return t?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}categories(t,e){const s=this.bb.__offset(this.bb_pos,14);return s?this.bb.__string(this.bb.__vector(this.bb_pos+s)+4*t,e):null}categoriesLength(){const t=this.bb.__offset(this.bb_pos,14);return t?this.bb.__vector_len(this.bb_pos+t):0}meshes(t){const e=this.bb.__offset(this.bb_pos,16);return e?(t||new fc).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}attributes(t,e){const s=this.bb.__offset(this.bb_pos,18);return s?(e||new Ql).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+s)+4*t),this.bb):null}attributesLength(){const t=this.bb.__offset(this.bb_pos,18);return t?this.bb.__vector_len(this.bb_pos+t):0}relations(t,e){const s=this.bb.__offset(this.bb_pos,20);return s?(e||new mc).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+s)+4*t),this.bb):null}relationsLength(){const t=this.bb.__offset(this.bb_pos,20);return t?this.bb.__vector_len(this.bb_pos+t):0}relationsItems(t){const e=this.bb.__offset(this.bb_pos,22);return e?this.bb.readInt32(this.bb.__vector(this.bb_pos+e)+4*t):0}relationsItemsLength(){const t=this.bb.__offset(this.bb_pos,22);return t?this.bb.__vector_len(this.bb_pos+t):0}relationsItemsArray(){const t=this.bb.__offset(this.bb_pos,22);return t?new Int32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}guid(t){const e=this.bb.__offset(this.bb_pos,24);return e?this.bb.__string(this.bb_pos+e,t):null}spatialStructure(t){const e=this.bb.__offset(this.bb_pos,26);return e?(t||new bc).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}static startModel(t){t.startObject(12)}static addMetadata(t,e){t.addFieldOffset(0,e,0)}static addGuids(t,e){t.addFieldOffset(1,e,0)}static createGuidsVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addOffset(e[s]);return t.endVector()}static startGuidsVector(t,e){t.startVector(4,e,4)}static addGuidsItems(t,e){t.addFieldOffset(2,e,0)}static createGuidsItemsVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addInt32(e[s]);return t.endVector()}static startGuidsItemsVector(t,e){t.startVector(4,e,4)}static addMaxLocalId(t,e){t.addFieldInt32(3,e,0)}static addLocalIds(t,e){t.addFieldOffset(4,e,0)}static createLocalIdsVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addInt32(e[s]);return t.endVector()}static startLocalIdsVector(t,e){t.startVector(4,e,4)}static addCategories(t,e){t.addFieldOffset(5,e,0)}static createCategoriesVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addOffset(e[s]);return t.endVector()}static startCategoriesVector(t,e){t.startVector(4,e,4)}static addMeshes(t,e){t.addFieldOffset(6,e,0)}static addAttributes(t,e){t.addFieldOffset(7,e,0)}static createAttributesVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addOffset(e[s]);return t.endVector()}static startAttributesVector(t,e){t.startVector(4,e,4)}static addRelations(t,e){t.addFieldOffset(8,e,0)}static createRelationsVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addOffset(e[s]);return t.endVector()}static startRelationsVector(t,e){t.startVector(4,e,4)}static addRelationsItems(t,e){t.addFieldOffset(9,e,0)}static createRelationsItemsVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addInt32(e[s]);return t.endVector()}static startRelationsItemsVector(t,e){t.startVector(4,e,4)}static addGuid(t,e){t.addFieldOffset(10,e,0)}static addSpatialStructure(t,e){t.addFieldOffset(11,e,0)}static endModel(t){const e=t.endObject();return t.requiredField(e,6),t.requiredField(e,8),t.requiredField(e,12),t.requiredField(e,14),t.requiredField(e,16),t.requiredField(e,24),e}static finishModelBuffer(t,e){t.finish(e,"0001")}static finishSizePrefixedModelBuffer(t,e){t.finish(e,"0001",!0)}}var gc=(t=>(t[t.ONE=0]="ONE",t[t.TWO=1]="TWO",t))(gc||{}),_c=(t=>(t[t.NONE=0]="NONE",t[t.SHELL=1]="SHELL",t[t.CIRCLE_EXTRUSION=2]="CIRCLE_EXTRUSION",t))(_c||{}),xc=(t=>(t[t.DEFAULT=0]="DEFAULT",t))(xc||{});const wc=class t{static set(e,s,i){const n=s.globalTransforms(e);t.serializeTransform(i,n)}};nt(wc,"get",(()=>{const t=new pc,e=new Ae,s=new Ae;return(i,n,r)=>{wc.parseTransform(n.localTransforms(i.localTransform(),t),e),wc.parseTransform(n.globalTransforms(i.item()),s),r.multiplyMatrices(s,e)}})()),nt(wc,"getBBox",(()=>{const t=new nc;return(e,s)=>{e.bbox(t),wc.parseBBox(t,s)}})()),nt(wc,"parseBBox",(()=>{const t=new $l;return(e,s)=>{e.min(t),s.min.set(Mc(t.x()),Mc(t.y()),Mc(t.z())),e.max(t),s.max.set(Mc(t.x()),Mc(t.y()),Mc(t.z()))}})()),nt(wc,"parseTransform",(()=>{const t=new Yt,e=new Yt,s=new Yt,i=new Yt,n=new oc,r=new $l;return(o,a)=>(o.position(n),t.set(Mc(n.x()),Mc(n.y()),Mc(n.z())),o.xDirection(r),e.set(Mc(r.x()),Mc(r.y()),Mc(r.z())),o.yDirection(r),s.set(Mc(r.x()),Mc(r.y()),Mc(r.z())),i.crossVectors(e,s),a.set(e.x,s.x,i.x,t.x,e.y,s.y,i.y,t.y,e.z,s.z,i.z,t.z,0,0,0,1),a)})()),nt(wc,"serializeTransform",(()=>{const t=new oc,e=new $l;return(s,i)=>{const n=i.position(t);n.mutate_x(s.elements[12]),n.mutate_y(s.elements[13]),n.mutate_z(s.elements[14]);const r=i.xDirection(e);r.mutate_x(s.elements[0]),r.mutate_y(s.elements[1]),r.mutate_z(s.elements[2]);const o=i.yDirection(e);o.mutate_x(s.elements[4]),o.mutate_y(s.elements[5]),o.mutate_z(s.elements[6])}})()),nt(wc,"getBBoxSize",(()=>{const t=new Yt,e=new Yt,s=new Yt,i=new Yt,n=new bi;return r=>(t.copy(r.min),e.copy(r.max),s.addVectors(t,e).multiplyScalar(.5),r.getSize(i),i.x>=i.y&&i.x>=i.z?(t.set(t.x,s.y,s.z),e.set(e.x,s.y,s.z)):i.y>=i.z?(t.set(s.x,t.y,s.z),e.set(s.x,e.y,s.z)):(t.set(s.x,s.y,t.z),e.set(s.x,s.y,e.z)),n.start=t.clone(),n.end=e.clone(),n)})());let vc=wc;function Mc(t){return Number.isNaN(t)||!Number.isFinite(t)?0:t}class Ac{constructor(t,e,s,i){nt(this,"_geometries"),nt(this,"_instance",new lc),nt(this,"_representation",new hc),nt(this,"_plane",new Qs),nt(this,"linePick",(()=>{const t=new lc,e=new Me,s=new Ae,i=new Ae;return(n,r)=>{let o,a=1/0;for(const h of this.aabbController.getItemInstanceIds(n)){this._geometries.samples(h,t),vc.get(t,this._geometries,s),i.copy(s).invert(),e.copy(r).applyMatrix4(i);const l=this.geometryController.linePick(h,e);if(!l)continue;const c=e.distanceSqToPoint(l.point);c<a&&(a=c,o=l,o.instanceId=h,o.itemId=n,o.point.applyMatrix4(s),o.snappedEdgeP1.applyMatrix4(s),o.snappedEdgeP2.applyMatrix4(s))}return o}})()),nt(this,"pickInstance",(()=>{const t=new Me,e=new ti,s=new Ae,i=new Ae,n=[];return(r,o,a,h,l,c,u)=>{vc.get(a,this._geometries,s),i.copy(s).invert(),t.copy(h).applyMatrix4(i),xl.transform(l,i,e),n.length=0,u&&u.length>0&&n.push(...this.transform(u,i));let d=this.geometryController.pick(o,a.item(),c,t,e,n);d&&n.length>0&&(d=d.filter((t=>xl.containedInIndependentPlanes(t.point,n))));const p=[];return d&&d.forEach((t=>{const e=t;e.point.applyMatrix4(s),e.normal&&e.normal.transformDirection(s),e.instanceId=r,e.itemId=a.item(),e.cameraSquaredDistance=h.origin.distanceToSquared(e.point),e.snappingClass||(e.snappingClass=c),e.snappedEdgeP1&&e.snappedEdgeP1.applyMatrix4(s),e.snappedEdgeP2&&e.snappedEdgeP2.applyMatrix4(s),p.push(e)})),p}})()),this.model=t,this.aabbController=e,this.geometryController=s,this.config=i,this._geometries=t.meshes()}getPickable(t){return t.filter((t=>(this._geometries.samples(t,this._instance),this.config.visible(this._instance.item()))))}rectangleRaycast(t,e,s){const i=this.getPickable(this.aabbController.testFrustum(t,e,s)).map((t=>(this._geometries.samples(t,this._instance),this._instance.item()))),n=new Set;for(const t of i){const e=this._geometries.meshesItems(t);if(null!==e){const t=this.model.localIds(e);if(null===t)continue;n.add(t)}}return Array.from(n)}pick(t,e,s){const i=this.aabbPick(e,s);if(0===i.length)return;const n=this.aabbPick(t,s),r=n.concat(i),o=this.aabbRaySort(t,Array.from(new Set(r)));let a=[];const h=performance.now();for(const i of o){this._geometries.samples(i,this._instance),this._geometries.representations(this._instance.representation(),this._representation);if((!this.geometryController.isMesh(this._representation.representationClass())||n.includes(i))&&(a=a.concat(this.pickInstance(i,this._representation,this._instance,t,e,void 0,s)),performance.now()-h>400))break}if(0===a.length)return;const l=this.getNearest(a);return this.addLocalIdToHit(l),l}snapPick(t,e,s,i){let n=[];const r=this.pick(t,e,i);if(!r)return this.snapPickEdges(t,e,s,i);this._geometries.samples(r.instanceId,this._instance),this._geometries.representations(this._instance.representation(),this._representation),r.normal&&(r.normal.dot(r.point.clone().sub(t.origin))>0&&r.normal.negate(),this._plane.setFromNormalAndCoplanarPoint(r.normal,r.point.clone().sub(r.normal.clone().multiplyScalar(.001))));for(const o of s)n=n.concat(this.pickInstance(r.instanceId,this._representation,this._instance,t,e,o,i));const o=this.snapPickEdges(t,e,s,i);if(o&&(n=n.concat(o)),!r.normal)return n;const a=n.filter((t=>this._plane.distanceToPoint(t.point)>=0));for(const t of a)this.addLocalIdToHit(t);return a}snapPickEdges(t,e,s,i){let n=[];if(s.includes(Lo.LINE)||s.includes(Lo.POINT)){let r=this.aabbPick(e,i);r.length>10&&(r=this.aabbRaySort(t,r,10));const o=performance.now();for(const a of r){this._geometries.samples(a,this._instance),this._geometries.representations(this._instance.representation(),this._representation);for(const r of s)r!==Lo.LINE&&r!==Lo.POINT||(n=n.concat(this.pickInstance(a,this._representation,this._instance,t,e,r,i)));if(performance.now()-o>400)break}}if(0!==n.length){for(const e of n)e.raySquaredDistance=t.distanceSqToPoint(e.point);return n}}aabbPick(t,e){const s=t instanceof Me?this.aabbController.testBeam(t,e):this.aabbController.testFrustum(t,e);return this.getPickable(s)}aabbRaySort(t,e,s){const i=new Array(e.length),n=new Yt;for(let s=0;s<e.length;s++){const r=this.aabbController.getTransformedAABB(e[s]);t.intersectBox(r,n),i[s]=n.distanceToSquared(t.origin)}const r=this.dataSort(e,i);return s&&r.length>s&&r.splice(s),r}dataSort(t,e){return Array.from(t.keys()).sort(((t,s)=>e[t]-e[s])).map((e=>t[e]))}getNearest(t){return t.reduce(((t,e)=>t.raySquaredDistance&&e.raySquaredDistance?25*t.raySquaredDistance+t.cameraSquaredDistance<25*e.raySquaredDistance+e.cameraSquaredDistance?t:e:t.cameraSquaredDistance<e.cameraSquaredDistance?t:e))}transform(t,e){return t?t.map((t=>(new Qs).copy(t).applyMatrix4(e))):[]}addLocalIdToHit(t){if(!t)return;const e=this._geometries.meshesItems(t.itemId);null!==e&&(t.localId=this.model.localIds(e))}}class Sc{}nt(Sc,"zero",Object.freeze(new Yt(0,0,0))),nt(Sc,"one",Object.freeze(new Yt(1,1,1))),nt(Sc,"up",Object.freeze(new Yt(0,0,1))),nt(Sc,"down",Object.freeze(new Yt(0,0,-1))),nt(Sc,"forward",Object.freeze(new Yt(0,1,0))),nt(Sc,"back",Object.freeze(new Yt(0,-1,0))),nt(Sc,"right",Object.freeze(new Yt(1,0,0))),nt(Sc,"left",Object.freeze(new Yt(-1,0,0))),nt(Sc,"threejsUp",Object.freeze(new Yt(0,1,0))),nt(Sc,"threejsDown",Object.freeze(new Yt(0,-1,0))),nt(Sc,"threejsForward",Object.freeze(new Yt(0,0,1))),nt(Sc,"threejsBack",Object.freeze(new Yt(0,0,-1))),nt(Sc,"threejsCameraForward",Object.freeze(new Yt(0,0,-1))),nt(Sc,"threejsCameraBack",Object.freeze(new Yt(0,0,1)));const zc=class t{static arc3Divisions(e){return t.splitArc(e,5,4)}static arc2Divisions(e){return t.splitArc(e,10,8)}static linesPick(t,e,s){this.traverseLines(t,((t,i)=>{this.linePick(t,i,e,s)}))}static arcPick(t,e,s,i){this.traverseArcs(t,((t,s,n)=>{this.linePick(t,s[0],e,i),s.forEach(((t,n)=>{n>0&&this.linePick(s[n-1],t,e,i)})),this.linePick(s[s.length-1],n,e,i)}),s)}static polyLinePick(t,e,s){this.traversePolylines(t,((t,i)=>{this.linePick(t,i,e,s)}))}static geometryLinePick(t,e,s){this.traverseSLines(t,((t,i)=>{this.linePick(t,i,e,s)}))}static screenPointToCasterPoint(t,e,s=new It){const i=e.getBoundingClientRect();return s.x=(t.x-i.left)/e.clientWidth*2-1,s.y=-(t.y-i.top)/e.clientHeight*2+1,s}static screenToCasterPoint(t,e,s,i=new Me){return this.rayCaster.setFromCamera(this.screenPointToCasterPoint(t,e),s),i.copy(this.rayCaster.ray)}static splitArc(t,e,s){const i=Math.round(t.aperture()*t.radius()*e);return Math.min(Math.max(i,s),30)}};nt(zc,"rayCaster",new class{constructor(t,e,s=0,i=1/0){this.ray=new Me(t,e),this.near=s,this.far=i,this.camera=null,this.layers=new Re,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,e){this.ray.set(t,e)}setFromCamera(t,e){e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)}setFromXRController(t){return ui.identity().extractRotation(t.matrixWorld),this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(ui),this}intersectObject(t,e=!0,s=[]){return pi(t,this,s,e),s.sort(di),s}intersectObjects(t,e=!0,s=[]){for(let i=0,n=t.length;i<n;i++)pi(t[i],this,s,e);return s.sort(di),s}}),nt(zc,"traverseLines",(()=>{const t=new Yt,e=new Yt,s=new $l,i=new tc;return(n,r)=>{const o=n.wiresLength();for(let a=0;a<o;a++)n.wires(a,i),i.p1(s),t.set(s.x(),s.y(),s.z()),i.p2(s),e.set(s.x(),s.y(),s.z()),r(t,e)}})()),nt(zc,"traverseArcs",(()=>{const t=new Yt,e=new Yt,s=[],i=new Yt,n=new Yt,r=new Kl;return(o,a,h)=>{const l=o.circleCurvesLength();for(let c=0;c<l;c++){o.circleCurves(c,r);const l=h(r);i.set(r.position().x(),r.position().y(),r.position().z()),n.set(r.xDirection().x(),r.xDirection().y(),r.xDirection().z()),t.set(r.yDirection().x(),r.yDirection().y(),r.yDirection().z()),s.length=l-2;for(let e=0;e<s.length;e++)s[e]=new Yt,s[e].copy(t),s[e].applyAxisAngle(n,r.aperture()*(e+1)/(l-1)),s[e].multiplyScalar(r.radius()),s[e].add(i);e.copy(t),e.applyAxisAngle(n,r.aperture()),e.multiplyScalar(r.radius()),e.add(i),t.multiplyScalar(r.radius()),t.add(i),a(t,s,e)}}})()),nt(zc,"traversePolylines",(()=>{const t=new Yt,e=new Yt,s=new ec;return(i,n)=>{const r=i.wireSetsLength();for(let o=0;o<r;o++){i.wireSets(o,s);for(let i=0,r=s.psLength()-1;i<r;i++)t.set(s.ps(i).x(),s.ps(i).y(),s.ps(i).z()),e.set(s.ps(i+1).x(),s.ps(i+1).y(),s.ps(i+1).z()),n(t,e)}}})()),nt(zc,"traverseSLines",(()=>{const t=new Yt,e=new Yt;return(s,i)=>{if(s){const n=s.length/3;for(let r=1;r<n;r++)e.set(s[3*r],s[3*r+1],s[3*r+2]),t.set(s[3*(r-1)],s[3*(r-1)+1],s[3*(r-1)+2]),i(t,e)}}})()),nt(zc,"linePick",(()=>{const t=new Yt,e=new Yt;return(s,i,n,r)=>{const o=n.distanceSqToSegment(s,i,t,e);r(t,e,s,i,o)}})()),nt(zc,"cylinderHit",(()=>{const t=new Yt,e=new Yt,s=new Yt,i=new Ae,n=new Ae,r=new Me,o=new Yt,a=new Yt,h=new Yt,l=[],c=(()=>{const t=new Yt(0,0,1),e=new Yt(1,0,0);return(s,i)=>{Math.abs(s.dot(t))>.9?i.crossVectors(s,e).normalize():i.crossVectors(s,t).normalize()}})(),u=(t,e,s)=>{o.copy(r.direction).normalize().multiplyScalar(t).add(r.origin),o.z>=0&&o.z<=e/s&&(a.set(o.x,o.y,0).applyMatrix4(n).normalize(),o.applyMatrix4(i),l.push({point:o.clone()}))};return(o,a,d,p)=>{const f=a.distanceTo(o);t.copy(a).sub(o).normalize(),c(t,s),e.crossVectors(t,s),i.identity().makeBasis(s,e,t),i.setPosition(o),i.scale(h.set(p,p,p)),n.copy(i).invert(),r.copy(d).applyMatrix4(n);const m=r.direction.x*r.direction.x+r.direction.y*r.direction.y,b=2*r.origin.x*r.direction.x+2*r.origin.y*r.direction.y,y=r.origin.x*r.origin.x+r.origin.y*r.origin.y-1;if(4*m*y>b*b)return[];const g=(-b+Math.sqrt(b*b-4*m*y))/(2*m),_=(-b-Math.sqrt(b*b-4*m*y))/(2*m);return l.length=0,n.transpose(),u(g,f,p),u(_,f,p),l}})()),nt(zc,"sectionHit",(()=>{const t=new Qs,e=new Yt,s=new Yt;return(i,n,r,o)=>{if(e.copy(Sc.up).applyQuaternion(n),t.setFromNormalAndCoplanarPoint(e,i),r.intersectsPlane(t)&&(r.intersectPlane(t,s),s.distanceTo(i)<=o))return{point:i.clone()}}})()),nt(zc,"screenRectToFrustum",(()=>{const t=new Qs,e=new Qs,s=new Qs,i=new Qs,n=new Qs,r=new Qs,o=new Yt,a=new Yt,h=new Yt,l=new Yt,c=new Yt,u=new Yt,d=new It,p=new It;return(f,m,b,y)=>(zc.screenPointToCasterPoint(f,b,d),zc.screenPointToCasterPoint(m,b,p),o.set(d.x,d.y,1).unproject(y),a.set(p.x,d.y,1).unproject(y),h.set(d.x,p.y,1).unproject(y),l.set(p.x,p.y,1).unproject(y),c.set(d.x,d.y,0).unproject(y),u.set(p.x,p.y,0).unproject(y),t.setFromCoplanarPoints(c,o,a),e.setFromCoplanarPoints(u,a,l),s.setFromCoplanarPoints(u,l,h),i.setFromCoplanarPoints(c,h,o),y.getWorldDirection(n.normal),n.constant=y.position.length(),r.normal=n.normal,r.constant=1/0,new ti(t,s,i,e,r,n))})());let Ic=zc;const Tc=class t{constructor(){nt(this,"tempInt",new Int32Array(1)),nt(this,"tempFloat",new Float32Array(this.tempInt.buffer)),nt(this,"buffer",new Uint8Array(this.tempInt.buffer)),nt(this,"checksum",-1)}append(e){switch(typeof e){case"number":Number.isInteger(e)&&e<t.int32MaxValue&&e>t.int32MinValue?this.tempInt[0]=e:this.tempFloat[0]=e,this.update();break;case"boolean":this.tempInt[0]=e?1:0,this.update();break;case"string":for(let t=0;t<e.length;++t)this.tempInt[0]=e.codePointAt(t),this.update();break;case"object":for(const t in e)e.hasOwnProperty(t)&&this.append(e[t])}return this}value(){return~this.checksum}reset(){return this.checksum=-1,this}update(){for(let e=0;e<4;++e){this.checksum^=this.buffer[e];for(let e=0;e<8;++e)this.checksum=1&this.checksum?this.checksum>>1^t.polynomial:this.checksum>>1}}};nt(Tc,"polynomial",2197175160),nt(Tc,"int32MaxValue",2147483647),nt(Tc,"int32MinValue",-2147483648);let Bc=Tc;const Cc=class t{constructor(t,e){nt(this,"first"),this.first={start:0,count:t,prev:null,next:null,value:e}}getBufferData(t){let e=this.first;for(;;){if(null===e||e.start<=t&&t<e.start+e.count)return e;e=e.next}}add(e,s,i){if(!t.stash.length)return{start:e,count:s,prev:null,next:null,value:i};const n=t.stash.pop();return n.start=e,n.count=s,n.value=i,n}remove(e){e&&(e.next=null,e.prev=null,t.stash.push(e))}update(t,e){const s=this.getBufferData(t);if(s.value===e)return;const i=this.add(s.start,t-s.start,s.value),n=this.add(t,1,e),r=this.add(t+1,s.count-i.count-1,s.value);if(s.prev?(s.prev.next=i,i.prev=s.prev):this.first=i,s.next&&(s.next.prev=r,r.next=s.next),this.remove(s),i.next=n,n.prev=i,n.next=r,r.prev=n,i.count||(i.prev?i.prev.next=n:this.first=n,n.prev=i.prev,this.remove(i)),r.count||(r.next&&(r.next.prev=n),n.next=r.next,this.remove(r)),n.prev&&n.prev.value===n.value){n.count=n.prev.count+n.count,n.start=n.prev.start;const t=n.prev.prev;this.remove(n.prev),n.prev=t,n.prev?n.prev.next=n:this.first=n}if(n.next&&n.next.value===n.value){n.count=n.next.count+n.count;const t=n.next.next;this.remove(n.next),n.next=t,n.next&&(n.next.prev=n)}}getMinimal(t){const e=[];let s=this.first;for(;null!==s;)t&&!t(s.value)||e.push(s),s=s.next;return e}size(t){let e=0,s=this.first;for(;null!==s;)t&&!t(s.value)||++e,s=s.next;return e}allContain(t){return null===this.first.next&&this.first.value===t}static mapRange(t,e,s){s||(s={start:0,count:0});const i=t.start+t.count===e.length;return s.start=e[t.start],s.count=i?1/0:e[t.start+t.count]-s.start,s}};nt(Cc,"stash",[]),nt(Cc,"get",(()=>{const t={start:0,count:0};return(e,s,i,n)=>{const r=e.getMinimal(i),o=new Uint32Array(r.length),a=new Uint32Array(r.length);for(let e=0;e<r.length;++e){const i=r[e];Cc.mapRange(i,s,t),o[e]=t.start,a[e]=t.count===1/0?4294967295:t.count,n&&n(e,i.value)}return{position:o,size:a}}})()),nt(Cc,"getComplementary",((t,e)=>{let s=0;for(let i=0;i<t.position.length;++i){const n=t.position[i],r=4294967295===t.size[i]?1/0:t.size[i];n>s&&e(s,n-s),s=n+r}s!==1/0&&e(s,1/0)}));let Ec=Cc;class kc{constructor(){nt(this,"textDecoder",new TextDecoder)}decode(t,e){return t=t instanceof Uint8Array&&"undefined"!=typeof SharedArrayBuffer&&t.buffer instanceof SharedArrayBuffer?new Uint8Array(t):t,this.textDecoder.decode(t,e)}}function Pc(t,e){if(Array.isArray(t))for(let s=0;s<t.length;s++)e(t[s],s);else e(t,0)}const Fc="object"==typeof performance&&performance&&"function"==typeof performance.now?performance:Date,Rc=new Set,Lc="object"==typeof process&&process?process:{},Oc=(t,e,s,i)=>{"function"==typeof Lc.emitWarning?Lc.emitWarning(t,e,s,i):console.error(`[${s}] ${e}: ${t}`)};let Vc=globalThis.AbortController,Uc=globalThis.AbortSignal;if(void 0===Vc){Uc=class{constructor(){nt(this,"onabort"),nt(this,"_onabort",[]),nt(this,"reason"),nt(this,"aborted",!1)}addEventListener(t,e){this._onabort.push(e)}},Vc=class{constructor(){nt(this,"signal",new Uc),s()}abort(t){var e,s;if(!this.signal.aborted){this.signal.reason=t,this.signal.aborted=!0;for(const e of this.signal._onabort)e(t);null==(s=(e=this.signal).onabort)||s.call(e,t)}}};let e="1"!==(null==(t=Lc.env)?void 0:t.LRU_CACHE_IGNORE_AC_WARNING);const s=()=>{e&&(e=!1,Oc("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",s))}}const Dc=t=>t&&t===Math.floor(t)&&t>0&&isFinite(t),Nc=t=>Dc(t)?t<=Math.pow(2,8)?Uint8Array:t<=Math.pow(2,16)?Uint16Array:t<=Math.pow(2,32)?Uint32Array:t<=Number.MAX_SAFE_INTEGER?Wc:null:null;class Wc extends Array{constructor(t){super(t),this.fill(0)}}const Zc=class t{constructor(s,i){if(nt(this,"heap"),nt(this,"length"),!ot(t,e))throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new i(s),this.length=0}static create(s){const i=Nc(s);if(!i)return[];ht(t,e,!0);const n=new t(s,i);return ht(t,e,!1),n}push(t){this.heap[this.length++]=t}pop(){return this.heap[--this.length]}};e=new WeakMap,at(Zc,e,!1);let qc=Zc;const Hc=class t{constructor(e){at(this,S),at(this,E),at(this,L),at(this,V),at(this,D),at(this,Z),at(this,H),at(this,G),at(this,X),at(this,Q),at(this,K),at(this,et),at(this,s,void 0),at(this,i,void 0),at(this,n,void 0),at(this,r,void 0),at(this,o,void 0),at(this,a,void 0),nt(this,"ttl"),nt(this,"ttlResolution"),nt(this,"ttlAutopurge"),nt(this,"updateAgeOnGet"),nt(this,"updateAgeOnHas"),nt(this,"allowStale"),nt(this,"noDisposeOnSet"),nt(this,"noUpdateTTL"),nt(this,"maxEntrySize"),nt(this,"sizeCalculation"),nt(this,"noDeleteOnFetchRejection"),nt(this,"noDeleteOnStaleGet"),nt(this,"allowStaleOnFetchAbort"),nt(this,"allowStaleOnFetchRejection"),nt(this,"ignoreFetchAbort"),at(this,h,void 0),at(this,l,void 0),at(this,c,void 0),at(this,u,void 0),at(this,d,void 0),at(this,p,void 0),at(this,f,void 0),at(this,m,void 0),at(this,b,void 0),at(this,y,void 0),at(this,g,void 0),at(this,_,void 0),at(this,x,void 0),at(this,w,void 0),at(this,v,void 0),at(this,M,void 0),at(this,A,void 0),at(this,I,(()=>{})),at(this,T,(()=>{})),at(this,B,(()=>{})),at(this,C,(()=>!1)),at(this,P,(t=>{})),at(this,F,((t,e,s)=>{})),at(this,R,((t,e,s,i)=>{if(s||i)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0})),nt(this,W,"LRUCache");const{max:O=0,ttl:U,ttlResolution:N=1,ttlAutopurge:q,updateAgeOnGet:j,updateAgeOnHas:Y,allowStale:J,dispose:$,disposeAfter:tt,noDisposeOnSet:st,noUpdateTTL:it,maxSize:rt=0,maxEntrySize:lt=0,sizeCalculation:ut,fetchMethod:dt,memoMethod:pt,noDeleteOnFetchRejection:ft,noDeleteOnStaleGet:mt,allowStaleOnFetchRejection:bt,allowStaleOnFetchAbort:yt,ignoreFetchAbort:gt}=e;if(0!==O&&!Dc(O))throw new TypeError("max option must be a nonnegative integer");const _t=O?Nc(O):Array;if(!_t)throw new Error("invalid max value: "+O);if(ht(this,s,O),ht(this,i,rt),this.maxEntrySize=lt||ot(this,i),this.sizeCalculation=ut,this.sizeCalculation){if(!ot(this,i)&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if("function"!=typeof this.sizeCalculation)throw new TypeError("sizeCalculation set to non-function")}if(void 0!==pt&&"function"!=typeof pt)throw new TypeError("memoMethod must be a function if defined");if(ht(this,a,pt),void 0!==dt&&"function"!=typeof dt)throw new TypeError("fetchMethod must be a function if specified");if(ht(this,o,dt),ht(this,M,!!dt),ht(this,c,new Map),ht(this,u,new Array(O).fill(void 0)),ht(this,d,new Array(O).fill(void 0)),ht(this,p,new _t(O)),ht(this,f,new _t(O)),ht(this,m,0),ht(this,b,0),ht(this,y,qc.create(O)),ht(this,h,0),ht(this,l,0),"function"==typeof $&&ht(this,n,$),"function"==typeof tt?(ht(this,r,tt),ht(this,g,[])):(ht(this,r,void 0),ht(this,g,void 0)),ht(this,v,!!ot(this,n)),ht(this,A,!!ot(this,r)),this.noDisposeOnSet=!!st,this.noUpdateTTL=!!it,this.noDeleteOnFetchRejection=!!ft,this.allowStaleOnFetchRejection=!!bt,this.allowStaleOnFetchAbort=!!yt,this.ignoreFetchAbort=!!gt,0!==this.maxEntrySize){if(0!==ot(this,i)&&!Dc(ot(this,i)))throw new TypeError("maxSize must be a positive integer if specified");if(!Dc(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");ct(this,E,k).call(this)}if(this.allowStale=!!J,this.noDeleteOnStaleGet=!!mt,this.updateAgeOnGet=!!j,this.updateAgeOnHas=!!Y,this.ttlResolution=Dc(N)||0===N?N:1,this.ttlAutopurge=!!q,this.ttl=U||0,this.ttl){if(!Dc(this.ttl))throw new TypeError("ttl must be a positive integer if specified");ct(this,S,z).call(this)}if(0===ot(this,s)&&0===this.ttl&&0===ot(this,i))throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!ot(this,s)&&!ot(this,i)){const e="LRU_CACHE_UNBOUNDED";if((t=>!Rc.has(t))(e)){Rc.add(e);Oc("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",e,t)}}}static unsafeExposeInternals(t){return{starts:ot(t,x),ttls:ot(t,w),sizes:ot(t,_),keyMap:ot(t,c),keyList:ot(t,u),valList:ot(t,d),next:ot(t,p),prev:ot(t,f),get head(){return ot(t,m)},get tail(){return ot(t,b)},free:ot(t,y),isBackgroundFetch:e=>{var s;return ct(s=t,G,Y).call(s,e)},backgroundFetch:(e,s,i,n)=>{var r;return ct(r=t,H,j).call(r,e,s,i,n)},moveToTail:e=>{var s;return ct(s=t,Q,$).call(s,e)},indexes:e=>{var s;return ct(s=t,L,O).call(s,e)},rindexes:e=>{var s;return ct(s=t,V,U).call(s,e)},isStale:e=>{var s;return ot(s=t,C).call(s,e)}}}get max(){return ot(this,s)}get maxSize(){return ot(this,i)}get calculatedSize(){return ot(this,l)}get size(){return ot(this,h)}get fetchMethod(){return ot(this,o)}get memoMethod(){return ot(this,a)}get dispose(){return ot(this,n)}get disposeAfter(){return ot(this,r)}getRemainingTTL(t){return ot(this,c).has(t)?1/0:0}*entries(){for(const t of ct(this,L,O).call(this))void 0===ot(this,d)[t]||void 0===ot(this,u)[t]||ct(this,G,Y).call(this,ot(this,d)[t])||(yield[ot(this,u)[t],ot(this,d)[t]])}*rentries(){for(const t of ct(this,V,U).call(this))void 0===ot(this,d)[t]||void 0===ot(this,u)[t]||ct(this,G,Y).call(this,ot(this,d)[t])||(yield[ot(this,u)[t],ot(this,d)[t]])}*keys(){for(const t of ct(this,L,O).call(this)){const e=ot(this,u)[t];void 0===e||ct(this,G,Y).call(this,ot(this,d)[t])||(yield e)}}*rkeys(){for(const t of ct(this,V,U).call(this)){const e=ot(this,u)[t];void 0===e||ct(this,G,Y).call(this,ot(this,d)[t])||(yield e)}}*values(){for(const t of ct(this,L,O).call(this)){void 0===ot(this,d)[t]||ct(this,G,Y).call(this,ot(this,d)[t])||(yield ot(this,d)[t])}}*rvalues(){for(const t of ct(this,V,U).call(this)){void 0===ot(this,d)[t]||ct(this,G,Y).call(this,ot(this,d)[t])||(yield ot(this,d)[t])}}[Symbol.iterator](){return this.entries()}find(t,e={}){for(const s of ct(this,L,O).call(this)){const i=ot(this,d)[s],n=ct(this,G,Y).call(this,i)?i.__staleWhileFetching:i;if(void 0!==n&&t(n,ot(this,u)[s],this))return this.get(ot(this,u)[s],e)}}forEach(t,e=this){for(const s of ct(this,L,O).call(this)){const i=ot(this,d)[s],n=ct(this,G,Y).call(this,i)?i.__staleWhileFetching:i;void 0!==n&&t.call(e,n,ot(this,u)[s],this)}}rforEach(t,e=this){for(const s of ct(this,V,U).call(this)){const i=ot(this,d)[s],n=ct(this,G,Y).call(this,i)?i.__staleWhileFetching:i;void 0!==n&&t.call(e,n,ot(this,u)[s],this)}}purgeStale(){let t=!1;for(const e of ct(this,V,U).call(this,{allowStale:!0}))ot(this,C).call(this,e)&&(ct(this,K,tt).call(this,ot(this,u)[e],"expire"),t=!0);return t}info(t){const e=ot(this,c).get(t);if(void 0===e)return;const s=ot(this,d)[e],i=ct(this,G,Y).call(this,s)?s.__staleWhileFetching:s;if(void 0===i)return;const n={value:i};if(ot(this,w)&&ot(this,x)){const t=ot(this,w)[e],s=ot(this,x)[e];if(t&&s){const e=t-(Fc.now()-s);n.ttl=e,n.start=Date.now()}}return ot(this,_)&&(n.size=ot(this,_)[e]),n}dump(){const t=[];for(const e of ct(this,L,O).call(this,{allowStale:!0})){const s=ot(this,u)[e],i=ot(this,d)[e],n=ct(this,G,Y).call(this,i)?i.__staleWhileFetching:i;if(void 0===n||void 0===s)continue;const r={value:n};if(ot(this,w)&&ot(this,x)){r.ttl=ot(this,w)[e];const t=Fc.now()-ot(this,x)[e];r.start=Math.floor(Date.now()-t)}ot(this,_)&&(r.size=ot(this,_)[e]),t.unshift([s,r])}return t}load(t){this.clear();for(const[e,s]of t){if(s.start){const t=Date.now()-s.start;s.start=Fc.now()-t}this.set(e,s.value,s)}}set(t,e,i={}){var o,a,l,m,_;if(void 0===e)return this.delete(t),this;const{ttl:x=this.ttl,start:I,noDisposeOnSet:C=this.noDisposeOnSet,sizeCalculation:E=this.sizeCalculation,status:k}=i;let{noUpdateTTL:L=this.noUpdateTTL}=i;const O=ot(this,R).call(this,t,e,i.size||0,E);if(this.maxEntrySize&&O>this.maxEntrySize)return k&&(k.set="miss",k.maxEntrySizeExceeded=!0),ct(this,K,tt).call(this,t,"set"),this;let V=0===ot(this,h)?void 0:ot(this,c).get(t);if(void 0===V)V=0===ot(this,h)?ot(this,b):0!==ot(this,y).length?ot(this,y).pop():ot(this,h)===ot(this,s)?ct(this,Z,q).call(this,!1):ot(this,h),ot(this,u)[V]=t,ot(this,d)[V]=e,ot(this,c).set(t,V),ot(this,p)[ot(this,b)]=V,ot(this,f)[V]=ot(this,b),ht(this,b,V),lt(this,h)._++,ot(this,F).call(this,V,O,k),k&&(k.set="add"),L=!1;else{ct(this,Q,$).call(this,V);const s=ot(this,d)[V];if(e!==s){if(ot(this,M)&&ct(this,G,Y).call(this,s)){s.__abortController.abort(new Error("replaced"));const{__staleWhileFetching:e}=s;void 0===e||C||(ot(this,v)&&(null==(o=ot(this,n))||o.call(this,e,t,"set")),ot(this,A)&&(null==(a=ot(this,g))||a.push([e,t,"set"])))}else C||(ot(this,v)&&(null==(l=ot(this,n))||l.call(this,s,t,"set")),ot(this,A)&&(null==(m=ot(this,g))||m.push([s,t,"set"])));if(ot(this,P).call(this,V),ot(this,F).call(this,V,O,k),ot(this,d)[V]=e,k){k.set="replace";const t=s&&ct(this,G,Y).call(this,s)?s.__staleWhileFetching:s;void 0!==t&&(k.oldValue=t)}}else k&&(k.set="update")}if(0===x||ot(this,w)||ct(this,S,z).call(this),ot(this,w)&&(L||ot(this,B).call(this,V,x,I),k&&ot(this,T).call(this,k,V)),!C&&ot(this,A)&&ot(this,g)){const t=ot(this,g);let e;for(;e=null==t?void 0:t.shift();)null==(_=ot(this,r))||_.call(this,...e)}return this}pop(){var t;try{for(;ot(this,h);){const t=ot(this,d)[ot(this,m)];if(ct(this,Z,q).call(this,!0),ct(this,G,Y).call(this,t)){if(t.__staleWhileFetching)return t.__staleWhileFetching}else if(void 0!==t)return t}}finally{if(ot(this,A)&&ot(this,g)){const e=ot(this,g);let s;for(;s=null==e?void 0:e.shift();)null==(t=ot(this,r))||t.call(this,...s)}}}has(t,e={}){const{updateAgeOnHas:s=this.updateAgeOnHas,status:i}=e,n=ot(this,c).get(t);if(void 0!==n){const t=ot(this,d)[n];if(ct(this,G,Y).call(this,t)&&void 0===t.__staleWhileFetching)return!1;if(!ot(this,C).call(this,n))return s&&ot(this,I).call(this,n),i&&(i.has="hit",ot(this,T).call(this,i,n)),!0;i&&(i.has="stale",ot(this,T).call(this,i,n))}else i&&(i.has="miss");return!1}peek(t,e={}){const{allowStale:s=this.allowStale}=e,i=ot(this,c).get(t);if(void 0===i||!s&&ot(this,C).call(this,i))return;const n=ot(this,d)[i];return ct(this,G,Y).call(this,n)?n.__staleWhileFetching:n}async fetch(t,e={}){const{allowStale:s=this.allowStale,updateAgeOnGet:i=this.updateAgeOnGet,noDeleteOnStaleGet:n=this.noDeleteOnStaleGet,ttl:r=this.ttl,noDisposeOnSet:o=this.noDisposeOnSet,size:a=0,sizeCalculation:h=this.sizeCalculation,noUpdateTTL:l=this.noUpdateTTL,noDeleteOnFetchRejection:u=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:p=this.allowStaleOnFetchRejection,ignoreFetchAbort:f=this.ignoreFetchAbort,allowStaleOnFetchAbort:m=this.allowStaleOnFetchAbort,context:b,forceRefresh:y=!1,status:g,signal:_}=e;if(!ot(this,M))return g&&(g.fetch="get"),this.get(t,{allowStale:s,updateAgeOnGet:i,noDeleteOnStaleGet:n,status:g});const x={allowStale:s,updateAgeOnGet:i,noDeleteOnStaleGet:n,ttl:r,noDisposeOnSet:o,size:a,sizeCalculation:h,noUpdateTTL:l,noDeleteOnFetchRejection:u,allowStaleOnFetchRejection:p,allowStaleOnFetchAbort:m,ignoreFetchAbort:f,status:g,signal:_};let w=ot(this,c).get(t);if(void 0===w){g&&(g.fetch="miss");const e=ct(this,H,j).call(this,t,w,x,b);return e.__returned=e}{const e=ot(this,d)[w];if(ct(this,G,Y).call(this,e)){const t=s&&void 0!==e.__staleWhileFetching;return g&&(g.fetch="inflight",t&&(g.returnedStale=!0)),t?e.__staleWhileFetching:e.__returned=e}const n=ot(this,C).call(this,w);if(!y&&!n)return g&&(g.fetch="hit"),ct(this,Q,$).call(this,w),i&&ot(this,I).call(this,w),g&&ot(this,T).call(this,g,w),e;const r=ct(this,H,j).call(this,t,w,x,b),o=void 0!==r.__staleWhileFetching&&s;return g&&(g.fetch=n?"stale":"refresh",o&&n&&(g.returnedStale=!0)),o?r.__staleWhileFetching:r.__returned=r}}async forceFetch(t,e={}){const s=await this.fetch(t,e);if(void 0===s)throw new Error("fetch() returned undefined");return s}memo(t,e={}){const s=ot(this,a);if(!s)throw new Error("no memoMethod provided to constructor");const{context:i,forceRefresh:n,...r}=e,o=this.get(t,r);if(!n&&void 0!==o)return o;const h=s(t,o,{options:r,context:i});return this.set(t,h,r),h}get(t,e={}){const{allowStale:s=this.allowStale,updateAgeOnGet:i=this.updateAgeOnGet,noDeleteOnStaleGet:n=this.noDeleteOnStaleGet,status:r}=e,o=ot(this,c).get(t);if(void 0!==o){const e=ot(this,d)[o],a=ct(this,G,Y).call(this,e);return r&&ot(this,T).call(this,r,o),ot(this,C).call(this,o)?(r&&(r.get="stale"),a?(r&&s&&void 0!==e.__staleWhileFetching&&(r.returnedStale=!0),s?e.__staleWhileFetching:void 0):(n||ct(this,K,tt).call(this,t,"expire"),r&&s&&(r.returnedStale=!0),s?e:void 0)):(r&&(r.get="hit"),a?e.__staleWhileFetching:(ct(this,Q,$).call(this,o),i&&ot(this,I).call(this,o),e))}r&&(r.get="miss")}delete(t){return ct(this,K,tt).call(this,t,"delete")}clear(){return ct(this,et,st).call(this,"delete")}};W=Symbol.toStringTag,s=new WeakMap,i=new WeakMap,n=new WeakMap,r=new WeakMap,o=new WeakMap,a=new WeakMap,h=new WeakMap,l=new WeakMap,c=new WeakMap,u=new WeakMap,d=new WeakMap,p=new WeakMap,f=new WeakMap,m=new WeakMap,b=new WeakMap,y=new WeakMap,g=new WeakMap,_=new WeakMap,x=new WeakMap,w=new WeakMap,v=new WeakMap,M=new WeakMap,A=new WeakMap,S=new WeakSet,z=function(){const t=new Wc(ot(this,s)),e=new Wc(ot(this,s));ht(this,w,t),ht(this,x,e),ht(this,B,((s,i,n=Fc.now())=>{if(e[s]=0!==i?n:0,t[s]=i,0!==i&&this.ttlAutopurge){const t=setTimeout((()=>{ot(this,C).call(this,s)&&ct(this,K,tt).call(this,ot(this,u)[s],"expire")}),i+1);t.unref&&t.unref()}})),ht(this,I,(s=>{e[s]=0!==t[s]?Fc.now():0})),ht(this,T,((s,r)=>{if(t[r]){const o=t[r],a=e[r];if(!o||!a)return;s.ttl=o,s.start=a,s.now=i||n();const h=s.now-a;s.remainingTTL=o-h}}));let i=0;const n=()=>{const t=Fc.now();if(this.ttlResolution>0){i=t;const e=setTimeout((()=>i=0),this.ttlResolution);e.unref&&e.unref()}return t};this.getRemainingTTL=s=>{const r=ot(this,c).get(s);if(void 0===r)return 0;const o=t[r],a=e[r];if(!o||!a)return 1/0;return o-((i||n())-a)},ht(this,C,(s=>{const r=e[s],o=t[s];return!!o&&!!r&&(i||n())-r>o}))},I=new WeakMap,T=new WeakMap,B=new WeakMap,C=new WeakMap,E=new WeakSet,k=function(){const t=new Wc(ot(this,s));ht(this,l,0),ht(this,_,t),ht(this,P,(e=>{ht(this,l,ot(this,l)-t[e]),t[e]=0})),ht(this,R,((t,e,s,i)=>{if(ct(this,G,Y).call(this,e))return 0;if(!Dc(s)){if(!i)throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");if("function"!=typeof i)throw new TypeError("sizeCalculation must be a function");if(s=i(e,t),!Dc(s))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}return s})),ht(this,F,((e,s,n)=>{if(t[e]=s,ot(this,i)){const s=ot(this,i)-t[e];for(;ot(this,l)>s;)ct(this,Z,q).call(this,!0)}ht(this,l,ot(this,l)+t[e]),n&&(n.entrySize=s,n.totalCalculatedSize=ot(this,l))}))},P=new WeakMap,F=new WeakMap,R=new WeakMap,L=new WeakSet,O=function*({allowStale:t=this.allowStale}={}){if(ot(this,h))for(let e=ot(this,b);ct(this,D,N).call(this,e)&&(!t&&ot(this,C).call(this,e)||(yield e),e!==ot(this,m));)e=ot(this,f)[e]},V=new WeakSet,U=function*({allowStale:t=this.allowStale}={}){if(ot(this,h))for(let e=ot(this,m);ct(this,D,N).call(this,e)&&(!t&&ot(this,C).call(this,e)||(yield e),e!==ot(this,b));)e=ot(this,p)[e]},D=new WeakSet,N=function(t){return void 0!==t&&ot(this,c).get(ot(this,u)[t])===t},Z=new WeakSet,q=function(t){var e,s;const i=ot(this,m),r=ot(this,u)[i],o=ot(this,d)[i];return ot(this,M)&&ct(this,G,Y).call(this,o)?o.__abortController.abort(new Error("evicted")):(ot(this,v)||ot(this,A))&&(ot(this,v)&&(null==(e=ot(this,n))||e.call(this,o,r,"evict")),ot(this,A)&&(null==(s=ot(this,g))||s.push([o,r,"evict"]))),ot(this,P).call(this,i),t&&(ot(this,u)[i]=void 0,ot(this,d)[i]=void 0,ot(this,y).push(i)),1===ot(this,h)?(ht(this,m,ht(this,b,0)),ot(this,y).length=0):ht(this,m,ot(this,p)[i]),ot(this,c).delete(r),lt(this,h)._--,i},H=new WeakSet,j=function(t,e,s,i){const n=void 0===e?void 0:ot(this,d)[e];if(ct(this,G,Y).call(this,n))return n;const r=new Vc,{signal:a}=s;null==a||a.addEventListener("abort",(()=>r.abort(a.reason)),{signal:r.signal});const h={signal:r.signal,options:s,context:i},l=(i,n=!1)=>{const{aborted:o}=r.signal,a=s.ignoreFetchAbort&&void 0!==i;if(s.status&&(o&&!n?(s.status.fetchAborted=!0,s.status.fetchError=r.signal.reason,a&&(s.status.fetchAbortIgnored=!0)):s.status.fetchResolved=!0),o&&!a&&!n)return u(r.signal.reason);const l=p;return ot(this,d)[e]===p&&(void 0===i?l.__staleWhileFetching?ot(this,d)[e]=l.__staleWhileFetching:ct(this,K,tt).call(this,t,"fetch"):(s.status&&(s.status.fetchUpdated=!0),this.set(t,i,h.options))),i},u=i=>{const{aborted:n}=r.signal,o=n&&s.allowStaleOnFetchAbort,a=o||s.allowStaleOnFetchRejection,h=a||s.noDeleteOnFetchRejection,l=p;if(ot(this,d)[e]===p){!h||void 0===l.__staleWhileFetching?ct(this,K,tt).call(this,t,"fetch"):o||(ot(this,d)[e]=l.__staleWhileFetching)}if(a)return s.status&&void 0!==l.__staleWhileFetching&&(s.status.returnedStale=!0),l.__staleWhileFetching;if(l.__returned===l)throw i};s.status&&(s.status.fetchDispatched=!0);const p=new Promise(((e,i)=>{var a;const c=null==(a=ot(this,o))?void 0:a.call(this,t,n,h);c&&c instanceof Promise&&c.then((t=>e(void 0===t?void 0:t)),i),r.signal.addEventListener("abort",(()=>{s.ignoreFetchAbort&&!s.allowStaleOnFetchAbort||(e(void 0),s.allowStaleOnFetchAbort&&(e=t=>l(t,!0)))}))})).then(l,(t=>(s.status&&(s.status.fetchRejected=!0,s.status.fetchError=t),u(t)))),f=Object.assign(p,{__abortController:r,__staleWhileFetching:n,__returned:void 0});return void 0===e?(this.set(t,f,{...h.options,status:void 0}),e=ot(this,c).get(t)):ot(this,d)[e]=f,f},G=new WeakSet,Y=function(t){if(!ot(this,M))return!1;const e=t;return!!e&&e instanceof Promise&&e.hasOwnProperty("__staleWhileFetching")&&e.__abortController instanceof Vc},X=new WeakSet,J=function(t,e){ot(this,f)[e]=t,ot(this,p)[t]=e},Q=new WeakSet,$=function(t){t!==ot(this,b)&&(t===ot(this,m)?ht(this,m,ot(this,p)[t]):ct(this,X,J).call(this,ot(this,f)[t],ot(this,p)[t]),ct(this,X,J).call(this,ot(this,b),t),ht(this,b,t))},K=new WeakSet,tt=function(t,e){var s,i,o,a;let l=!1;if(0!==ot(this,h)){const r=ot(this,c).get(t);if(void 0!==r)if(l=!0,1===ot(this,h))ct(this,et,st).call(this,e);else{ot(this,P).call(this,r);const o=ot(this,d)[r];if(ct(this,G,Y).call(this,o)?o.__abortController.abort(new Error("deleted")):(ot(this,v)||ot(this,A))&&(ot(this,v)&&(null==(s=ot(this,n))||s.call(this,o,t,e)),ot(this,A)&&(null==(i=ot(this,g))||i.push([o,t,e]))),ot(this,c).delete(t),ot(this,u)[r]=void 0,ot(this,d)[r]=void 0,r===ot(this,b))ht(this,b,ot(this,f)[r]);else if(r===ot(this,m))ht(this,m,ot(this,p)[r]);else{const t=ot(this,f)[r];ot(this,p)[t]=ot(this,p)[r];const e=ot(this,p)[r];ot(this,f)[e]=ot(this,f)[r]}lt(this,h)._--,ot(this,y).push(r)}}if(ot(this,A)&&(null==(o=ot(this,g))?void 0:o.length)){const t=ot(this,g);let e;for(;e=null==t?void 0:t.shift();)null==(a=ot(this,r))||a.call(this,...e)}return l},et=new WeakSet,st=function(t){var e,s,i;for(const i of ct(this,V,U).call(this,{allowStale:!0})){const r=ot(this,d)[i];if(ct(this,G,Y).call(this,r))r.__abortController.abort(new Error("deleted"));else{const o=ot(this,u)[i];ot(this,v)&&(null==(e=ot(this,n))||e.call(this,r,o,t)),ot(this,A)&&(null==(s=ot(this,g))||s.push([r,o,t]))}}if(ot(this,c).clear(),ot(this,d).fill(void 0),ot(this,u).fill(void 0),ot(this,w)&&ot(this,x)&&(ot(this,w).fill(0),ot(this,x).fill(0)),ot(this,_)&&ot(this,_).fill(0),ht(this,m,0),ht(this,b,0),ot(this,y).length=0,ht(this,l,0),ht(this,h,0),ot(this,A)&&ot(this,g)){const t=ot(this,g);let e;for(;e=null==t?void 0:t.shift();)null==(i=ot(this,r))||i.call(this,...e)}};let jc=Hc;const Gc=32767;var Yc=(t=>(t[t.NONE=0]="NONE",t[t.AABB=1]="AABB",t[t.CUSTOM=2]="CUSTOM",t))(Yc||{});const Xc=class t{constructor(t,e){nt(this,"representationClass"),nt(this,"objectType"),nt(this,"lodClass",Yc.NONE),nt(this,"meshTemplates",new Map),nt(this,"meshIds",new Set),nt(this,"crc32",new Bc),nt(this,"modelCode"),this.geometries=e,this.modelCode=this.crc32.reset().append(t).value()}static setupMeshes(t){return new jc({maxSize:Math.max(t??this.computeCapacity(),1),sizeCalculation:t=>{const e=Array.isArray(t)?t.reduce(((t,e)=>t+e.usedMemory),0):t.usedMemory;return Math.max(e,1)}})}static computeCapacity(){return Math.trunc(104857600*(navigator.deviceMemory??2))}static set capacity(e){t._capacity!==e&&(t.meshes.clear(),t.meshes=t.setupMeshes(e),t._capacity=e)}useMeshTemplate(t,e,s=Uo.GEOMETRY){this.meshTemplates.set(this.meshCode(t,s),Object.seal(e))}getMeshData(t,e=Uo.GEOMETRY){return this.getVirtualMesh(t,e)}getMeshesData(t,e=Uo.GEOMETRY){return this.getVirtualMesh(t,e)}getVirtualMesh(e,s=Uo.GEOMETRY){const i=this.meshCode(e,s);let n=t.meshes.get(i);if(!n){const t=this.meshTemplates.get(i);n=Array.isArray(t)?t.map((t=>({...t}))):{...t}}return n}meshCode(t,e){return this.crc32.reset().append(this.modelCode).append(this.representationClass).append(e).append(t).value()}computeMeshSizeAndSave(e,s,i=Uo.GEOMETRY){Pc(s,(t=>{t.usedMemory=t.positionBuffer.byteLength,t.indexBuffer&&(t.usedMemory+=t.indexBuffer.byteLength),t.normalBuffer&&(t.usedMemory+=t.normalBuffer.byteLength),Object.seal(t)}));const n=this.meshCode(e,i);t.meshes.set(n,s),this.meshIds.add(n)}dispose(){for(const e of this.meshIds)t.meshes.delete(e)}};nt(Xc,"minAngleToPick",Math.PI/36),nt(Xc,"hardFaceThreshold",Math.cos(Math.PI/10)),nt(Xc,"meshes",Xc.setupMeshes()),nt(Xc,"_capacity");let Jc=Xc;function Qc(t,e,s,i,n,r){s=s||2;var o=e&&e.length,a=o?e[0]*s:t.length,h=$c(t,0,a,s,!0,i,n);if(h&&h.next!==h.prev){var l,c,u,d,p,f,m;if(o&&(h=function(t,e,s,i,n,r){var o,a,h,l=[];for(o=0,a=e.length;o<a;o++)(h=$c(t,e[o]*i,o<a-1?e[o+1]*i:t.length,i,!1,n,r))===h.next&&(h.steiner=!0),l.push(lu(h));for(l.sort(ru),o=0;o<l.length;o++)s=Kc(s=ou(l[o],s),s.next);return s}(t,e,h,s,i,n)),t.length>80*s){l=u=t[i],c=d=t[n];for(var b=s;b<a;b+=s)(p=t[b+i])<l&&(l=p),(f=t[b+n])<c&&(c=f),p>u&&(u=p),f>d&&(d=f);m=0!==(m=Math.max(u-l,d-c))?1/m:0}tu(h,r,s,l,c,m)}}function $c(t,e,s,i,n,r,o){var a,h,l;if(n===function(t,e,s,i,n,r){for(var o=0,a=e,h=s-i;a<s;a+=i)o+=(t[h+n]-t[a+n])*(t[a+r]+t[h+r]),h=a;return o}(t,e,s,i,r,o)>0)for(a=e;a<s;a+=i)h=_u(a,t[a+r],t[a+o],h);else for(a=s-i;a>=e;a-=i)h=_u(a,t[a+r],t[a+o],h);return h&&pu(h,h.next)&&(l=h.next,xu(h),h=l),h}function Kc(t,e){if(!t)return t;e||(e=t);var s,i,n=t;do{if(s=!1,n.steiner||!pu(n,n.next)&&0!==du(n.prev,n,n.next))n=n.next;else{if(i=n.prev,xu(n),(n=e=i)===n.next)break;s=!0}}while(s||n!==e);return e}function tu(t,e,s,i,n,r,o){if(t){!o&&r&&function(t,e,s,i){var n=t;do{null===n.z&&(n.z=hu(n.x,n.y,e,s,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,function(t){var e,s,i,n,r,o,a,h,l=1;do{for(s=t,t=null,r=null,o=0;s;){for(o++,i=s,a=0,e=0;e<l&&(a++,i=i.nextZ);e++);for(h=l;a>0||h>0&&i;)0!==a&&(0===h||!i||s.z<=i.z)?(n=s,s=s.nextZ,a--):(n=i,i=i.nextZ,h--),r?r.nextZ=n:t=n,n.prevZ=r,r=n;s=i}r.nextZ=null,l*=2}while(o>1)}(n)}(t,i,n,r);for(var a,h,l=t;t.prev!==t.next;)if(a=t.prev,h=t.next,r?su(t,i,n,r):eu(t))e(a.i/s,t.i/s,h.i/s),xu(t),t=h.next,l=h.next;else if((t=h)===l){o?1===o?tu(t=iu(Kc(t),e,s),e,s,i,n,r,2):2===o&&nu(t,e,s,i,n,r):tu(Kc(t),e,s,i,n,r,1);break}}}function eu(t){var e=t.prev,s=t,i=t.next;if(du(e,s,i)>=0)return!1;for(var n=t.next.next;n!==t.prev;){if(cu(e.x,e.y,s.x,s.y,i.x,i.y,n.x,n.y)&&du(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function su(t,e,s,i){var n=t.prev,r=t,o=t.next;if(du(n,r,o)>=0)return!1;for(var a=n.x<r.x?n.x<o.x?n.x:o.x:r.x<o.x?r.x:o.x,h=n.y<r.y?n.y<o.y?n.y:o.y:r.y<o.y?r.y:o.y,l=n.x>r.x?n.x>o.x?n.x:o.x:r.x>o.x?r.x:o.x,c=n.y>r.y?n.y>o.y?n.y:o.y:r.y>o.y?r.y:o.y,u=hu(a,h,e,s,i),d=hu(l,c,e,s,i),p=t.prevZ,f=t.nextZ;p&&p.z>=u&&f&&f.z<=d;){if(p!==t.prev&&p!==t.next&&cu(n.x,n.y,r.x,r.y,o.x,o.y,p.x,p.y)&&du(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,f!==t.prev&&f!==t.next&&cu(n.x,n.y,r.x,r.y,o.x,o.y,f.x,f.y)&&du(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;p&&p.z>=u;){if(p!==t.prev&&p!==t.next&&cu(n.x,n.y,r.x,r.y,o.x,o.y,p.x,p.y)&&du(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;f&&f.z<=d;){if(f!==t.prev&&f!==t.next&&cu(n.x,n.y,r.x,r.y,o.x,o.y,f.x,f.y)&&du(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function iu(t,e,s){var i=t;do{var n=i.prev,r=i.next.next;!pu(n,r)&&fu(n,i,i.next,r)&&yu(n,r)&&yu(r,n)&&(e(n.i/s,i.i/s,r.i/s),xu(i.next),xu(i),i=t=r),i=i.next}while(i!==t);return Kc(i)}function nu(t,e,s,i,n,r){var o=t;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&uu(o,a)){var h=gu(o,a);return o=Kc(o,o.next),h=Kc(h,h.next),tu(o,e,s,i,n,r),void tu(h,e,s,i,n,r)}a=a.next}o=o.next}while(o!==t)}function ru(t,e){return t.x-e.x}function ou(t,e){var s=function(t,e){var s,i=e,n=t.x,r=t.y,o=-1/0;do{if(r<=i.y&&r>=i.next.y&&i.next.y!==i.y){var a=i.x+(r-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(a<=n&&a>o){if(o=a,a===n){if(r===i.y)return i;if(r===i.next.y)return i.next}s=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!s)return null;if(n===o)return s;var h,l=s,c=s.x,u=s.y,d=1/0;i=s;do{n>=i.x&&i.x>=c&&n!==i.x&&cu(r<u?n:o,r,c,u,r<u?o:n,r,i.x,i.y)&&(h=Math.abs(r-i.y)/(n-i.x),yu(i,t)&&(h<d||h===d&&(i.x>s.x||i.x===s.x&&au(s,i)))&&(s=i,d=h)),i=i.next}while(i!==l);return s}(t,e);if(!s)return e;var i=gu(s,t),n=Kc(s,s.next);return Kc(i,i.next),e===e.next||e===s?n:e}function au(t,e){return du(t.prev,t,e.prev)<0&&du(e.next,t,t.next)<0}function hu(t,e,s,i,n){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-s)*n)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*n)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function lu(t){var e=t,s=t;do{(e.x<s.x||e.x===s.x&&e.y<s.y)&&(s=e),e=e.next}while(e!==t);return s}function cu(t,e,s,i,n,r,o,a){return(n-o)*(e-a)-(t-o)*(r-a)>=0&&(t-o)*(i-a)-(s-o)*(e-a)>=0&&(s-o)*(r-a)-(n-o)*(i-a)>=0}function uu(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var s=t;do{if(s.i!==t.i&&s.next.i!==t.i&&s.i!==e.i&&s.next.i!==e.i&&fu(s,s.next,t,e))return!0;s=s.next}while(s!==t);return!1}(t,e)&&(yu(t,e)&&yu(e,t)&&function(t,e){var s=t,i=!1,n=(t.x+e.x)/2,r=(t.y+e.y)/2;do{s.y>r!=s.next.y>r&&s.next.y!==s.y&&n<(s.next.x-s.x)*(r-s.y)/(s.next.y-s.y)+s.x&&(i=!i),s=s.next}while(s!==t);return i}(t,e)&&(du(t.prev,t,e.prev)||du(t,e.prev,e))||pu(t,e)&&du(t.prev,t,t.next)>0&&du(e.prev,e,e.next)>0)}function du(t,e,s){return(e.y-t.y)*(s.x-e.x)-(e.x-t.x)*(s.y-e.y)}function pu(t,e){return t.x===e.x&&t.y===e.y}function fu(t,e,s,i){var n=bu(du(t,e,s)),r=bu(du(t,e,i)),o=bu(du(s,i,t)),a=bu(du(s,i,e));return n!==r&&o!==a||(!(0!==n||!mu(t,s,e))||(!(0!==r||!mu(t,i,e))||(!(0!==o||!mu(s,t,i))||!(0!==a||!mu(s,e,i)))))}function mu(t,e,s){return e.x<=Math.max(t.x,s.x)&&e.x>=Math.min(t.x,s.x)&&e.y<=Math.max(t.y,s.y)&&e.y>=Math.min(t.y,s.y)}function bu(t){return t>0?1:t<0?-1:0}function yu(t,e){return du(t.prev,t,t.next)<0?du(t,e,t.next)>=0&&du(t,t.prev,e)>=0:du(t,e,t.prev)<0||du(t,t.next,e)<0}function gu(t,e){var s=new wu(t.i,t.x,t.y),i=new wu(e.i,e.x,e.y),n=t.next,r=e.prev;return t.next=e,e.prev=t,s.next=n,n.prev=s,i.next=s,s.prev=i,r.next=i,i.prev=r,i}function _u(t,e,s,i){var n=new wu(t,e,s);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function xu(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ),t.next=t,t.prev=t}function wu(t,e,s){this.i=t,this.x=e,this.y=s,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class vu extends Jc{constructor(){super(...arguments),nt(this,"representationClass",_c.SHELL),nt(this,"objectType",Oo.MESH),nt(this,"lodClass",Yc.AABB),nt(this,"maxPointsAmount",Ro),nt(this,"tempVec1",new Yt),nt(this,"tempVec2",new Yt),nt(this,"tempVec3",new Yt),nt(this,"tempVec4",new Yt),nt(this,"newMeshTemplate",(()=>{const t=new cc,e=new uc;let s,i=0,n=0,r=0;const o=()=>{const t={objectType:Oo.MESH,indexCount:3*r,positionCount:3*(i+n),normalCount:3*(i+n)};s?Array.isArray(s)?s.push(t):s=[s,t]:s=t,r=0,i=0,n=0};return a=>{if(0===a.profilesLength())return{objectType:Oo.MESH};i=0,n=0,r=0,s=void 0;for(let s=0,h=a.profilesLength();s<h;s++){a.profiles(s,e);const h=e.indicesLength();n+=h;let l=!1;for(let e=0;e<a.holesLength();e++)a.holes(e,t),t.profileId()===s&&(i+=t.indicesLength(),r+=t.indicesLength(),l&&(r+=2),l=!0);l?r+=e.indicesLength():e.indicesLength()>2&&(r+=e.indicesLength()-2),i+n+h>this.maxPointsAmount&&o()}(r>0||i>0||n>0)&&o();const h=s;return s=void 0,h}})()),nt(this,"construct",(()=>{const t=new uc;let e,s=0;const i=[];let n,r;const o={vertices:0,indices:0,verticesAmount:0,normalsAmount:0,normals:0},a=t=>{e=Array.isArray(t)?t[s]:t,e.indexBuffer=new Uint16Array(e.indexCount),e.positionBuffer=new Float32Array(e.positionCount),e.normalBuffer=new Int16Array(e.normalCount),o.vertices=0,o.indices=0,o.verticesAmount=0,o.normalsAmount=0,o.normals=0,s++};return(h,l)=>{s=0,e=void 0,a(l),i.length=0,h instanceof dc&&(this.getNormalsOfShellProfile(h,i),n=this.getPointsShell(h));const c=this.getBuffer(h),u=this.newShellInteriorProfiles(h,i,n);for(let s=0,d=h.profilesLength();s<d;s++){h.profiles(s,t);const d=t.indicesArray();h instanceof dc&&(r=this.computeAverageNormals(d,s,i,n)),3!==t.indicesLength()||u.has(s)?4!==t.indicesLength()||u.has(s)?this.newFaceX(d,c,r,s,this.representationClass,e,u,o):this.newFace4(d,c,r,s,this.representationClass,e,o):this.newFace3(d,c,r,this.representationClass,e,o),o.verticesAmount/3+t.indicesLength()>this.maxPointsAmount&&a(l)}e=void 0}})()),nt(this,"facePick",(()=>{const t=new Qs,e=[],s=new Map,i=new Yt,n=new Yt,r=new Yt;return(o,a)=>{const h=this.getShell(o);e.length=0,s.clear();for(let t=0;t<h.holesLength();t++){const e=h.holes(t).profileId();s.has(e)?s.get(e).push(t):s.set(h.holes(t).profileId(),[t])}const l=this.getBuffer(h);for(let o=0,c=h.profilesLength();o<c;o++){const c=h.profiles(o).indicesArray();this.tempVec1.set(0,0,0),this.tempVec2.set(0,0,0),this.tempVec3.set(0,0,0),this.tempVec4.set(0,0,0);if(3===c.length){let t=c[0],s=c[1],o=c[2];t*=3,s*=3,o*=3,i.set(l[t],l[t+1],l[t+2]),n.set(l[s],l[s+1],l[s+2]),r.set(l[o],l[o+1],l[o+2]);const h=this.triangleHit(a,i,n,r);h&&e.push(h);continue}const u=3*c[0];if(this.tempVec1.set(l[u],l[u+1],l[u+2]),this.fragmentsNormal(this.tempVec4,l,c,3),t.setFromNormalAndCoplanarPoint(this.tempVec4,this.tempVec1),a.intersectPlane(t,this.tempVec2)){if(s.has(o)){const e=s.get(o);if(this.holeContains(this.tempVec2,t,e,h,l))continue}this.polygonContains(this.tempVec2,l,c,3,t)&&e.push({point:this.tempVec2.clone(),normal:t.normal.clone()})}}return e}})()),nt(this,"linePick",(()=>{const t=new uc,e=new Yt,s=new Yt,i=new Yt,n=[];let r;return(o,a,h)=>{const l=this.getShell(o);n.length=0,this.getNormalsOfShellProfile(l,n),r=this.getPointsShell(l);const c=[];for(let o=0,u=l.profilesLength();o<u;o++){l.profiles(o,t);for(let u=0,d=t.indicesLength();u<d;u++){const p=t.indices(u),f=u===d-1?t.indices(0):t.indices(u+1);if(this.point(l,p,e),this.point(l,f,s),a.distanceSqToSegment(e,s,void 0,i),h.containsPoint(i)){const t=r.get(p),a=r.get(f),h=t.filter((t=>-1!==a.indexOf(t))).filter((t=>t!==o));if(h.length&&n[h[0]].dot(n[o])>Math.cos(Jc.minAngleToPick))continue;c.push({point:i.clone(),normal:n[o],snappedEdgeP1:e.clone(),snappedEdgeP2:s.clone()})}}}return c}})()),nt(this,"pointPick",(()=>{const t=new Yt;return(e,s,i)=>{const n=this.getShell(e),r=[];for(let e=0,s=n.pointsLength();e<s;e++)this.point(n,e,t),i.containsPoint(t)&&r.push({point:t.clone()});return r}})()),nt(this,"getShell",(()=>{const t=new dc;return e=>this.geometries.shells(e,t)})()),nt(this,"newShellInteriorProfiles",(()=>{const t=new $l,e=new cc,s=new Map;let i;return(n,r,o)=>{s.clear();for(let a=0,h=n.holesLength();a<h;a++){const h=n.holes(a,e).profileId();if(s.has(h)){const t=s.get(h);t.indices.push(t.points.length/3),s.set(h,t)}else s.set(h,{indices:[0],points:[],normals:[]});const l=s.get(h);i=this.computeAverageNormals(e.indicesArray(),h,r,o);for(let s=0,r=e.indicesLength();s<r;s++)this.representationClass===_c.SHELL&&n instanceof dc&&(n.points(e.indices(s),t),l.points.push(t.x(),t.y(),t.z()),l.normals.push(i[3*s],i[3*s+1],i[3*s+2]))}return s}})()),nt(this,"getNormalsOfShellProfile",(()=>(t,e)=>{const s=t.profilesLength();for(let i=0;i<s;i++){const s=t.profiles(i);e.push(this.computeNormalsOfProfile(t,s))}return e})()),nt(this,"computeNormalsOfProfile",(()=>{const t=new Yt,e=new Yt,s=new Yt;return(i,n)=>{const r=n.indicesLength();if(i.pointsLength()<=2||r<=2)return new Yt(1,0,0);s.set(0,0,0);for(let o=0;o<r;o++){const a=(o+1)%r;this.point(i,n.indices(o),t),this.point(i,n.indices(a),e),s.x+=(t.y-e.y)*(t.z+e.z),s.y+=(t.z-e.z)*(t.x+e.x),s.z+=(t.x-e.x)*(t.y+e.y)}return s.clone().normalize()}})()),nt(this,"getPointsShell",(()=>{const t=new uc,e=new cc,s=new Map;return i=>{s.clear();const n=i.profilesLength();for(let e=0;e<n;e++){i.profiles(e,t);for(let i=0,n=t.indicesLength();i<n;i++){const n=t.indices(i);s.has(n)?s.get(n).push(e):s.set(n,[e])}}for(let t=0;t<i.holesLength();t++){const n=i.holes(t).profileId();i.holes(t,e);for(let t=0,i=e.indicesLength();t<i;t++){const i=e.indices(t);s.has(i)?s.get(i).push(n):s.set(i,[n])}}return s}})()),nt(this,"computeAverageNormals",(()=>{let t,e=new Yt;return(s,i,n,r)=>{(!t||t.length<3*s.length)&&(t=new Int16Array(3*s.length));const o=n[i];for(let i=0;i<s.length;i++){const a=r.get(s[i]);if(e.set(0,0,0),a&&a.length)if(1===a.length)e=n[a[0]].clone();else for(const t of a){const s=n[t];o.dot(s)>Jc.hardFaceThreshold&&e.add(s)}else e.set(1,0,0);e.normalize().multiplyScalar(Gc),e.toArray(t,3*i)}return t}})()),nt(this,"point",(()=>{const t=new $l;return(e,s,i)=>{e instanceof dc&&e.points(s,t),i.set(t.x(),t.y(),t.z())}})()),nt(this,"holeContains",(()=>(t,e,s,i,n)=>{for(let r=0,o=s.length;r<o;r++){const o=i.holes(s[r]).indicesArray();if(this.polygonContains(t,n,o,3,e))return!0}return!1})()),nt(this,"triangleHit",(()=>{const t=new us,e=new Yt;return(s,i,n,r)=>{if(t.a=i,t.b=n,t.c=r,s.intersectTriangle(i,n,r,!1,e))return{point:e.clone(),normal:t.getNormal(new Yt)}}})()),nt(this,"polygonContains",(()=>{const t=new Yt,e=new Yt,s=new Yt;return(i,n,r,o,a)=>{this.newOrthoNormalBasis(a.normal,e,t);const h=r.length,l=r[h-1]*o,c=s.set(n[l],n[l+1],n[l+2]).sub(i);let u=c.dot(t),d=c.dot(e),p=!1;for(let a=0;a<h;a++){const h=r[a]*o,l=s.set(n[h],n[h+1],n[h+2]).sub(i),c=l.dot(t),f=l.dot(e);f>0!=d>0&&(u-c)*-f/(d-f)+c>0&&(p=!p),u=c,d=f}return p}})()),nt(this,"newFace4",(()=>{const t=new Yt,e=new Yt,s=new Yt,i=new Yt,n=new Yt,r=new Yt,o=new Yt,a=new Yt,h=new Yt;let l=0,c=0,u=0,d=0;return(p,f,m,b,y,g,_)=>{l=p[0],c=p[1],u=p[2],d=p[3],y===_c.SHELL&&(l*=3,c*=3,u*=3,d*=3),t.set(f[l],f[l+1],f[l+2]),e.set(f[c],f[c+1],f[c+2]),s.set(f[u],f[u+1],f[u+2]),i.set(f[d],f[d+1],f[d+2]),n.copy(e),r.copy(s),o.copy(i),n.sub(t),r.sub(t),o.sub(t),a.crossVectors(n,r),h.crossVectors(r,o),a.dot(h)>0?(g.indexBuffer[_.indices]=_.vertices,g.indexBuffer[_.indices+1]=_.vertices+1,g.indexBuffer[_.indices+2]=_.vertices+3,g.indexBuffer[_.indices+3]=_.vertices+3,g.indexBuffer[_.indices+4]=_.vertices+1,g.indexBuffer[_.indices+5]=_.vertices+2,_.indices+=6,g.positionBuffer[_.verticesAmount]=t.x,g.positionBuffer[_.verticesAmount+1]=t.y,g.positionBuffer[_.verticesAmount+2]=t.z,g.positionBuffer[_.verticesAmount+3]=e.x,g.positionBuffer[_.verticesAmount+4]=e.y,g.positionBuffer[_.verticesAmount+5]=e.z,g.positionBuffer[_.verticesAmount+6]=s.x,g.positionBuffer[_.verticesAmount+7]=s.y,g.positionBuffer[_.verticesAmount+8]=s.z,g.positionBuffer[_.verticesAmount+9]=i.x,g.positionBuffer[_.verticesAmount+10]=i.y,g.positionBuffer[_.verticesAmount+11]=i.z,g.normalBuffer[_.normalsAmount]=m[0],g.normalBuffer[_.normalsAmount+1]=m[1],g.normalBuffer[_.normalsAmount+2]=m[2],g.normalBuffer[_.normalsAmount+3]=m[3],g.normalBuffer[_.normalsAmount+4]=m[4],g.normalBuffer[_.normalsAmount+5]=m[5],g.normalBuffer[_.normalsAmount+6]=m[6],g.normalBuffer[_.normalsAmount+7]=m[7],g.normalBuffer[_.normalsAmount+8]=m[8],g.normalBuffer[_.normalsAmount+9]=m[9],g.normalBuffer[_.normalsAmount+10]=m[10],g.normalBuffer[_.normalsAmount+11]=m[11],_.normalsAmount+=12,_.vertices+=4,_.verticesAmount+=12):this.newFaceX(p,f,m,b,y,g,void 0,_)}})()),nt(this,"newFace3",(()=>(t,e,s,i,n,r)=>{let o=t[0],a=t[1],h=t[2];i===_c.SHELL&&(o*=3,a*=3,h*=3),n.indexBuffer[r.indices]=r.vertices,n.indexBuffer[r.indices+1]=r.vertices+1,n.indexBuffer[r.indices+2]=r.vertices+2,r.indices+=3,n.positionBuffer[r.verticesAmount]=e[o+0],n.positionBuffer[r.verticesAmount+1]=e[o+1],n.positionBuffer[r.verticesAmount+2]=e[o+2],n.positionBuffer[r.verticesAmount+3]=e[a+0],n.positionBuffer[r.verticesAmount+4]=e[a+1],n.positionBuffer[r.verticesAmount+5]=e[a+2],n.positionBuffer[r.verticesAmount+6]=e[h+0],n.positionBuffer[r.verticesAmount+7]=e[h+1],n.positionBuffer[r.verticesAmount+8]=e[h+2],n.normalBuffer[r.normalsAmount]=s[0],n.normalBuffer[r.normalsAmount+1]=s[1],n.normalBuffer[r.normalsAmount+2]=s[2],n.normalBuffer[r.normalsAmount+3]=s[3],n.normalBuffer[r.normalsAmount+4]=s[4],n.normalBuffer[r.normalsAmount+5]=s[5],n.normalBuffer[r.normalsAmount+6]=s[6],n.normalBuffer[r.normalsAmount+7]=s[7],n.normalBuffer[r.normalsAmount+8]=s[8],r.normalsAmount+=9,r.vertices+=3,r.verticesAmount+=9})()),nt(this,"newFaceX",(()=>{const t=new Yt;return(e,s,i,n,r,o,a,h)=>{const l=e.length,c=h.verticesAmount;if(r===_c.SHELL)for(let t=0;t<l;t++){const n=3*e[t];o.positionBuffer[h.verticesAmount]=s[n],o.positionBuffer[h.verticesAmount+1]=s[n+1],o.positionBuffer[h.verticesAmount+2]=s[n+2],o.normalBuffer.set([i[3*t],i[3*t+1],i[3*t+2]],h.normalsAmount),h.vertices+=1,h.verticesAmount+=3,h.normalsAmount+=3}let u;if(this.normal(o.positionBuffer,t,(h.verticesAmount-c)/3,c),a&&a.has(n)){const t=a.get(n);u=t.indices.map((t=>t+l)),o.positionBuffer.set(t.points,h.verticesAmount),h.verticesAmount+=t.points.length,h.vertices+=t.points.length/3,o.normalBuffer.set(t.normals,h.normalsAmount),h.normalsAmount+=t.points.length}const d=new Float32Array(o.positionBuffer.buffer,4*c,h.verticesAmount-c),p=this.sizeOfProjection(d,t);Qc(d,u,3,p[0],p[1],((t,e,s)=>{o.indexBuffer[h.indices++]=t+c/3,o.indexBuffer[h.indices++]=e+c/3,o.indexBuffer[h.indices++]=s+c/3}))}})()),nt(this,"normal",((t,e,s,i=0)=>{e.set(0,0,0);let n=0;for(let r=0,o=s;r<o;r++)n=(r+1)%s,e.x+=(t[i+3*r+1]-t[i+3*n+1])*(t[i+3*r+2]+t[i+3*n+2]),e.y+=(t[i+3*r+2]-t[i+3*n+2])*(t[i+3*r]+t[i+3*n]),e.z+=(t[i+3*r]-t[i+3*n])*(t[i+3*r+1]+t[i+3*n+1]);e.normalize()})),nt(this,"fragmentsNormal",((t,e,s,i)=>{t.set(0,0,0);for(let n=0,r=s.length;n<r;n++){const o=(n+1)%r,a=s[n]*i,h=s[o]*i;t.x+=(e[a+1]-e[h+1])*(e[a+2]+e[h+2]),t.y+=(e[a+2]-e[h+2])*(e[a]+e[h]),t.z+=(e[a]-e[h])*(e[a+1]+e[h+1])}t.normalize()}))}getMeshes(t,e=!0){const s=this.getVirtualMesh(t);if((Array.isArray(s)&&!s[0].positionBuffer||!s.positionBuffer)&&e){const e=this.getShell(t);this.construct(e,s),this.computeMeshSizeAndSave(t,s)}return s}pick(t,e,s){return this.facePick(t,e)}setupTemplateMeshes(){for(let t=0,e=this.geometries.shellsLength();t<e;t++){const e=this.getShell(t);this.useMeshTemplate(t,this.newMeshTemplate(e))}}getBuffer(t){const e=t.bb.__offset(t.bb_pos,8);return new Float32Array(t.bb.bytes().buffer,t.bb.__vector(t.bb_pos+e),3*t.pointsLength())}newOrthoNormalBasis(t,e,s){if(Math.abs(t.x)>=Math.abs(t.y)){const i=1/Math.sqrt(t.x*t.x+t.z*t.z);e.set(-t.z*i,0,t.x*i),s.set(t.y*e.z,t.z*e.x-t.x*e.z,-t.y*e.x)}else{const i=1/Math.sqrt(t.y*t.y+t.z*t.z);e.set(0,t.z*i,-t.y*i),s.set(t.y*e.z-t.z*e.y,-t.x*e.z,t.x*e.y)}e.normalize(),s.normalize()}sizeOfProjection(t,e){const s=Math.abs(e.x),i=Math.abs(e.y),n=Math.abs(e.z);return n>s&&n>i?e.z>0?[0,1]:[1,0]:i>s&&i>n?e.y>0?[2,0]:[0,2]:e.x>0?[1,2]:[2,1]}}class Mu extends Jc{constructor(){super(...arguments),nt(this,"representationClass",_c.CIRCLE_EXTRUSION),nt(this,"objectType",Oo.LINE),nt(this,"lodClass",Yc.CUSTOM),nt(this,"circleExtrusion",new rc),nt(this,"axis",new sc),nt(this,"circleCurve",new Kl),nt(this,"wireSet",new ec),nt(this,"currentPoint"),nt(this,"currentIndex"),nt(this,"currentElement",0),nt(this,"arcs",[]),nt(this,"first",new Yt),nt(this,"last",new Yt),nt(this,"tempRotation",new Gt),nt(this,"arcPoints"),nt(this,"tempVector",new Yt),nt(this,"constructLodMesh",(()=>(t,e)=>{this.currentElement=0,e.positionBuffer=new Float32Array(e.positionCount);for(let s=0,i=t.axesLength();s<i;s++){const i=t.axes(s,this.axis);for(let t=0;t<i.orderLength();t++)this.constructLodWireMesh(i,t,e)}return e})()),nt(this,"getAxisPartSize",(()=>{const t={verticesLength:0,indicesLength:0};return(e,s,i)=>{const n=e.parts(s),r=e.order(s);let o=0,a=0,h=0,l=0;switch(n){case ic.WIRE:o=2*i,a=6*i,h=2;break;case ic.WIRE_SET:{e.wireSets(r,this.wireSet);const t=this.wireSet.psLength()-1;o=2*t*i,a=6*t*i,h=2*t}break;case ic.CIRCLE_CURVE:{e.circleCurves(r,this.circleCurve);const t=Ic.arc3Divisions(this.circleCurve);o=i*t,a=6*i*(t-1),h=2,l=2}}const c=h*(i-2)*3,u=l*i*6;return t.verticesLength=o,t.indicesLength=a+c+u,t}})()),nt(this,"point",(()=>(t,e,s)=>s.set(e.positionBuffer[3*t],e.positionBuffer[3*t+1],e.positionBuffer[3*t+2]))()),nt(this,"linkedVertex",(()=>{const t=new Yt,e=new Yt,s=new Yt,i=new Yt,n=new bi;let r,o,a;return(h,l,c)=>{o=1/0;for(let u=0;u<c;u++){r=0;for(let o=h;o<h+c;o++){this.point(o,l,t);const a=o-c+u;this.point(a>=h?a-c:a,l,e),this.point(a+1>=h?a+1-c:a+1,l,s),n.set(e,s),n.closestPointToPoint(t,!0,i),r+=i.distanceTo(t)}r<o&&(o=r,a=h-c+u+1)}return a}})()),nt(this,"pick",(()=>{const t=[],e=new rc,s=new sc;return(i,n)=>{t.length=0,this.geometries.circleExtrusions(i,e);for(let i=0,r=e.axesLength();i<r;i++){e.axes(i,s);const r=e.radius(i);Ic.traverseLines(s,((e,s)=>{t.push(...Ic.cylinderHit(e,s,n,r))})),Ic.traverseArcs(s,((e,s,i)=>{t.push(...Ic.cylinderHit(e,s[0],n,r)),s.forEach(((e,i)=>{i>0&&t.push(...Ic.cylinderHit(s[i-1],e,n,r))})),t.push(...Ic.cylinderHit(s[s.length-1],i,n,r))}),Ic.arc3Divisions),Ic.traversePolylines(s,((e,s)=>{t.push(...Ic.cylinderHit(e,s,n,r))}))}return t}})()),nt(this,"linePick",(()=>{const t=[],e=new rc,s=new sc;return(i,n,r)=>{t.length=0;const o=(e,s,i,n,r)=>{t.push({point:s.clone(),raySquaredDistance:r,snappedEdgeP1:i.clone(),snappedEdgeP2:n.clone()})};this.geometries.circleExtrusions(i,e);for(let t=0,i=e.axesLength();t<i;t++){e.axes(t,s);const i=e.radius(t);this.exclusiveCylinderRaycast(s,n,o,i),this.arcRaycast(s,n,Ic.arc3Divisions,o,i),this.wireSetRaycast(s,n,o,i)}return t}})()),nt(this,"linePickAndExecute",(()=>{const t=new rc,e=new sc;return(s,i,n)=>{this.geometries.circleExtrusions(s,t);for(let s=0,r=t.axesLength();s<r;s++)t.axes(s,e),Ic.linesPick(e,i,n),Ic.arcPick(e,i,Ic.arc3Divisions,n),Ic.polyLinePick(e,i,n)}})()),nt(this,"pointPick",(()=>{const t=[],e=new rc,s=new sc;return(i,n,r)=>{t.length=0,this.geometries.circleExtrusions(i,e);for(let i=0,r=e.axesLength();i<r;i++){e.axes(i,s);const r=e.radius(i),o=this.vertexLength(r);this.setPathVertices(o),Ic.traverseLines(s,((e,s)=>{this.tempVector.copy(e).sub(s).normalize(),this.tempRotation.setFromUnitVectors(Sc.up,this.tempVector),t.push(Ic.sectionHit(e,this.tempRotation,n,r)),t.push(Ic.sectionHit(s,this.tempRotation,n,r))})),Ic.traverseArcs(s,((e,s,i)=>{this.tempVector.copy(e).sub(s[0]).normalize(),this.tempRotation.setFromUnitVectors(Sc.up,this.tempVector),t.push(Ic.sectionHit(e,this.tempRotation,n,r)),this.tempVector.copy(s[s.length-1]).sub(i).normalize(),this.tempRotation.setFromUnitVectors(Sc.up,this.tempVector),t.push(Ic.sectionHit(i,this.tempRotation,n,r))}),Ic.arc3Divisions),Ic.traversePolylines(s,((e,s)=>{this.tempVector.copy(e).sub(s).normalize(),this.tempRotation.setFromUnitVectors(Sc.up,this.tempVector),t.push(Ic.sectionHit(e,this.tempRotation,n,r)),t.push(Ic.sectionHit(s,this.tempRotation,n,r))}))}return t.filter((t=>void 0!==t))}})()),nt(this,"linked",((t,e)=>t.distanceToSquared(e)<1e-8)),nt(this,"axisPartsCompatible",((t,e)=>t===ic.CIRCLE_CURVE||e===ic.CIRCLE_CURVE)),nt(this,"validSize",((t,e,s)=>t+e+s<=Ro)),nt(this,"cylinderRaycast",(()=>{const t=new Yt;return(e,s,i,n,r)=>{Ic.cylinderHit(e,s,i,r).forEach((r=>{r.point&&(i.distanceSqToSegment(e,s,void 0,t),n(void 0,t,e,s,void 0))}))}})())}getMeshes(t,e){const s=this.getMeshesData(t);return e&&s.length&&!s[0].positionBuffer&&(this.geometries.circleExtrusions(t,this.circleExtrusion),this.construct(this.circleExtrusion,s),this.computeMeshSizeAndSave(t,s)),s}getLodMesh(t,e){const s=this.getMeshData(t,Uo.WIRES);return e&&!s.positionBuffer&&(this.geometries.circleExtrusions(t,this.circleExtrusion),this.constructLodMesh(this.circleExtrusion,s),this.computeMeshSizeAndSave(t,s,Uo.WIRES)),s}setupTemplateMeshes(){for(let t=0,e=this.geometries.circleExtrusionsLength();t<e;t++)this.geometries.circleExtrusions(t,this.circleExtrusion),this.useMeshTemplate(t,this.newMeshTemplate(this.circleExtrusion),Uo.GEOMETRY),this.useMeshTemplate(t,this.newTemplateLod(this.circleExtrusion),Uo.WIRES)}construct(t,e){let s,i=0,n=0;const r={};for(let o=0,a=t.axesLength();o<a;o++){const a=t.radius(o),h=t.axes(o,this.axis),l=this.vertexLength(a);for(let t=0;t<h.orderLength();t++){const o=this.getAxisPartSize(h,t,l),c=!s;if(0===t&&(r.first=!0),t===h.orderLength()-1&&(r.last=!0),c||!this.validSize(n,o.verticesLength,l)){s=e[i++],s.positionBuffer=new Float32Array(s.positionCount),s.normalBuffer=new Int16Array(s.normalCount),s.indexBuffer=new Uint16Array(s.indexCount);const r=this.currentPoint;if(this.currentPoint=0,this.currentIndex=0,n=0,!c&&0!==t){const t=e[i-2];this.getClone(t,s,r,l),n+=l}}this.newAxisPart(h,t,s,a,l,r),n+=o.verticesLength}}}newMeshTemplate(t){const e=[];for(let s=0,i=t.axesLength();s<i;s++)this.newTemplateAxis(t,s,e);return e}constructLodWireMesh(t,e,s){const i=t.parts(e),n=t.order(e);switch(i){case ic.WIRE:const e=t.wires(n),i=e.p1(),r=e.p2();s.positionBuffer[this.currentElement]=i.x(),s.positionBuffer[this.currentElement+1]=i.y(),s.positionBuffer[this.currentElement+2]=i.z(),s.positionBuffer[this.currentElement+3]=r.x(),s.positionBuffer[this.currentElement+4]=r.y(),s.positionBuffer[this.currentElement+5]=r.z(),this.currentElement+=6;break;case ic.WIRE_SET:const o=t.wireSets(n);for(let t=1,e=o.psLength();t<e;t++)s.positionBuffer[this.currentElement]=o.ps(t-1).x(),s.positionBuffer[this.currentElement+1]=o.ps(t-1).y(),s.positionBuffer[this.currentElement+2]=o.ps(t-1).z(),s.positionBuffer[this.currentElement+3]=o.ps(t).x(),s.positionBuffer[this.currentElement+4]=o.ps(t).y(),s.positionBuffer[this.currentElement+5]=o.ps(t).z(),this.currentElement+=6;break;case ic.CIRCLE_CURVE:const a=t.circleCurves(n),h=Ic.arc3Divisions(a);this.arcs=this.newPaths(a,h);for(let t=1;t<h;t++)s.positionBuffer[this.currentElement]=this.arcs[t-1].x,s.positionBuffer[this.currentElement+1]=this.arcs[t-1].y,s.positionBuffer[this.currentElement+2]=this.arcs[t-1].z,s.positionBuffer[this.currentElement+3]=this.arcs[t].x,s.positionBuffer[this.currentElement+4]=this.arcs[t].y,s.positionBuffer[this.currentElement+5]=this.arcs[t].z,this.currentElement+=6}}newTemplateLod(t){const e={objectType:Oo.LINE,lod:Uo.WIRES,lodThickness:0,positionCount:0};for(let s=0,i=t.axesLength();s<i;s++){const i=t.axes(s,this.axis);for(let t=0;t<i.partsLength();t++)this.getAxisPartVertexSize(i,t,e);e.lodThickness=Math.max(e.lodThickness,t.radius(s))}return e}getAxisPartVertexSize(t,e,s){const i=t.parts(e),n=t.order(e);switch(i){case ic.WIRE:s.positionCount+=6;break;case ic.WIRE_SET:const e=t.wireSets(n,this.wireSet).psLength()-1;s.positionCount+=6*e;break;case ic.CIRCLE_CURVE:const i=t.circleCurves(n,this.circleCurve),r=Ic.arc3Divisions(i);s.positionCount+=6*(r-1)}}newTemplateAxis(t,e,s){const i=t.radius(e),n=t.axes(e,this.axis),r=this.vertexLength(i);let o=s[s.length-1];for(let t=0;t<n.orderLength();t++){const e=this.getAxisPartSize(n,t,r),i=!o;!i&&this.validSize(o.positionCount/3,e.verticesLength,r)||(o={objectType:Oo.MESH,indexCount:0,positionCount:0,normalCount:0},s.push(o),i||0===t||(o.positionCount+=3*r,o.normalCount+=3*r,o.indexCount+=3*(r-2))),o.positionCount+=3*e.verticesLength,o.normalCount+=3*e.verticesLength,o.indexCount+=e.indicesLength}}getClone(t,e,s,i){for(let n=3*-i;n<0;++n)e.positionBuffer[this.currentPoint]=t.positionBuffer[s+n],e.normalBuffer[this.currentPoint]=t.normalBuffer[s+n],this.currentPoint++}newAxisPart(t,e,s,i,n,r){const o=t.parts(e),a=t.order(e);switch(o){case ic.WIRE:this.newWire(t.wires(a),i,s,n,r);break;case ic.WIRE_SET:this.newWireSet(t.wireSets(a),i,s,n,r);break;case ic.CIRCLE_CURVE:this.newCircleCurve(t.circleCurves(a),i,s,n,r)}r.first=!1,r.last=!1}newWireSet(t,e,s,i,n){for(let r=1,o=t.psLength();r<o;r++)this.first.set(t.ps(r-1).x(),t.ps(r-1).y(),t.ps(r-1).z()),this.last.set(t.ps(r).x(),t.ps(r).y(),t.ps(r).z()),this.tempVector.copy(this.last).sub(this.first).normalize(),this.tempRotation.setFromUnitVectors(Sc.up,this.tempVector),this.newPath(this.first,e,this.tempRotation,s,i),1===r?this.linkStart(s,i,n,this.first,ic.WIRE_SET):this.newPathIndexData(s,i),this.newPath(this.last,e,this.tempRotation,s,i),r!==o-1||n.last?this.newPathIndexData(s,i,!0):(n.placement=this.last,n.axisClass=ic.WIRE_SET),this.linkPaths(s,i)}linkStart(t,e,s,i,n){s.first?this.newPathIndexData(t,e):this.axisPartsCompatible(s.axisClass,n)&&this.linked(s.placement,i)?this.linkPaths(t,e,!0):(this.newPathIndexData(t,e,!0,!0),this.newPathIndexData(t,e))}newStart(t,e,s,i,n){this.tempVector.copy(e).sub(t).normalize(),this.tempRotation.setFromUnitVectors(Sc.up,this.tempVector),this.newPath(t,s,this.tempRotation,i,n)}newBody(t,e,s,i,n,r){this.tempVector.copy(s).sub(t).normalize(),this.tempRotation.setFromUnitVectors(Sc.up,this.tempVector),this.newPath(e,i,this.tempRotation,n,r),this.linkPaths(n,r,!0)}newFinish(t,e,s,i,n){this.tempVector.copy(e).sub(t).normalize(),this.tempRotation.setFromUnitVectors(Sc.up,this.tempVector),this.newPath(e,s,this.tempRotation,i,n)}newCircleCurve(t,e,s,i,n){const r=Ic.arc3Divisions(t);this.arcs=this.newPaths(t,r),this.newStart(this.arcs[0],this.arcs[1],e,s,i),this.linkStart(s,i,n,this.arcs[0],ic.CIRCLE_CURVE);for(let t=0;t<r-2;t++)this.newBody(this.arcs[t],this.arcs[t+1],this.arcs[t+2],e,s,i);this.newFinish(this.arcs[r-2],this.arcs[r-1],e,s,i),n.last?this.newPathIndexData(s,i,!0):(n.placement=this.arcs[r-1],n.axisClass=ic.CIRCLE_CURVE),this.linkPaths(s,i,!0)}newPaths(t,e){const s=new Yt,i=new Yt,n=new Yt,r=new Yt,o=[],a=[];s.set(t.position().x(),t.position().y(),t.position().z()),i.set(t.xDirection().x(),t.xDirection().y(),t.xDirection().z()),n.set(t.yDirection().x(),t.yDirection().y(),t.yDirection().z());for(let r=0;r<e-2;r++)o[r]=new Yt,o[r].copy(n),o[r].applyAxisAngle(i,t.aperture()*(r+1)/(e-1)),o[r].multiplyScalar(t.radius()),o[r].add(s);return r.copy(n),r.applyAxisAngle(i,t.aperture()),r.multiplyScalar(t.radius()),r.add(s),n.multiplyScalar(t.radius()),n.add(s),a.push(n),a.push(...o),a.push(r),a}newWire(t,e,s,i,n){const r=t.p1(),o=t.p2();this.first.set(r.x(),r.y(),r.z()),this.last.set(o.x(),o.y(),o.z()),this.tempVector.copy(this.last).sub(this.first).normalize(),this.tempRotation.setFromUnitVectors(Sc.up,this.tempVector),this.newPath(this.first,e,this.tempRotation,s,i),this.linkStart(s,i,n,this.first,ic.WIRE),this.newPath(this.last,e,this.tempRotation,s,i),n.last?this.newPathIndexData(s,i,!0):(n.placement=this.last,n.axisClass=ic.WIRE),this.linkPaths(s,i)}newPath(t,e,s,i,n){this.setPathVertices(n);for(let r=0;r<n;r++)this.tempVector.copy(this.arcPoints[r]).multiplyScalar(e).applyQuaternion(s).add(t),i.positionBuffer[this.currentPoint]=this.tempVector.x,i.positionBuffer[this.currentPoint+1]=this.tempVector.y,i.positionBuffer[this.currentPoint+2]=this.tempVector.z,this.tempVector.copy(this.arcPoints[r]).applyQuaternion(s),i.normalBuffer[this.currentPoint]=this.tempVector.x*Gc,i.normalBuffer[this.currentPoint+1]=this.tempVector.y*Gc,i.normalBuffer[this.currentPoint+2]=this.tempVector.z*Gc,this.currentPoint+=3}setPathVertices(t){if(!this.arcPoints||this.arcPoints.length!==t){this.arcPoints=[];for(let e=0;e<t;e++){const s=2*Math.PI*e/t;this.arcPoints.push(new Yt(Math.sin(s),Math.cos(s),0))}}}newPathIndexData(t,e,s=!1,i=!1){for(let n=0;n<e-2;n++)t.indexBuffer[this.currentIndex++]=this.currentPoint/3-e*(i?2:1),t.indexBuffer[this.currentIndex++]=this.currentPoint/3+n+(s?2:1)-e*(i?2:1),t.indexBuffer[this.currentIndex++]=this.currentPoint/3+n+(s?1:2)-e*(i?2:1)}linkPaths(t,e,s=!1){const i=this.currentPoint/3-e,n=i;let r=i-e;s&&(r=this.linkedVertex(i,t,e));for(let s=0;s<e;s++){const o=(s+1)%e,a=r+s>=i?r+s-e:r+s,h=r+o>=i?r+o-e:r+o,l=n+s>=i+e?n+s-e:n+s,c=n+o>=i+e?n+o-e:n+o;t.indexBuffer[this.currentIndex++]=l,t.indexBuffer[this.currentIndex++]=c,t.indexBuffer[this.currentIndex++]=a,t.indexBuffer[this.currentIndex++]=a,t.indexBuffer[this.currentIndex++]=c,t.indexBuffer[this.currentIndex++]=h}}facePick(t,e){}exclusiveCylinderRaycast(t,e,s,i){Ic.traverseLines(t,((t,n)=>{this.cylinderRaycast(t,n,e,s,i)}))}arcRaycast(t,e,s,i,n){Ic.traverseArcs(t,((t,s,r)=>{this.cylinderRaycast(t,s[0],e,i,n),s.forEach(((t,r)=>{r>0&&this.cylinderRaycast(s[r-1],t,e,i,n)})),this.cylinderRaycast(s[s.length-1],r,e,i,n)}),s)}wireSetRaycast(t,e,s,i){Ic.traversePolylines(t,((t,n)=>{this.cylinderRaycast(t,n,e,s,i)}))}vertexLength(t,e=200){const s=Math.round(t*e);return Math.min(Math.max(s,6),30)}}class Au{constructor(t){nt(this,"data"),nt(this,"highlightData"),this.length=t,this.data=new Uint8Array(t),this.highlightData=new Uint16Array(t)}setup(){this.data.fill(1<<No.VISIBLE)}visible(t){return this.check(t,No.VISIBLE)}setVisible(t,e){this.apply(t,No.VISIBLE,e)}clearVisible(){for(let t=0,e=this.data.length;t<e;t++)this.setVisible(t,!0)}clearHighlight(){this.highlightData.fill(0)}setHighlight(t,e){if(e>65535)throw new Error("Material ID 16 bit overflow");this.highlightData[t]=e}getHighlight(t){return this.highlightData[t]}check(t,e){const s=1<<e;return!!(this.data[t]&s)}apply(t,e,s){const i=1<<e;this.data[t]=s?this.data[t]|i:this.data[t]&~i}}class Su{constructor(t,e){nt(this,"list",[]),nt(this,"interval"),this.modelId=t,this.messenger=e,this.interval=setInterval((()=>this.refresh()),50)}process(t){this.list.push(t),this.list.length>20&&this.refresh()}refresh(){if(0===this.list.length)return;const t={class:Do.RECOMPUTE_MESHES,modelId:this.modelId,list:this.list};this.list=[],this.messenger.fetch(t,Su.getData(t))}static getData(t){const e=[];for(const s of t.list){if(s.tileRequestClass===Vo.CREATE){const t=s;t.positions&&e.push(t.positions.buffer),t.indices&&e.push(t.indices.buffer),t.normals&&e.push(t.normals.buffer),t.itemIds&&e.push(t.itemIds.buffer)}if(s.tileRequestClass===Vo.CREATE||s.tileRequestClass===Vo.UPDATE){const t=s;t.tileData.visibilityData&&(e.push(t.tileData.visibilityData.position.buffer),e.push(t.tileData.visibilityData.size.buffer)),t.tileData.highlightData&&(e.push(t.tileData.highlightData.position.buffer),e.push(t.tileData.highlightData.size.buffer),e.push(t.tileData.highlightIds.buffer))}}return e}cleanUpRemainingTasks(){this.list=this.list.filter((t=>t.tileRequestClass!==Vo.FINISH))}dispose(){clearInterval(this.interval)}}let zu=0;const Iu=class t{constructor(e,s,i,n,r,o,a){nt(this,"geometries"),nt(this,"allInstancesUpdated",!1),nt(this,"virtualMeshes",new Map),nt(this,"meshConnection"),nt(this,"virtualCamera"),nt(this,"virtualPlanes"),nt(this,"lastCameraRotation",new Yt),nt(this,"lastCameraLocation",new Yt),nt(this,"updatedInstances",0),nt(this,"currentInstance",0),nt(this,"instancesConfig"),nt(this,"tempInstance",new lc),nt(this,"tempRepresentation",new hc),nt(this,"instanceCount"),nt(this,"instancesByDimension"),nt(this,"validator",new Bc),nt(this,"tileSize"),nt(this,"tiles",new Map),nt(this,"instanceToTileId"),nt(this,"instanceToLodTileId"),nt(this,"tilesToUpdate",new Set),nt(this,"tileCodeToClusterSize",new Map),nt(this,"tempVector",new Yt),nt(this,"tempMatrix",new Ae),nt(this,"instanceSupportsLod"),nt(this,"instanceToLod"),nt(this,"instanceToLodWidth"),nt(this,"createLod",(()=>{const t={objectType:Oo.LINE,positionCount:6,positionBuffer:new Float32Array(6)};return e=>{const s=vc.getBBoxSize(e);return s.start.toArray(t.positionBuffer,0),s.end.toArray(t.positionBuffer,3),t}})()),nt(this,"getTileCode",(()=>{const e=new Yt;return(s,i,n,r)=>{const o=this.aabbController.getTransformedAABB(s);o.getCenter(e);const a=r===Uo.GEOMETRY?this.tileSize:10*this.tileSize,h=t.getDimensionClassification(o);return this.validator.reset().append(n.objectType).append(i).append(e.x-e.x%a).append(e.y-e.y%a).append(e.z-e.z%a).append(h).append(r),this.validator.value()}})()),nt(this,"lodTileAppendInstance",(()=>{const e={objectType:Oo.LINE,positionCount:6};return(s,i)=>{const n=this.getTileCode(s,i,e,Uo.WIRES);let r=this.tiles.get(n);return r||(r=this.newTile(e.objectType,i,Uo.WIRES),this.tiles.set(n,r)),t.tileAppend(r,e,s,0),n}})()),nt(this,"dimensionInPixels",(()=>{let t,e;return(s,i)=>{let n;this.virtualCamera.orthogonalDimension?n=this.virtualCamera.orthogonalDimension:(this.virtualCamera.fov!==e&&(t=this.getWorldSizeOfPerspective(this.virtualCamera.fov,1),e=this.virtualCamera.fov),n=t*i);return s/n*this.virtualCamera.resolution}})()),nt(this,"instanceTemplate",(()=>{const t=new Ae,e=new Qt,s={};return(i,n,r)=>(vc.get(n,this.geometries,t),vc.getBBox(r,e),s.instance=i,s.material=this.materialMap[n.material()],s.transform=t,s.aabb=e,delete s.geometries,s)})()),nt(this,"pick",(()=>{const t=[];return(e,s,i,n,r,o)=>{t.length=0;const a=e.representationClass(),h=e.id(),l=this.virtualMeshes.get(a);if(void 0===l)return[];try{const e=i===Lo.POINT?l.pointPick(h,n,r):i===Lo.LINE?l.linePick(h,n,r):i===Lo.FACE?l.facePick(h,n,r):void 0===i?l.pick(h,n,r):void 0;e&&e.length&&t.push(...e),this.pickClippedGeometry(l,h,i,n,r,o,t);for(const e of t)e.representationClass=l.objectType;return t}catch(t){this.manageError(t)}}})()),this.modelId=e,this.connection=s,this.aabbController=n,this.itemsConfig=r,this.propertyController=o,this.materialMap=a,this.meshConnection=new Su(e,s),this.geometries=i.meshes(),this.instanceCount=this.geometries.samplesLength(),this.instancesConfig=new Au(this.instanceCount),this.instancesByDimension=new Int32Array(this.instanceCount),this.setupVirtualGeometries(),this.orderInstancesByDimension(),this.instanceSupportsLod=new Uint8Array(this.instanceCount),this.instanceToLod=new Uint8Array(this.instanceCount),this.instanceToLodWidth=new Float32Array(this.instanceCount);const h=new Qt,l=new Yt;for(let t=0;t<this.instanceCount;t++)this.geometries.samples(t,this.tempInstance),this.geometries.representations(this.tempInstance.representation(),this.tempRepresentation),this.instanceSupportsLod[t]=this.geometrySupportsLod(this.tempRepresentation.representationClass()),this.instanceToLod[t]=Uo.INVISIBLE,vc.getBBox(this.tempRepresentation,h),h.getSize(l),l.x>l.y&&l.set(l.y,l.x,l.z),l.y>l.z&&l.set(l.x,l.z,l.y),l.x>l.y&&l.set(l.y,l.x,l.z),this.instanceToLodWidth[t]=l.y;this.tileSize=this.computeTileSize(),this.instanceToTileId=new Array(this.instanceCount),this.instanceToLodTileId=new Array(this.instanceCount)}geometrySupportsLod(t){const e=this.virtualMeshes.get(t);return e?e.lodClass:Yc.NONE}fetchGeometry(t,e){if(e===Uo.WIRES){this.geometries.samples(t,this.tempInstance),this.geometries.representations(this.tempInstance.representation(),this.tempRepresentation);if(this.virtualMeshes.get(this.tempRepresentation.representationClass()).lodClass===Yc.AABB){const e=this.instanceTemplate(t,this.tempInstance,this.tempRepresentation);return e.geometries=this.createLod(e.aabb),e}}this.geometries.samples(t,this.tempInstance),this.geometries.representations(this.tempInstance.representation(),this.tempRepresentation);const s=this.instanceTemplate(t,this.tempInstance,this.tempRepresentation),i=this.virtualMeshes.get(this.tempRepresentation.representationClass());if(i)try{s.geometries=this.geometryData(i,this.tempRepresentation.id(),!0,e)}catch(t){this.manageError(t)}return s}updateGeometry(t){let e=this.lodLevel(t);const s=this.instanceToLod[t];if(e===Uo.WIRES&&this.itemsConfig.getHighlight(t)&&(e=Uo.INVISIBLE),e===s)return void(e!==Uo.INVISIBLE&&this.updateInstance(t,e));s!==Uo.INVISIBLE&&this.makeInstanceInvisible(t,s);const i=e!==Uo.INVISIBLE;i&&this.makeInstanceVisible(t,e),this.instancesConfig.setVisible(t,i),this.instanceToLod[t]=e}updateInstance(t,e){const s=this.instanceToLod[t],i=this.itemId(t),n=e!==s,r=this.itemsConfig.visible(i),o=this.instancesConfig.visible(t),a=this.itemsConfig.getHighlight(i),h=this.instancesConfig.getHighlight(t);(r!==o||a!==h||n)&&this.setInstanceData(t,r,a,e)}lodLevel(t){const e=this.aabbController.getTransformedAABB(t);if(!this.planesVisible(e))return Uo.INVISIBLE;const s=this.lodLevelAccordingToCamera(t,e);return s!==Uo.INVISIBLE&&this.dataVisible(t)?s:Uo.INVISIBLE}lodLevelAccordingToCamera(t,e){const s=this.virtualCamera.graphicQuality,i=this.aabbController.size(t),n=e.distanceToPoint(this.virtualCamera.cameraPosition),r=this.dimensionInPixels(i,n);if(i<2&&r<5*s)return Uo.INVISIBLE;if(i<2&&r<15*s&&this.instanceSupportsLod[t]===Yc.NONE)return Uo.INVISIBLE;if(i>=2&&r<2*s)return Uo.INVISIBLE;if(this.instanceSupportsLod[t]===Yc.NONE)return Uo.GEOMETRY;if(i<2&&r<15*s)return Uo.WIRES;if(i>=2&&r<5*s)return Uo.WIRES;const o=this.instanceToLodWidth[t];return this.dimensionInPixels(o,n)<Math.max(4*s,4)?Uo.WIRES:Uo.GEOMETRY}async setupGeometryTemplates(){for(const t of this.virtualMeshes.values())await t.setupTemplateMeshes();await this.generateTiles()}async update(t){try{if(this.updatedInstances<this.instanceCount&&this.virtualCamera)for(let e=0;e<this.instanceCount&&(performance.now()-t<10||e<50);e++)this.updateGeometry(this.instancesByDimension[this.currentInstance]),this.currentInstance++,this.currentInstance>=this.instanceCount&&(this.currentInstance=0),this.updatedInstances++;this.updatedInstances>=this.instanceCount&&!this.allInstancesUpdated&&(this.meshConnection.process({tileRequestClass:Vo.FINISH,modelId:this.modelId}),this.allInstancesUpdated=!0)}catch(t){this.manageError(t)}this.postTilesData()}makeInstanceVisible(t,e){this.updateInstance(t,e)}makeInstanceInvisible(t,e){const s=this.getTileIds(t,e);void 0!==s&&Pc(s,(e=>this.makeInvisibleFromTile(e,t)))}getTileIds(t,e){return e===Uo.GEOMETRY?this.instanceToTileId[t]:this.instanceToLodTileId[t]}setInstanceData(t,e,s,i){this.instancesConfig.setVisible(t,!0),this.instancesConfig.setHighlight(t,s);const n=s,r=0===s,o=this.getTileIds(t,i);void 0!==o&&Pc(o,(e=>{this.updateTile(e,t,n,r)}))}updateTile(e,s,i,n){const r=this.tiles.get(e),o=r.instanceToIndex.get(s);r.visibilities.update(o,n),r.materials.update(o,i),r.notVirtual?this.tilesToUpdate.add(e):(this.constructTile(r),this.loadTile(e,r),r.notVirtual=!0,t.emptyTileMemory(r))}makeInvisibleFromTile(t,e){const s=this.tiles.get(t),i=s.instanceToIndex.get(e);s.visibilities.update(i,!1),s.hovers.update(i,!1),s.selections.update(i,!1),s.materials.update(i,0),s.visibilities.allContain(!1)&&s.materials.allContain(0)&&zu>this.virtualCamera.graphicThreshold?(this.deleteGeometry(t),s.notVirtual=!1,zu-=s.usedMemory):this.tilesToUpdate.add(t)}computeTileSize(){const t=this.aabbController.modelAABB.getSize(this.tempVector);return Math.max(40,Math.ceil(Math.max(t.x,t.y,t.z)/8))}postTilesData(){for(const e of this.tilesToUpdate){const s=this.tiles.get(e),i=t.getTileState(s);this.connectGeometryData(e,s.objectType,s.materialId,i,s.lod)}this.tilesToUpdate.clear()}newTileId(t,e,s){s.positionCount/3>Ro&&console.warn(`Geometry of instance ${t} does not fit in 16-bit index (position size ${s.positionCount}), and will be truncated.`);const i=this.getTileCode(t,e,s,void 0===s.lod?Uo.GEOMETRY:s.lod),n=this.tileCodeToClusterSize.get(i)||1;let r=i+n-1;const o=this.tiles.get(r);return(o?o.positionCount:0)+s.positionCount>Ro&&(r++,this.tileCodeToClusterSize.set(i,n+1)),r}newTile(t,e,s){return{lod:s,objectType:t,materialId:e,indexCount:0,positionCount:0,normalCount:0,notVirtual:!1,aabb:new Qt,instanceCount:0,instanceToIndex:new Map,geometriesIndex:[],indexPositions:[],vertexPositions:[]}}static tileAppend(t,e,s,i){t.instanceToIndex.set(s,t.instanceCount),t.instanceCount++,t.geometriesIndex.push(i),t.indexPositions.push(t.indexCount||0),t.vertexPositions.push((t.positionCount||0)/3),e.indexCount&&(t.indexCount+=e.indexCount),e.positionCount&&(t.positionCount+=e.positionCount),e.normalCount&&(t.normalCount+=e.normalCount),void 0!==e.materialId&&(t.materialId=e.materialId)}tileAppendInstance(e,s,i){let n;return Pc(i,((i,r)=>{const o=this.newTileId(e,s,i);void 0===n?n=o:"number"==typeof n?n!==o&&(n=[n,o]):n.includes(o)||n.push(o);let a=this.tiles.get(o);a||(a=this.newTile(i.objectType,s,void 0===i.lod?Uo.GEOMETRY:i.lod),this.tiles.set(o,a)),t.tileAppend(a,i,e,r)})),n}generateTiles(){for(let t=0;t<this.instanceCount;++t){this.geometries.samples(t,this.tempInstance),this.geometries.representations(this.tempInstance.representation(),this.tempRepresentation);const e=this.materialMap[this.tempInstance.material()],s=this.virtualMeshes.get(this.tempRepresentation.representationClass());if(!s)continue;const i=this.geometryData(s,this.tempRepresentation.id(),!1,Uo.GEOMETRY);if(this.instanceToTileId[t]=this.tileAppendInstance(t,e,i),s.lodClass===Yc.AABB)this.instanceToLodTileId[t]=this.lodTileAppendInstance(t,e);else if(s.lodClass===Yc.CUSTOM){const i=this.geometryData(s,this.tempRepresentation.id(),!1,Uo.WIRES);this.instanceToLodWidth[t]=i.lodThickness,this.instanceToLodTileId[t]=this.tileAppendInstance(t,e,i)}}for(const t of this.tiles.values())t.visibilities=new Ec(t.instanceCount,!1),t.hovers=new Ec(t.instanceCount,!1),t.selections=new Ec(t.instanceCount,!1),t.materials=new Ec(t.instanceCount,0)}constructTile(e){e.positionBuffer||t.setupTileBuffers(e);const s=!e.position;for(const[t,i]of e.instanceToIndex){const n=this.fetchGeometry(t,e.lod);n&&n.geometries&&(this.tileLoadInstance(e,n,e.geometriesIndex[i]),s&&this.extendTileAABB(e,t))}}tileLoadInstance(t,e,s){const i=t.instanceToIndex.get(e.instance),n=Array.isArray(e.geometries)?e.geometries[s]:e.geometries;n.positionBuffer||console.log("hey"),t.position||(t.position=(new Yt).fromArray(n.positionBuffer).applyMatrix4(e.transform));const r=this.tempVector.copy(t.position).negate();if(this.tempMatrix.identity().setPosition(r).multiply(e.transform),this.applyTransformToPositions(this.tempMatrix,n.positionBuffer,t.positionBuffer,3*t.vertexPositions[i],n.positionBuffer.length),t.normalBuffer&&this.applyTransformToNormals(this.tempMatrix,n.normalBuffer,t.normalBuffer,3*t.vertexPositions[i],n.normalBuffer.length),t.indexBuffer){const e=t.indexPositions[i],s=t.vertexPositions[i];for(let i=0;i<n.indexCount;i++)t.indexBuffer[i+e]=n.indexBuffer[i]+s}n.objectType===Oo.MESH&&t.ids.fill(this.itemId(e.instance),t.vertexPositions[i],t.vertexPositions[i]+n.positionCount/3)}extendTileAABB(t,e){const s=this.aabbController.getTransformedAABB(e),i=this.tempVector.copy(t.position).negate();s.translate(i),t.aabb.union(s)}applyTransformToPositions(t,e,s,i=0,n){for(let r=0;r<n;r+=3)this.tempVector.fromArray(e,r),this.tempVector.applyMatrix4(t),this.tempVector.toArray(s,i+r)}applyTransformToNormals(t,e,s,i=0,n){for(let r=0;r<n;r+=3)this.tempVector.fromArray(e,r),this.tempVector.transformDirection(t),this.tempVector.multiplyScalar(Gc),this.tempVector.toArray(s,i+r)}loadTile(e,s){const i=t.getTileState(s);s.position&&this.tempMatrix.identity().setPosition(s.position),this.addTile(e,s,s.ids,s.materialId,this.tempMatrix,s.aabb,i,s.lod),zu+=s.usedMemory}static getDimensionClassification(t){const e=t.min.distanceToSquared(t.max);return e<.25?0:e<4?1:2}static setupTileBuffers(t){t.positionBuffer=new Float32Array(t.positionCount),t.usedMemory=t.positionBuffer.byteLength,t.indexCount>0&&(t.indexBuffer=new Uint16Array(t.indexCount),t.usedMemory+=t.indexBuffer.byteLength),t.normalCount>0&&(t.normalBuffer=new Int16Array(t.normalCount),t.usedMemory+=t.normalBuffer.byteLength),t.objectType===Oo.MESH&&(t.ids=new Float32Array(t.positionCount/3),t.usedMemory+=t.ids.byteLength)}static emptyTileMemory(t){delete t.indexBuffer,delete t.positionBuffer,delete t.normalBuffer,delete t.ids}setupVirtualGeometries(){this.setupVirtualGeometry(new vu(this.modelId,this.geometries)),this.setupVirtualGeometry(new Mu(this.modelId,this.geometries))}setupVirtualGeometry(t){this.virtualMeshes.set(t.representationClass,t)}orderInstancesByDimension(){for(let t=0;t<this.instanceCount;t++)this.instancesByDimension[t]=t;this.instancesByDimension.sort(((t,e)=>this.aabbController.size(e)-this.aabbController.size(t)))}planesVisible(t){return xl.isHitting(this.virtualPlanes,t)}distanceVisible(t,e){const s=this.aabbController.size(t),i=e.distanceToPoint(this.virtualCamera.cameraPosition),n=this.dimensionInPixels(s,i);return s>2?n>5:n>20}dataVisible(t){return this.geometries.samples(t,this.tempInstance),this.itemsConfig.visible(this.tempInstance.item())}setupVirtualCamera(t){this.virtualCamera=t,Jc.capacity=t.meshThreshold,this.updateAll(),this.resetCurrentInstance(),this.virtualCamera.clippingPlanes?(this.virtualPlanes=[...this.virtualCamera.cameraFrustum.planes],this.virtualPlanes.push(...this.virtualCamera.clippingPlanes)):this.virtualPlanes=this.virtualCamera.cameraFrustum.planes}resetCurrentInstance(){const t=this.virtualCamera.cameraFrustum.planes[4].normal;t.angleTo(this.lastCameraRotation)>10*zt&&(this.currentInstance=0,this.lastCameraRotation.copy(t)),this.virtualCamera.cameraPosition.distanceToSquared(this.lastCameraLocation)>400&&(this.currentInstance=0,this.lastCameraLocation.copy(this.virtualCamera.cameraPosition))}updateAll(){this.allInstancesUpdated=!1,this.updatedInstances=0,this.meshConnection.cleanUpRemainingTasks()}updateAllVirtualData(t){if(t&&this.virtualCamera)for(const e of t){const t=this.aabbController.getItemInstanceIds(e);if(t)for(const e of t)this.updateGeometry(e)}this.updateAll()}applyTransformation(t,e){for(let e=0;e<this.instanceCount&&(this.geometries.samples(e,this.tempInstance),this.tempInstance.item()!==t);e++);const s=this.geometries.localTransforms(this.tempInstance.localTransform()),i=vc.parseTransform(s,new Ae);e.multiply(i.invert()),vc.set(t,this.geometries,e);for(let e=0;e<this.instanceCount;e++)this.tempInstance.item()===t&&this.aabbController.computeTransformedAABB(e)}geometryId(t,e,s){return this.validator.reset().append(t).append(e).append(s).value()}geometryData(t,e,s,i){return t.lodClass===Yc.CUSTOM&&i===Uo.WIRES?t.getLodMesh(e,s):t.getMeshes(e,s)}instancePlacement(t){this.geometries.samples(t,this.tempInstance),this.geometries.representations(this.tempInstance.representation(),this.tempRepresentation);return this.instanceTemplate(t,this.tempInstance,this.tempRepresentation).transform}itemId(t){return this.geometries.samples(t,this.tempInstance).item()}connectGeometryData(t,e,s,i,n){this.meshConnection.process({tileRequestClass:Vo.UPDATE,modelId:this.modelId,tileId:t,objectClass:e,material:s,tileData:i,currentLod:n})}addTile(t,e,s,i,n,r,o,a,h,l=!1){const c=l&&e.positionBuffer?new Float32Array(e.positionBuffer):e.positionBuffer,u=l&&e.normalBuffer?new Int16Array(e.normalBuffer):e.normalBuffer,d=l&&e.indexBuffer?e.indexBuffer.slice():e.indexBuffer,p=l&&s?new Float32Array(s):s;this.meshConnection.process({tileRequestClass:Vo.CREATE,modelId:this.modelId,objectClass:e.objectType,tileId:t,itemId:h,tileData:o,indices:d,positions:c,normals:u,itemIds:p,material:i,matrix:n.clone(),aabb:r.clone(),currentLod:a})}deleteGeometry(t){this.meshConnection.process({tileRequestClass:Vo.DELETE,modelId:this.modelId,tileId:t})}isMesh(t){return this.virtualMeshes.has(t)&&(this.virtualMeshes.get(t).objectType===Oo.MESH||t===_c.CIRCLE_EXTRUSION)}pickClippedGeometry(t,e,s,i,n,r,o){const a=t;r.length&&a.pickSectionLine&&(s===Lo.LINE&&o.push(...a.pickSectionLine(e,i,n,r)),s===Lo.POINT&&o.push(...a.pickSectionPoint(e,n,r)))}manageError(t){console.error(t),this.connection.fetch({class:Do.THROW_ERROR,modelId:this.modelId,errorInfo:t.toString(),errorStack:t.stack})}linePick(t,e){let s;this.geometries.samples(t,this.tempInstance),this.geometries.representations(this.tempInstance.representation(),this.tempRepresentation);const i=this.virtualMeshes.get(this.tempRepresentation.representationClass());if(i instanceof Mu){let t=1/0;return i.linePickAndExecute(this.tempRepresentation.id(),e,((e,i,n,r,o)=>{s||(s={point:void 0}),o<t&&(t=o,s.point=i.clone(),s.snappedEdgeP1=n.clone(),s.snappedEdgeP2=r.clone())})),s}}getItemsThatHaveGeometry(){const t=new Set;for(let e=0;e<this.instanceCount;e++)this.geometries.samples(e,this.tempInstance),t.add(this.tempInstance.item());return Array.from(t)}dispose(){this.meshConnection.dispose();for(const t of this.virtualMeshes.values())t.dispose()}getWorldSizeOfPerspective(t,e){return Math.tan(.5*t*zt)*e}};nt(Iu,"getTileState",(()=>t=>{const e=t.indexCount?t.indexPositions:t.vertexPositions,s=t.visibilities.allContain(!1)?void 0:Ec.get(t.visibilities,e,(t=>t)),i=t.hovers.allContain(!1)?void 0:Ec.get(t.hovers,e,(t=>t)),n=t.selections.allContain(!1)?void 0:Ec.get(t.selections,e,(t=>t));let r,o;const a=t.materials.size((t=>0!==t));return a>0&&(o=new Uint16Array(a),r=Ec.get(t.materials,e,(t=>0!==t),((t,e)=>{o[t]=e}))),{visibilityData:s,hovered:i,selected:n,highlightData:r,highlightIds:o}})());let Tu=Iu;class Bu{constructor(t,e){nt(this,"materials"),this.modelId=t,this.onTransfer=e,this.materials=[]}get(t){return this.materials[t]}update(t){const e=[],s=t.meshes(),i=s.materialsLength();for(let t=0;t<i;t++){const i=s.materials(t),n={color:new bs(i.r()/255,i.g()/255,i.b()/255),side:i.renderedFaces(),lineType:i.stroke(),opacity:i.a()/255,transparent:i.a()<255};e.push(n)}return this.transfer(e)}transfer(t){const e=[],s=[];t:for(const i of t){for(let t=0,s=this.materials.length;t<s;t++)if(this.isSameMaterial(i,this.materials[t])){e.push(t);continue t}this.materials.push(i),s.push(i),e.push(this.materials.length-1)}return this.onTransfer({class:Do.CREATE_MATERIAL,modelId:this.modelId,materialDefinitions:s}),e}isSameMaterial(t,e){return(t.color===e.color||t.color&&e.color&&t.color.r===e.color.r&&t.color.g===e.color.g&&t.color.b===e.color.b)&&this.isSame(t.opacity,e.opacity,1)&&this.isSame(t.side,e.side,gc.ONE)&&this.isSame(t.lineType,e.lineType,xc.DEFAULT)&&t.lineWidth===e.lineWidth}isSame(t,e,s){return t===e||void 0===t&&e===s||t===s&&void 0===e}}class Cu{constructor(t,e){nt(this,"localIdsToGeometryIds"),this.model=t,this.aabbController=e,this.localIdsToGeometryIds=new Map;const s=this.model.meshes(),i=s.meshesItemsLength();for(let t=0;t<i;t++){const e=s.meshesItems(t),i=this.model.localIds(e);null!==i&&(this.localIdsToGeometryIds.has(i)||this.localIdsToGeometryIds.set(i,[]),this.localIdsToGeometryIds.get(i).push(t))}}getItemIdsFromLocalIds(t){if(!t)return Array.from(this.model.meshes().meshesItemsArray());const e=[];for(const s of t){const t=this.localIdsToGeometryIds.get(s);if(t)for(const s of t)e.push(s)}return e}getAABB(t,e){t.forEach((t=>{const s=this.aabbController.getItemInstanceIds(t);s&&s.forEach((t=>{e.union(this.aabbController.getTransformedAABB(t))}))}))}getItemsLength(){return this.model.localIdsLength()}getTreeItem(t){const e={category:t.category(),localId:t.localId()},s=[];for(let e=0;e<t.childrenLength();e++){const i=t.children(e);i&&s.push(this.getTreeItem(i))}return s.length>0&&(e.children=s),e}getSpatialStructure(){const t=this.model.spatialStructure(new bc);if(!t)return{};return this.getTreeItem(t)}getItemCategory(t){var e;const s="number"==typeof t?t:this.getLocalIdByGuid(t);if(null===s)return null;const i=null==(e=this.model.localIdsArray())?void 0:e.indexOf(s);if(void 0===i||-1===i)return null;return this.model.categories(i)}getItemGuid(t){var e,s;const i=null==(e=this.model.localIdsArray())?void 0:e.indexOf(t);if(void 0===i||-1===i)return null;const n=null==(s=this.model.guidsItemsArray())?void 0:s.indexOf(i);if(void 0===n||-1===n)return null;const r=this.model.guids(n);return r||null}getLocalIdByGuid(t){let e=-1;for(let s=0;s<this.model.guidsLength();s++){const i=this.model.guids(s);if(i&&i===t){e=s;break}}if(-1===e)return null;const s=this.model.guidsItems(e);return null===s?null:this.model.localIds(s)}getItemAttributes(t){var e;const s="number"==typeof t?t:this.getLocalIdByGuid(t);if(null===s)return null;const i=null==(e=this.model.localIdsArray())?void 0:e.indexOf(s);if(void 0===i||-1===i)return null;const n=this.model.attributes(i);if(!n)return null;const r={};for(let t=0;t<n.dataLength();t++){const e=n.data(t);if(!e)continue;const[s,i,o]=JSON.parse(e);r[s]={value:i,type:o}}return r}getItemRelations(t){var e;const s="number"==typeof t?t:this.getLocalIdByGuid(t);if(null===s)return null;const i=null==(e=this.model.relationsItemsArray())?void 0:e.indexOf(s);if(void 0===i||-1===i)return null;const n=this.model.relations(i);if(!n)return null;const r={};for(let t=0;t<n.dataLength();t++){const e=n.data(t);if(!e)continue;const[s,...i]=JSON.parse(e);r[s]=i}return r}getMaxLocalId(){return this.model.maxLocalId()}getCategories(){const t=new Set;for(let e=0;e<this.model.categoriesLength();e++){const s=this.model.categories(e);s&&t.add(s)}return[...t]}getItemsOfCategory(t){let e=[],s=null,i=0;for(let e=0;e<this.model.categoriesLength();e++){const n=this.model.categories(e);if(n===t){if(null!==s&&n!==t)break;null===s&&(s=e),i++}}if(null===s)return e;const n=this.model.localIdsArray();return n?(e=[...n].slice(s,s+i),e):e}getItemsWithGeometry(){const t=this.model.meshes(new fc),e=[];if(!t)return e;const s=t.meshesItemsArray();if(!s)return e;for(const t of s){const s=this.model.localIds(t);null!==s&&e.push(s)}return e}getMetadata(){const t=this.model.metadata();return t?JSON.parse(t):null}}class Eu{constructor(t=new Float64Array(6),e=0){nt(this,"aabb"),nt(this,"offset"),this.aabb=t,this.offset=e}get minX(){return this.aabb[this.offset]}get maxX(){return this.aabb[this.offset+1]}get minY(){return this.aabb[this.offset+2]}get maxY(){return this.aabb[this.offset+3]}get minZ(){return this.aabb[this.offset+4]}get maxZ(){return this.aabb[this.offset+5]}copy(t){this.aabb[this.offset]=t.minX,this.aabb[this.offset+1]=t.maxX,this.aabb[this.offset+2]=t.minY,this.aabb[this.offset+3]=t.maxY,this.aabb[this.offset+4]=t.minZ,this.aabb[this.offset+5]=t.maxZ}merge(t,e){this.aabb[this.offset]=Math.min(t.minX,e.minX),this.aabb[this.offset+1]=Math.max(t.maxX,e.maxX),this.aabb[this.offset+2]=Math.min(t.minY,e.minY),this.aabb[this.offset+3]=Math.max(t.maxY,e.maxY),this.aabb[this.offset+4]=Math.min(t.minZ,e.minZ),this.aabb[this.offset+5]=Math.max(t.maxZ,e.maxZ)}}class ku{constructor(t,e){nt(this,"_aabb"),nt(this,"_dataOrSize"),this._aabb=new Eu(t,e)}isLeaf(){return this._dataOrSize>=0}getAABB(){return this._aabb}getBranchSize(){return-this._dataOrSize}getLeafData(){return this._dataOrSize}makeBranch(t,e){this._dataOrSize=-t,this._aabb.copy(e)}makeLeaf(t,e){this._dataOrSize=t,this._aabb.copy(e)}setData(t){this._dataOrSize=t}overlaps(t){return!(this._aabb.minX>t.maxX||this._aabb.maxX<t.minX||this._aabb.minY>t.maxY||this._aabb.maxY<t.minY||this._aabb.minZ>t.maxZ||this._aabb.maxZ<t.minZ)}}class Pu{constructor(t){if(nt(this,"_nodes",[]),nt(this,"_primaryLimits",[]),nt(this,"_secondaryLimits",[]),nt(this,"_aabbController"),nt(this,"divideX",(()=>{const t=new Yt;return(e,s,i,n)=>{let r=s;for(let o=s;o<i;o++){this._aabbController.getTransformedAABB(e[o]).getCenter(t).x>n&&(this.exchange(e,o,r),r++)}return r}})()),nt(this,"divideY",(()=>{const t=new Yt;return(e,s,i,n)=>{let r=s;for(let o=s;o<i;o++){this._aabbController.getTransformedAABB(e[o]).getCenter(t).y>n&&(this.exchange(e,o,r),r++)}return r}})()),nt(this,"divideZ",(()=>{const t=new Yt;return(e,s,i,n)=>{let r=s;for(let o=s;o<i;o++){this._aabbController.getTransformedAABB(e[o]).getCenter(t).z>n&&(this.exchange(e,o,r),r++)}return r}})()),nt(this,"computeAveragePosition",(()=>{const t=new Yt;return(e,s,i,n)=>{let r=this._aabbController.getTransformedAABB(e[s]);r.getCenter(n);for(let o=s+1;o<i;o++)r=this._aabbController.getTransformedAABB(e[o]),n.add(r.getCenter(t));const o=i-s;return n.divideScalar(o)}})()),nt(this,"quantize",(()=>{const t=new Yt,e=new Yt;return(s,i)=>{t.subVectors(s.min,this._aabbController.modelAABB.min),e.subVectors(s.max,this._aabbController.modelAABB.min),i.aabb[i.offset]=t.x,i.aabb[i.offset+1]=e.x,i.aabb[i.offset+2]=t.y,i.aabb[i.offset+3]=e.y,i.aabb[i.offset+4]=t.z,i.aabb[i.offset+5]=e.z}})()),nt(this,"constructHierarchy",(()=>(t,e,s,i,n,r)=>{if(n-i==1){const t=this._aabbController.getTransformedAABB(s[i]);return this.quantize(t,r),this.createLeaf(e,r,s[i]),1}if(n-i==2){const t=this._nodes[e+1].getAABB();let n=this._aabbController.getTransformedAABB(s[i]);this.quantize(n,t),this.setAsDataNode(e+1,s[i]);const o=this._nodes[e+2].getAABB();return n=this._aabbController.getTransformedAABB(s[i+1]),this.quantize(n,o),this.setAsDataNode(e+2,s[i+1]),r.merge(t,o),this.createBranch(e,r,3),3}const o=this.divideOnAxis(s,i,n),a=this.constructHierarchy(t+1,e+1,s,i,o,this._primaryLimits[t]),h=this.constructHierarchy(t+1,e+a+1,s,o,n,this._secondaryLimits[t]);r.merge(this._primaryLimits[t],this._secondaryLimits[t]);const l=a+h+1;return this.createBranch(e,r,l),l})()),nt(this,"divideOnAxis",(()=>{const t=new Yt,e=new Yt,s=new Yt;return(i,n,r)=>{this.computeAveragePosition(i,n,r,s),t.set(0,0,0);for(let o=n;o<r;o++){this._aabbController.getTransformedAABB(i[o]).getCenter(e).sub(s);const n=e.multiply(e);t.add(n)}let o;o=t.x>t.y?t.x>t.z?this.divideX(i,n,r,s.x):this.divideZ(i,n,r,s.z):t.y>t.z?this.divideY(i,n,r,s.y):this.divideZ(i,n,r,s.z);const a=(r-n)/3;return(o<=n+a||o>=r-1-a)&&(o=(n+r)/2),Math.round(o)}})()),this._aabbController=t,0===this._aabbController.count)return;const e=new Uint32Array(this._aabbController.count);for(let t=0;t<e.length;t++)e[t]=t;const s=2*e.length-1,i=new Float64Array(6*s);for(let t=0;t<s;t++)this._nodes.push(new ku(i,6*t));const n=new Eu;for(let t=0;t<32;t++)this._primaryLimits.push(new Eu),this._secondaryLimits.push(new Eu);this.constructHierarchy(0,0,e,0,e.length,n)}testBeam(t,e){const s=e&&e.length>0?t=>xl.isHitting(e,t):()=>!0;return this.test((e=>t.intersectsBox(e)),(()=>!1),s)}testFrustum(t,e,s){const i=[...t.planes];e&&i.push(...e);return this.test((t=>xl.isHitting(i,t)),(t=>xl.isIncluded(i,t)),(()=>!0),s)}test(t,e,s,i=!1){const n=[];let r=0;const o=this._nodes.length;for(;r<o;){const o=this.getBounds(r),a=this.isLeaf(r),h=e(o),l=h||t(o);if(a&&l&&s(o)&&(i?h&&n.push(this.getLeafData(r)):n.push(this.getLeafData(r))),l||a){if(r++,h&&!a){const t=r+this.getBranchSize(r);for(;r<t;r++)this.isLeaf(r)&&s(o)&&(i?h&&n.push(this.getLeafData(r)):n.push(this.getLeafData(r)))}}else r+=this.getBranchSize(r)}return n}exchange(t,e,s){const i=t[e];t[e]=t[s],t[s]=i}isLeaf(t){return this._nodes[t].isLeaf()}getBounds(t){const e=this._nodes[t].getAABB();return this.reverseQuantize(e)}createLeaf(t,e,s){this._nodes[t].makeLeaf(s,e)}setAsDataNode(t,e){this._nodes[t].setData(e)}createBranch(t,e,s){this._nodes[t].makeBranch(s,e)}getLeafData(t){return this._nodes[t].getLeafData()}getBranchSize(t){return this._nodes[t].getBranchSize()}reverseQuantize(t){const e=this._aabbController.modelAABB,s=new Yt(t.minX+e.min.x,t.minY+e.min.y,t.minZ+e.min.z),i=new Yt(t.maxX+e.min.x,t.maxY+e.min.y,t.maxZ+e.min.z);return new Qt(s,i)}}class Fu{constructor(t){nt(this,"modelAABB",new Qt),nt(this,"_lookup"),nt(this,"_geometries"),nt(this,"_transformedAABBs"),nt(this,"_instanceDimensions"),nt(this,"_box",new Qt),nt(this,"_instance",new lc),nt(this,"_representation",new hc),nt(this,"_vector",new Yt),nt(this,"_transform",new Ae),nt(this,"_itemToInstance"),this._geometries=t.meshes(),this._transformedAABBs=new Float64Array(6*this._geometries.samplesLength()),this._instanceDimensions=new Float32Array(this._geometries.samplesLength()),this.computeAABBs(),this.evaluateInstances(),this._lookup=new Pu(this)}get count(){return this._transformedAABBs.length/6}getItemInstanceIds(t){return this._itemToInstance[t]}computeTransformedAABB(t){if(this._lookup)throw new Error("Unable to recalculate bounding box when tree has already been built");this._geometries.samples(t,this._instance),this._geometries.representations(this._instance.representation(),this._representation),vc.get(this._instance,this._geometries,this._transform),vc.getBBox(this._representation,this._box),this._box.applyMatrix4(this._transform),this.modelAABB.union(this._box),this.setTransformedAABB(t,this._box)}getTransformedAABB(t){return this._box.min.fromArray(this._transformedAABBs,6*t),this._box.max.fromArray(this._transformedAABBs,6*t+3),this._box}size(t){return this._instanceDimensions[t]}testBeam(t,e){return this._lookup.testBeam(t,e)}testFrustum(t,e,s=!1){return this._lookup.testFrustum(t,e,s)}setTransformedAABB(t,e){e.min.toArray(this._transformedAABBs,6*t),e.max.toArray(this._transformedAABBs,6*t+3)}evaluateInstances(){this._itemToInstance=new Array(this._geometries.globalTransformsLength());const t=this._geometries.samplesLength(),e=new lc,s=new hc;for(let i=0;i<t;i++){this._geometries.samples(i,e),this._geometries.representations(e.representation(),s);const t=e.item();let n=this._itemToInstance[t];n||(n=[],this._itemToInstance[t]=n),n.push(i)}}computeAABBs(){for(let t=0;t<this._geometries.samplesLength();t++){this._geometries.samples(t,this._instance),this._geometries.representations(this._instance.representation(),this._representation),vc.getBBox(this._representation,this._box);const e=this._box.getSize(this._vector);this._instanceDimensions[t]=e.length(),this.computeTransformedAABB(t)}}}class Ru{constructor(t,e,s){nt(this,"_sectionGenerator",new Jl),nt(this,"_model"),nt(this,"_virtualMeshes"),nt(this,"_materials"),nt(this,"_aabbs"),nt(this,"_raycast"),nt(this,"_itemConfig"),nt(this,"_properties"),nt(this,"_camera"),this.modelId=t,this.connection=s;const i=new Yo(new Uint8Array(e));this.updateDecoding(i),this._model=yc.getRootAsModel(i),this._aabbs=new Fu(this._model),this._materials=new Bu(t,((t,e)=>s.fetch(t,e)));const n=this._model.localIdsLength();this._itemConfig=new Au(n),this._itemConfig.setup(),this.setupBVH()}updateDecoding(t){if(void 0===t.text_decoder_)throw new Error("ByteBuffer text_decoder_ can not be replaced");t.text_decoder_=new kc}async setupData(){const t=this._materials.update(this._model);this._virtualMeshes=new Tu(this.modelId,this.connection,this._model,this._aabbs,this._itemConfig,this._properties,t),this._properties=new Cu(this._model,this._aabbs),this._raycast=new Ac(this._model,this._aabbs,this._virtualMeshes,this._itemConfig),await this._virtualMeshes.setupGeometryTemplates()}update(t){return this._virtualMeshes.update(t),this._virtualMeshes.allInstancesUpdated}raycast(t,e){if(this._camera)return this._raycast.pick(t,e,this._camera.clippingPlanes)}snapRaycast(t,e,s){if(this._camera)return this._raycast.snapPick(t,e,s,this._camera.clippingPlanes)}rectangleRaycast(t,e){if(this._camera)return this._raycast.rectangleRaycast(t,this._camera.clippingPlanes,e)}getCoordinates(){const t=this._model.meshes().coordinates(),e=t.position(),s=t.xDirection(),i=t.yDirection();return[e.x(),e.y(),e.z(),s.x(),s.y(),s.z(),i.x(),i.y(),i.z()]}traverse(t,e){if(t)for(let s=0;s<t.length;s++)e(t[s],s);else for(let t=0;t<this._itemConfig.length;t++)e(t,t)}highlight(t,e){const s=this._properties.getItemIdsFromLocalIds(t),i=[];this.traverse(s,(t=>{const s=this._itemConfig.getHighlight(t);if(void 0!==s){const t=this._materials.get(s),n={...e};void 0===n.color&&void 0!==t.color&&(n.color=t.color),void 0===n.opacity&&void 0!==t.opacity&&(n.opacity=t.opacity),void 0===n.transparent&&void 0!==t.transparent&&(n.transparent=t.transparent),void 0===n.side&&void 0!==t.side&&(n.side=t.side),i.push(n)}else i.push(e)}));const n=this._materials.transfer(i);this.traverse(s,((t,e)=>{this._itemConfig.setHighlight(t,n[e])})),this._virtualMeshes.updateAllVirtualData(s)}getHighlight(t){const e=[];return this.traverse(t,(t=>{const s=this._itemConfig.getHighlight(t);e.push(s?this._materials.get(s):void 0)})),e}getHighlightItemIds(){const t=[];for(let e=0;e<this._itemConfig.length;e++)this._itemConfig.getHighlight(e)&&t.push(e);return t}setVisible(t,e){const s=this._properties.getItemIdsFromLocalIds(t);this.traverse(s,(t=>this._itemConfig.setVisible(t,e))),this._virtualMeshes.updateAllVirtualData(t)}getVisible(t){return this._properties.getItemIdsFromLocalIds(t).map((t=>this._itemConfig.visible(t)))}getGeometriesLength(){return this._model.meshes().globalTransformsLength()}getGeometry(t){const[e]=this._properties.getItemIdsFromLocalIds([t]),s=this._aabbs.getItemInstanceIds(e),i=new Array;for(const t of s){const e=this._virtualMeshes.fetchGeometry(t,Uo.GEOMETRY);Pc(e.geometries,(t=>{i.push({transform:e.transform,indices:t.indexBuffer,positions:t.positionBuffer,normals:t.normalBuffer})}))}return i}async getSection(t){const e=new Qs(new Yt(0,0,1),1.5);this._sectionGenerator.plane=e,performance.now();const s=this._properties.getItemsLength(),i=new Map,n=[];for(let t=0;t<s;t++){const s=this._aabbs.getItemInstanceIds(t);if(s)for(const r of s){const s=this._aabbs.getTransformedAABB(r);if(!e.intersectsBox(s))continue;const o=this._virtualMeshes.geometries.meshesItems(t);if("IFCSPACE"===this._model.categories(o))continue;const a=this._virtualMeshes.geometries.samples(r);if(!a)continue;const h=a.representation();if(!i.has(h)){const t=[];Pc(this._virtualMeshes.fetchGeometry(r,Uo.GEOMETRY).geometries,(e=>{if(!e.indexBuffer||!e.positionBuffer)return;const s=new Fs;s.setIndex(Array.from(e.indexBuffer)),s.setAttribute("position",new Ms(e.positionBuffer,3)),t.push(s)})),i.set(h,t)}const l=i.get(h);if(l)for(const t of l){const e=new js(t),s=this._virtualMeshes.instancePlacement(r);e.applyMatrix4(s),e.updateWorldMatrix(!0,!0),n.push(e)}}}const r=new Float32Array(6e5),o=new Ms(r,3,!1),{index:a,indexes:h}=this._sectionGenerator.createEdges({meshes:n,posAttr:o}),l=this._sectionGenerator.createFills(r,h);for(const[,t]of i)for(const e of t)e.dispose();return t.buffer=r,t.index=a,t.fillsIndices=l,t}async getPositions(t){const e=[],s=this._properties.getItemIdsFromLocalIds(t);for(const t of s){const s=this._virtualMeshes.geometries.globalTransforms(t);s&&e.push({x:s.position().x(),y:s.position().y(),z:s.position().z()})}return e}useCamera(t){this._camera=t,this._virtualMeshes.setupVirtualCamera(t)}getFullBBox(){return this._aabbs.modelAABB}getBBoxes(t){const e=new Qt;return this._properties.getAABB(t,e),e}resetHighlight(t){const e=this._properties.getItemIdsFromLocalIds(t);if(e)for(const t of e)this._itemConfig.setHighlight(t,0);else this._itemConfig.clearHighlight();this._virtualMeshes.updateAll()}resetVisible(){this._itemConfig.clearVisible(),this._virtualMeshes.updateAll()}getItemsByVisibility(t){return this.getItemsByConfig((e=>this._itemConfig.visible(e)===t))}getItemsByConfig(t){const e=[];for(let s=0,i=this._model.localIdsLength();s<i;s++)t(s)&&e.push(s);return e}applyTransformation(t,e){this._virtualMeshes.applyTransformation(t,e)}getFile(t){const e=this._model.bb.bytes().buffer;return t?e:Fo.deflate(e)}dispose(){this._virtualMeshes.dispose()}getItemCategory(t){return this._properties.getItemCategory(t)}getItemGuid(t){return this._properties.getItemGuid(t)}getLocalIdByGuid(t){return this._properties.getLocalIdByGuid(t)}getItemIdsByLocalIds(t){return this._properties.getItemIdsFromLocalIds(t)}getItemAttributes(t){return this._properties.getItemAttributes(t)}getItemsOfCategory(t){return this._properties.getItemsOfCategory(t)}getItemsWithGeometry(){return this._properties.getItemsWithGeometry()}getItemRelations(t){return this._properties.getItemRelations(t)}getSpatialStructure(){return this._properties.getSpatialStructure()}getMaxLocalId(){return this._properties.getMaxLocalId()}getCategories(){return this._properties.getCategories()}getMetadata(){return this._properties.getMetadata()}setupBVH(){Fs.prototype.computeBoundsTree=yl,Fs.prototype.disposeBoundsTree=gl,js.prototype.raycast=bl}}class Lu{constructor(t){nt(this,"communicationKey",0),nt(this,"handlers",new Map),nt(this,"handleInput"),nt(this,"onInput",(t=>{t.data.toMainThread?this.onOutput(t.data):this.manageInput(t.data)})),this.handleInput=t}initConnection(t){t.onmessage=this.onInput}fetch(t,e){return t.requestId=this.communicationKey++,new Promise((async(s,i)=>{this.handlers.set(t.requestId,(t=>{t.errorInfo?i(t.errorInfo):s(t)}));(await this.fetchConnection(t)).postMessage(t,e)}))}onOutput(t){const e=this.handlers.get(t.requestId);this.handlers.delete(t.requestId),e(t)}async manageInput(t){try{await this.handleInput(t)}catch(e){console.error(e),t.errorInfo=e.toString()}t.toMainThread=!0,(await this.fetchConnection(t)).postMessage(t)}}class Ou extends Lu{constructor(t,e){super(e),nt(this,"port"),this.port=t,this.initConnection(t)}async fetchConnection(t){return this.port}}class Vu{constructor(){nt(this,"handlers",this),nt(this,"connection")}useConnection(t){this.connection=new Ou(t,(async t=>{const e=this.handlers[t.class];e?await e(t):console.warn(`Handler not found for worker message type ${t.class}`)}))}}async function Uu(t,e){for(let e=0;e<t.parameters.length;e++)t.parameters[e]&&t.parameters[e].elements&&(t.parameters[e]=qu(t.parameters[e])),t.parameters[e]&&t.parameters[e].origin&&t.parameters[e].direction&&(t.parameters[e]=Zu(t.parameters[e]));const s=e.get(t.modelId);t.result=await s[t.function].apply(s,t.parameters),t.parameters=void 0}function Du(t){return(new Yt).copy(t)}function Nu(t){return t?t.map((t=>new Qs(Du(t.normal),t.constant))):t}function Wu(t){if(!t)return;const e=Nu(t.planes);return new ti(e[0],e[1],e[2],e[3],e[4],e[5])}function Zu(t){return new Me(Du(t.origin),Du(t.direction))}function qu(t){return(new Ae).copy(t)}const Hu=new class extends Vu{constructor(){super(),nt(this,"list",new Map),nt(this,"shared"),this.handlers[Do.CREATE_MODEL]=async t=>{t.raw||(t.modelData=Fo.inflate(t.modelData));const e=new Ru(t.modelId,t.modelData,this.connection);await e.setupData(),this.list.set(t.modelId,e),t.modelData=void 0,t.boundingBox=e.getFullBBox()},this.handlers[Do.DELETE_MODEL]=t=>{this.list.get(t.modelId).dispose(),this.list.delete(t.modelId)},this.handlers[Do.RAYCAST]=t=>{if(t.snappingClass)t.results=this.list.get(t.modelId).snapRaycast(Zu(t.ray),Wu(t.frustum),t.snappingClass);else if(t.ray){const e=this.list.get(t.modelId).raycast(Zu(t.ray),Wu(t.frustum));e&&(t.results=[e])}else t.localIds=this.list.get(t.modelId).rectangleRaycast(Wu(t.frustum),t.fullyIncluded)},this.handlers[Do.REFRESH_VIEW]=t=>{t.view.cameraFrustum=Wu(t.view.cameraFrustum),t.view.cameraPosition=Du(t.view.cameraPosition),t.view.clippingPlanes=Nu(t.view.clippingPlanes);const e=this.list.get(t.modelId);e&&e.useCamera(t.view)},this.handlers[Do.FETCH_AABBS]=t=>{t.boundingBoxes=[];const e=this.list.get(t.modelId);if(t.itemsSets)for(const s of t.itemsSets){const i=e.getItemIdsByLocalIds(s),n=e.getBBoxes(i);t.boundingBoxes.push(n)}else{const s=[0];for(let i=0,n=e.getGeometriesLength();i<n;i++){s[0]=i;const n=e.getBBoxes(s);t.boundingBoxes.push(n)}}t.itemsSets=void 0},this.handlers[Do.EXECUTE]=async t=>{await Uu(t,this.list)},this.init()}init(){const t=()=>{let e=!0;const s=performance.now();for(const t of this.list.values())if(e=e&&t.update(s),performance.now()-s>15)break;setTimeout(t,e?100:0)};t()}useShared(t){this.shared=t}};globalThis.onmessage=t=>{if(t.data instanceof MessagePort)Hu.useConnection(t.data);else{if(!crossOriginIsolated)return void console.log("SharedArrayBuffers are not enabled. This generally means worse performance. To enable them: https://stackoverflow.com/a/65675390");t.data instanceof SharedArrayBuffer&&Hu.useShared(t.data)}};export{Wu as importFrustum,qu as importMatrix,Nu as importPlanes,Zu as importRay,Du as importVector,Uu as manageInvokeRequest};
